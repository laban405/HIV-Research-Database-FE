"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[108,3429],{71725:(Y,w,o)=>{o.d(w,{CH:()=>l,EV:()=>S});var u=o(69972),P=o(63352);const l="groups";function S(g){return new u.R((0,P.sr)(),l,g).toString()}},80108:(Y,w,o)=>{o.r(w),o.d(w,{AccessControlModule:()=>Nt});var u=o(69808),P=o(74202),l=o(42501),x=o(61135),S=o(39841),g=o(63900),b=o(54004),f=o(95698),M=o(18433),j=o(20789),p=o(38475),z=o(55489),U=o(74293);class X{}var I=o(5587),N=o(86316),c=o(46283),C=o(52381),F=o(64025),D=o(99405),O=o(94799),e=o(5e3),L=o(86956),m=o(93075),q=o(17656),H=o(8108),G=o(39646),te=o(78372),K=o(17967),ne=o(82233),$=o(94407),Z=o(36696),Q=o(18838),B=o(59038),k=o(50358),_=o(27924),E=o(92396);function R(i,s){1&i&&e.\u0275\u0275element(0,"div")}function T(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".create"))}}function _e(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".edit"))}}const xe=function(i){return{"d-none":i}};function ye(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().impersonate()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(6,xe,!e.\u0275\u0275pipeBind1(1,2,t.canImpersonate$))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,4,"admin.access-control.epeople.actions.impersonate")," ")}}function Pe(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",19),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().stopImpersonating()}),e.\u0275\u0275element(1,"i",18),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"admin.access-control.epeople.actions.stop-impersonating")," "))}function Ie(i,s){1&i&&e.\u0275\u0275element(0,"ds-loading",20),2&i&&e.\u0275\u0275property("showMessage",!1)}function Ee(i,s){1&i&&e.\u0275\u0275element(0,"ds-loading",20),2&i&&e.\u0275\u0275property("showMessage",!1)}const ue=function(i){return[i]};function Ce(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",28),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",28)(4,"a",29),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).groupsDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",28),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(6,ue,n.groupsDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,4,t.object))||null==r.payload?null:r.payload.name)}}function Be(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-pagination",23),e.\u0275\u0275listener("pageChange",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).onPageChange(r)}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th",26),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",26),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",26),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"tbody"),e.\u0275\u0275template(17,Ce,9,8,"tr",27),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n,r,a;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,9,t.groups))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,11,t.groups))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,13,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,15,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,17,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(18,19,t.groups))||null==a.payload?null:a.payload.page)}}function Fe(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",30)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",31),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,3,t.messagePrefix+".memberOfNoGroups")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(7,ue,t.groupsDataService.getGroupRegistryRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,5,t.messagePrefix+".goToGroups"))}}function De(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Ee,1,1,"ds-loading",15),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275template(6,Be,19,21,"ds-pagination",21),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,Fe,8,9,"div",22),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,t.messagePrefix+".groupsEPersonIsMemberOf")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,6,t.groups)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(n=e.\u0275\u0275pipeBind1(7,8,t.groups))||null==n.payload?null:n.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(r=e.\u0275\u0275pipeBind1(9,10,t.groups))||null==r.payload?null:r.payload.totalElements))}}let Ge=(()=>{class i{constructor(t,n,r,a,d,v,y,h,V,A,ee,pe){this.changeDetectorRef=t,this.epersonService=n,this.groupsDataService=r,this.formBuilderService=a,this.translateService=d,this.notificationsService=v,this.authService=y,this.authorizationService=h,this.modalService=V,this.paginationService=A,this.requestService=ee,this.epersonRegistrationService=pe,this.labelPrefix="admin.access-control.epeople.form.",this.formId="eperson-form",this.messagePrefix="admin.access-control.epeople.form",this.formLayout={firstName:{grid:{host:"row"}},lastName:{grid:{host:"row"}},email:{grid:{host:"row"}},canLogIn:{grid:{host:"col col-sm-6 d-inline-block"}},requireCertificate:{grid:{host:"col col-sm-6 d-inline-block"}}},this.submitForm=new e.EventEmitter,this.cancelForm=new e.EventEmitter,this.subs=[],this.config=Object.assign(new U.r,{id:"gem",pageSize:5,currentPage:1}),this.isImpersonated=!1,this.subs.push(this.epersonService.getActiveEPerson().subscribe(ce=>{this.epersonInitial=ce,(0,p.Uh)(ce)&&(this.isImpersonated=this.authService.isImpersonatingUser(ce.id))}))}ngOnInit(){this.initialisePage()}initialisePage(){(0,S.a)(this.translateService.get(`${this.messagePrefix}.firstName`),this.translateService.get(`${this.messagePrefix}.lastName`),this.translateService.get(`${this.messagePrefix}.email`),this.translateService.get(`${this.messagePrefix}.canLogIn`),this.translateService.get(`${this.messagePrefix}.requireCertificate`),this.translateService.get(`${this.messagePrefix}.emailHint`)).subscribe(([t,n,r,a,d,v])=>{this.firstName=new H.b1u({id:"firstName",label:t,name:"firstName",validators:{required:null},required:!0}),this.lastName=new H.b1u({id:"lastName",label:n,name:"lastName",validators:{required:null},required:!0}),this.email=new H.b1u({id:"email",label:r,name:"email",validators:{required:null,pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"},required:!0,errorMessages:{emailTaken:"error.validation.emailTaken",pattern:"error.validation.NotValidEmail"},hint:v}),this.canLogIn=new H.dwp({id:"canLogIn",label:a,name:"canLogIn",value:null==this.epersonInitial||this.epersonInitial.canLogIn}),this.requireCertificate=new H.dwp({id:"requireCertificate",label:d,name:"requireCertificate",value:null!=this.epersonInitial&&this.epersonInitial.requireCertificate}),this.formModel=[this.firstName,this.lastName,this.email,this.canLogIn,this.requireCertificate],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.subs.push(this.epersonService.getActiveEPerson().subscribe(h=>{null!=h&&(this.groups=this.groupsDataService.findAllByHref(h._links.groups.href,{currentPage:1,elementsPerPage:this.config.pageSize})),this.formGroup.patchValue({firstName:null!=h?h.firstMetadataValue("eperson.firstname"):"",lastName:null!=h?h.firstMetadataValue("eperson.lastname"):"",email:null!=h?h.email:"",canLogIn:null==h||h.canLogIn,requireCertificate:null!=h&&h.requireCertificate}),null===h&&this.formGroup.controls.email&&(this.formGroup.controls.email.setAsyncValidators(class re{static createValidator(s){return t=>s.getEPersonByEmail(t.value).pipe((0,c.xw)(),(0,b.U)(n=>n.payload?{emailTaken:!0}:null))}}.createValidator(this.epersonService)),this.emailValueChangeSubscribe=this.email.valueChanges.pipe((0,te.b)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()}))}));const y=this.epersonService.getActiveEPerson();this.groups=y.pipe((0,g.w)(h=>(0,S.a)([(0,G.of)(h),this.paginationService.getFindListOptions(this.config.id,{currentPage:1,elementsPerPage:this.config.pageSize})])),(0,g.w)(([h,V])=>null!=h?this.groupsDataService.findAllByHref(h._links.groups.href,V,!0,!0,(0,Q.l)("object")):(0,G.of)(void 0))),this.canImpersonate$=y.pipe((0,g.w)(h=>(0,p.Uh)(h)?this.authorizationService.isAuthorized(I.i.LoginOnBehalfOf,h.self):(0,G.of)(!1))),this.canDelete$=y.pipe((0,g.w)(h=>this.authorizationService.isAuthorized(I.i.CanDelete,(0,p.Uh)(h)?h.self:void 0))),this.canReset$=(0,G.of)(!0)})}onCancel(){this.epersonService.cancelEditEPerson(),this.cancelForm.emit()}onSubmit(){this.epersonService.getActiveEPerson().pipe((0,f.q)(1)).subscribe(t=>{const n={metadata:{"eperson.firstname":[{value:this.firstName.value}],"eperson.lastname":[{value:this.lastName.value}]},email:this.email.value,canLogIn:this.canLogIn.value,requireCertificate:this.requireCertificate.value};null==t?this.createNewEPerson(n):this.editEPerson(t,n)})}createNewEPerson(t){const n=Object.assign(new ne.T,t);this.epersonService.create(n).pipe((0,c.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.created.success",{name:n.name})),this.submitForm.emit(n)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.created.failure",{name:n.name})),this.cancelForm.emit())}),this.showNotificationIfEmailInUse(n,"created")}editEPerson(t,n){const r=Object.assign(new ne.T,{id:t.id,metadata:{"eperson.firstname":[{value:this.firstName.value?this.firstName.value:t.firstMetadataValue("eperson.firstname")}],"eperson.lastname":[{value:this.lastName.value?this.lastName.value:t.firstMetadataValue("eperson.lastname")}]},email:(0,p.Uh)(n.email)?n.email:t.email,canLogIn:(0,p.Uh)(n.canLogIn)?n.canLogIn:t.canLogIn,requireCertificate:(0,p.Uh)(n.requireCertificate)?n.requireCertificate:t.requireCertificate,_links:t._links});this.epersonService.updateEPerson(r).pipe((0,c.hC)()).subscribe(d=>{d.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.edited.success",{name:r.name})),this.submitForm.emit(r)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.edited.failure",{name:r.name})),this.cancelForm.emit())}),null!=n.email&&n.email!==t.email&&this.showNotificationIfEmailInUse(r,"edited")}onPageChange(t){this.updateGroups({currentPage:t,elementsPerPage:this.config.pageSize})}impersonate(){this.authService.impersonate(this.epersonInitial.id),this.isImpersonated=!0}delete(){this.epersonService.getActiveEPerson().pipe((0,f.q)(1)).subscribe(t=>{const n=this.modalService.open(C.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,f.q)(1)).subscribe(r=>{r&&(0,p.Uh)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,c.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:t.name})),this.submitForm.emit()):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+t.id+" with code: "+a.statusCode+" and message: "+a.errorMessage),this.cancelForm.emit()})})})}stopImpersonating(){this.authService.stopImpersonatingAndRefresh(),this.isImpersonated=!1}resetPassword(){(0,p.Uh)(this.epersonInitial.email)&&this.epersonRegistrationService.registerEmail(this.epersonInitial.email).pipe((0,c.hC)()).subscribe(t=>{t.hasSucceeded?this.notificationsService.success(this.translateService.get("admin.access-control.epeople.actions.reset"),this.translateService.get("forgot-email.form.success.content",{email:this.epersonInitial.email})):this.notificationsService.error(this.translateService.get("forgot-email.form.error.head"),this.translateService.get("forgot-email.form.error.content",{email:this.epersonInitial.email}))})}ngOnDestroy(){this.onCancel(),this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id),(0,p.Uh)(this.emailValueChangeSubscribe)&&this.emailValueChangeSubscribe.unsubscribe()}reset(){this.epersonService.getActiveEPerson().pipe((0,f.q)(1)).subscribe(t=>{this.requestService.removeByHrefSubstring(t.self)}),this.initialisePage()}showNotificationIfEmailInUse(t,n){this.subs.push(this.epersonService.searchByScope("email",t.email,{currentPage:1,elementsPerPage:0}).pipe((0,c.xw)(),(0,c.xe)()).subscribe(r=>{r.totalElements>0&&this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification."+n+".failure.emailInUse",{name:t.name,email:t.email}))}))}updateGroups(t){this.subs.push(this.epersonService.getActiveEPerson().subscribe(n=>{this.groups=this.groupsDataService.findAllByHref(n._links.groups.href,t)}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(j.k),e.\u0275\u0275directiveInject(K.O),e.\u0275\u0275directiveInject($.c),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(Z.e8),e.\u0275\u0275directiveInject(N._),e.\u0275\u0275directiveInject(q.FF),e.\u0275\u0275directiveInject(O.N),e.\u0275\u0275directiveInject(F.s),e.\u0275\u0275directiveInject(B.m))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-eperson-form"]],outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:29,vars:31,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["between","",1,"btn-group"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fa","fa-key"],["between","",1,"btn-group","ml-1"],["class","btn btn-primary",3,"ngClass","click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["after","",1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fas","fa-trash"],[3,"showMessage",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-primary",3,"ngClass","click"],[1,"fa","fa-user-secret"],[1,"btn","btn-primary",3,"click"],[3,"showMessage"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"routerLink","click"],["role","alert",1,"alert","alert-info","w-100","mb-2"],[1,"btn","btn-primary",3,"routerLink"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,R,1,0,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,T,3,3,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(4,_e,3,3,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(6,"ds-form",3),e.\u0275\u0275listener("submitForm",function(){return n.onSubmit()}),e.\u0275\u0275elementStart(7,"div",4)(8,"button",5),e.\u0275\u0275listener("click",function(){return n.onCancel()}),e.\u0275\u0275element(9,"i",6),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",7)(13,"button",8),e.\u0275\u0275listener("click",function(){return n.resetPassword()}),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275element(15,"i",9),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",10),e.\u0275\u0275template(19,ye,5,8,"button",11),e.\u0275\u0275template(20,Pe,4,3,"button",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",13),e.\u0275\u0275listener("click",function(){return n.delete()}),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275element(23,"i",14),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(26,Ie,1,1,"ds-loading",15),e.\u0275\u0275template(27,De,10,12,"div",16),e.\u0275\u0275pipe(28,"async")),2&t){const r=e.\u0275\u0275reference(3),a=e.\u0275\u0275reference(5);e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,17,n.epersonService.getActiveEPerson()))("ngIfThen",a)("ngIfElse",r),e.\u0275\u0275advance(6),e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formGroup",n.formGroup)("formLayout",n.formLayout)("displayCancel",!1),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(11,19,n.messagePrefix+".return"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(14,21,n.canReset$)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(17,23,"admin.access-control.epeople.actions.reset")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!n.isImpersonated),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isImpersonated),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(22,25,n.canDelete$)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,27,"admin.access-control.epeople.actions.delete")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.formGroup),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(28,29,n.epersonService.getActiveEPerson()))}},directives:[u.O5,k.U,m.JL,m.sg,u.mk,_.N,E.Q,u.sg,P.yS,P.rH],pipes:[u.Ov,L.X$],encapsulation:2}),i})();function Te(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().isEPersonFormShown=!0}),e.\u0275\u0275element(2,"i",8),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,1,t.labelPrefix+"button.add"))}}function we(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-eperson-form",10),e.\u0275\u0275listener("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().reset()})("cancelForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().isEPersonFormShown=!1}),e.\u0275\u0275elementEnd()}}function Oe(i,s){1&i&&e.\u0275\u0275element(0,"ds-loading")}const Le=function(i){return{"table-primary":i}},me=function(i){return{name:i}};function Re(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr",30),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"td"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"td"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"td"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td")(9,"div",31)(10,"button",32),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).toggleEditEPerson(a.eperson)}),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275element(12,"i",33),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",34),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).deleteEPerson(a.eperson)}),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275element(15,"i",35),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(15,Le,e.\u0275\u0275pipeBind1(1,7,n.isActive(t.eperson)))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.email),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(11,9,n.labelPrefix+"table.edit.buttons.edit",e.\u0275\u0275pureFunction1(17,me,t.eperson.name))),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(14,12,n.labelPrefix+"table.edit.buttons.remove",e.\u0275\u0275pureFunction1(19,me,t.eperson.name))),e.\u0275\u0275property("disabled",!t.ableToDelete)}}function Me(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",25),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",26)(3,"table",27)(4,"thead")(5,"tr")(6,"th",28),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",28),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",28),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"th"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"tbody"),e.\u0275\u0275template(19,Re,16,21,"tr",29),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext(2);let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",t.pageInfoState$)("collectionSize",null==(n=e.\u0275\u0275pipeBind1(1,10,t.pageInfoState$))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,12,t.labelPrefix+"table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,14,t.labelPrefix+"table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,16,t.labelPrefix+"table.email")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,t.labelPrefix+"table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(20,20,t.ePeopleDto$))?null:r.page)}}function $e(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",36),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.labelPrefix+"no-items")," ")}}function je(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"h3",11),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"form",12),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return r.search(r.searchForm.value)}),e.\u0275\u0275elementStart(5,"div")(6,"select",13)(7,"option",14),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"option",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",16)(14,"div",17),e.\u0275\u0275element(15,"input",18),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementStart(18,"span",19)(19,"button",20),e.\u0275\u0275element(20,"i",21),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(23,"div")(24,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().clearFormAndResetResult()}),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(27,Oe,1,0,"ds-loading",5),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275template(29,Me,21,22,"ds-pagination",23),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275template(32,$e,3,3,"div",24),e.\u0275\u0275pipe(33,"async"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,11,t.labelPrefix+"search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.searchForm),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,13,t.labelPrefix+"search.scope.metadata")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,15,t.labelPrefix+"search.scope.email")),e.\u0275\u0275advance(4),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(17,19,t.labelPrefix+"search.placeholder")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(16,17,t.labelPrefix+"search.placeholder")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,21,t.labelPrefix+"search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,23,t.labelPrefix+"button.see-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(28,25,t.searching$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(n=e.\u0275\u0275pipeBind1(30,27,t.pageInfoState$))?null:n.totalElements)>0&&!e.\u0275\u0275pipeBind1(31,29,t.searching$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0==(null==(r=e.\u0275\u0275pipeBind1(33,31,t.pageInfoState$))?null:r.totalElements))}}let Ae=(()=>{class i{constructor(t,n,r,a,d,v,y,h,V){this.epersonService=t,this.translateService=n,this.notificationsService=r,this.authorizationService=a,this.formBuilder=d,this.router=v,this.modalService=y,this.paginationService=h,this.requestService=V,this.labelPrefix="admin.access-control.epeople.",this.ePeople$=new x.X((0,M.b)(new D.S,[])),this.ePeopleDto$=new x.X({}),this.pageInfoState$=new x.X(void 0),this.searching$=new x.X(!1),this.config=Object.assign(new U.r,{id:"elp",pageSize:5,currentPage:1}),this.subs=[],this.currentSearchQuery="",this.currentSearchScope="metadata",this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}ngOnInit(){this.initialisePage()}initialisePage(){this.searching$.next(!0),this.isEPersonFormShown=!1,this.search({scope:this.currentSearchScope,query:this.currentSearchQuery}),this.subs.push(this.epersonService.getActiveEPerson().subscribe(t=>{null!=t&&t.id&&(this.isEPersonFormShown=!0)})),this.subs.push(this.ePeople$.pipe((0,g.w)(t=>t.pageInfo.totalElements>0?(0,S.a)(...t.page.map(n=>this.authorizationService.isAuthorized(I.i.CanDelete,(0,p.Uh)(n)?n.self:void 0).pipe((0,b.U)(r=>{const a=new X;return a.ableToDelete=r,a.eperson=n,a})))).pipe((0,b.U)(n=>(0,M.b)(t.pageInfo,n))):[t])).subscribe(t=>{this.searching$.next(!1),this.ePeopleDto$.next(t),this.pageInfoState$.next(t.pageInfo)}))}search(t){this.searching$.next(!0),(0,p.Uh)(this.findListOptionsSub)&&this.findListOptionsSub.unsubscribe(),this.findListOptionsSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,g.w)(n=>{const r=t.query,a=t.scope;return null!=r&&this.currentSearchQuery!==r&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchQuery=r,this.paginationService.resetPage(this.config.id)),null!=a&&this.currentSearchScope!==a&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchScope=a,this.paginationService.resetPage(this.config.id)),this.epersonService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,c.g1)()).subscribe(n=>{this.ePeople$.next(n.payload),this.pageInfoState$.next(n.payload.pageInfo)})}isActive(t){return this.getActiveEPerson().pipe((0,b.U)(n=>t===n))}getActiveEPerson(){return this.epersonService.getActiveEPerson()}toggleEditEPerson(t){this.getActiveEPerson().pipe((0,f.q)(1)).subscribe(n=>{t===n?(this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1):(this.epersonService.editEPerson(t),this.isEPersonFormShown=!0)}),this.scrollToTop()}deleteEPerson(t){if((0,p.Uh)(t.id)){const n=this.modalService.open(C.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,f.q)(1)).subscribe(r=>{r&&(0,p.Uh)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,c.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:t.name})),this.reset()):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+t.id+" with code: "+a.statusCode+" and message: "+a.errorMessage)})})}}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe())}scrollToTop(){!function t(){const n=document.documentElement.scrollTop||document.body.scrollTop;n>0&&(window.requestAnimationFrame(t),window.scrollTo(0,n-n/8))}()}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}reset(){this.epersonService.getBrowseEndpoint().pipe((0,f.q)(1)).subscribe(t=>{this.requestService.setStaleByHrefSubstring(t).pipe((0,f.q)(1)).subscribe(()=>{this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1})})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(j.k),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(N._),e.\u0275\u0275directiveInject(m.qu),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(q.FF),e.\u0275\u0275directiveInject(O.N),e.\u0275\u0275directiveInject(F.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-epeople-registry"]],decls:10,vars:6,consts:[[1,"container"],[1,"epeople-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[4,"ngIf"],[3,"submitForm","cancelForm",4,"ngIf"],[1,"mr-auto","btn","btn-success","addEPerson-button",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[3,"submitForm","cancelForm"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"search-button","btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epeople",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm","access-control-editEPersonButton",3,"title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm","access-control-deleteEPersonButton",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Te,6,3,"div",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,we,1,0,"ds-eperson-form",6),e.\u0275\u0275template(9,je,34,33,"div",5),e.\u0275\u0275elementEnd()()()),2&t&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,4,n.labelPrefix+"head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.isEPersonFormShown),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isEPersonFormShown),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.isEPersonFormShown))},directives:[u.O5,Ge,m._Y,m.JL,m.sg,m.EJ,m.JJ,m.u,m.YN,m.Kr,m.Fj,_.N,E.Q,u.sg,u.mk],pipes:[L.X$,u.Ov],encapsulation:2}),i})();var Ue=o(39300),de=o(70262),Ne=o(40011),ke=o(34736),ge=o(61195),Ve=o(6262),ze=o(60952),He=o(42851),Qe=o(60300),Je=o(84561),ae=o(86099);const oe=function(i){return{name:i}};function Xe(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteMemberFromGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",26),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,oe,t.eperson.name)))}}function Ke(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).addMemberToGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",28),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.add",e.\u0275\u0275pureFunction1(4,oe,t.eperson.name)))}}const fe=function(i){return[i]};function Ye(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",19),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",19)(4,"a",21),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).ePersonDataService.startEditingNewEPerson(a.eperson)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",19),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275element(9,"br"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td",19)(13,"div",22),e.\u0275\u0275template(14,Xe,3,6,"button",23),e.\u0275\u0275template(15,Ke,3,6,"button",24),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(13,fe,n.ePersonDataService.getEPeoplePageRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(8,9,n.messagePrefix+".table.email"),": ",t.eperson.email?t.eperson.email:"-",""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(11,11,n.messagePrefix+".table.netid"),": ",t.eperson.netid?t.eperson.netid:"-"," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.memberOfGroup),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.memberOfGroup)}}function qe(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",16)(4,"table",17)(5,"thead")(6,"tr")(7,"th",18),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",18),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",18),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",19),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,Ye,16,15,"tr",20),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.configSearch)("pageInfoState",e.\u0275\u0275pipeBind1(1,10,t.ePeopleSearchDtos))("collectionSize",null==(n=e.\u0275\u0275pipeBind1(2,12,t.ePeopleSearchDtos))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.identity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(21,22,t.ePeopleSearchDtos))?null:r.page)}}function Ze(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-items")," ")}}function et(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",19),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",19)(4,"a",21),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).ePersonDataService.startEditingNewEPerson(a.eperson)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",19),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275element(9,"br"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td",19)(13,"div",22)(14,"button",25),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).deleteMemberFromGroup(a)}),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275element(16,"i",26),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(15,fe,n.ePersonDataService.getEPeoplePageRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(8,8,n.messagePrefix+".table.email"),": ",t.eperson.email?t.eperson.email:"-",""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(11,10,n.messagePrefix+".table.netid"),": ",t.eperson.netid?t.eperson.netid:"-"," "),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(15,12,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(17,oe,t.eperson.name)))}}function tt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",16)(4,"table",30)(5,"thead")(6,"tr")(7,"th",18),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",18),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",18),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",19),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,et,17,19,"tr",20),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",e.\u0275\u0275pipeBind1(1,10,t.ePeopleMembersOfGroupDtos))("collectionSize",null==(n=e.\u0275\u0275pipeBind1(2,12,t.ePeopleMembersOfGroupDtos))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.identity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(21,22,t.ePeopleMembersOfGroupDtos))?null:r.page)}}function nt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-members-yet")," ")}}var W=(()=>{return(i=W||(W={}))[i.ActiveGroup=0]="ActiveGroup",i[i.MembersDTO=1]="MembersDTO",i[i.SearchResultsDTO=2]="SearchResultsDTO",W;var i})();let it=(()=>{class i{constructor(t,n,r,a,d,v,y){this.groupDataService=t,this.ePersonDataService=n,this.translateService=r,this.notificationsService=a,this.formBuilder=d,this.paginationService=v,this.router=y,this.ePeopleSearchDtos=new x.X(void 0),this.ePeopleMembersOfGroupDtos=new x.X(void 0),this.configSearch=Object.assign(new U.r,{id:"sml",pageSize:5,currentPage:1}),this.config=Object.assign(new U.r,{id:"ml",pageSize:5,currentPage:1}),this.subs=new Map,this.currentSearchQuery="",this.currentSearchScope="metadata"}ngOnInit(){this.searchForm=this.formBuilder.group({scope:"metadata",query:""}),this.subs.set(W.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveMembers(this.config.currentPage))}))}retrieveMembers(t){this.unsubFrom(W.MembersDTO),this.subs.set(W.MembersDTO,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,g.w)(n=>this.ePersonDataService.findAllByHref(this.groupBeingEdited._links.epersons.href,{currentPage:n.currentPage,elementsPerPage:n.pageSize})),(0,c.f1)(),(0,b.U)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))}),(0,g.w)(n=>(0,S.a)(...n.payload.page.map(a=>(0,S.a)(this.isMemberOfGroup(a),v=>{const y=new X;return y.eperson=a,y.memberOfGroup=v,y}))).pipe((0,b.U)(a=>(0,M.b)(n.payload.pageInfo,a))))).subscribe(n=>{this.ePeopleMembersOfGroupDtos.next(n)}))}isMemberOfGroup(t){return this.groupDataService.getActiveGroup().pipe((0,f.q)(1),(0,ae.z)(n=>null!=n?this.ePersonDataService.findAllByHref(n._links.epersons.href,{currentPage:1,elementsPerPage:9999},!1).pipe((0,c.xw)(),(0,c.xe)(),(0,b.U)(r=>r.page.filter(a=>a.id===t.id)),(0,b.U)(r=>r.length>0)):(0,G.of)(!1)))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}deleteMemberFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.deleteMemberFromGroup(n,t.eperson);this.showNotifications("deleteMember",r,t.eperson.name,n),this.search({scope:this.currentSearchScope,query:this.currentSearchQuery})}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addMemberToGroup(t){t.memberOfGroup=!0,this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.addMemberToGroup(n,t.eperson);this.showNotifications("addMember",r,t.eperson.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){this.unsubFrom(W.SearchResultsDTO),this.subs.set(W.SearchResultsDTO,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,g.w)(n=>{const r=t.query,a=t.scope;return null!=r&&this.currentSearchQuery!==r&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchQuery=r,this.paginationService.resetPage(this.configSearch.id)),null!=a&&this.currentSearchScope!==a&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchScope=a,this.paginationService.resetPage(this.configSearch.id)),this.searchDone=!0,this.ePersonDataService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,c.f1)(),(0,b.U)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))}),(0,g.w)(n=>(0,S.a)(...n.payload.page.map(a=>(0,S.a)(this.isMemberOfGroup(a),v=>{const y=new X;return y.eperson=a,y.memberOfGroup=v,y}))).pipe((0,b.U)(a=>(0,M.b)(n.payload.pageInfo,a))))).subscribe(n=>{this.ePeopleSearchDtos.next(n)}))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,r,a){n.pipe((0,c.hC)()).subscribe(d=>{d.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:r})),this.ePersonDataService.clearLinkRequests(a._links.epersons.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:r}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.O),e.\u0275\u0275directiveInject(j.k),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(m.qu),e.\u0275\u0275directiveInject(O.N),e.\u0275\u0275directiveInject(P.F0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-members-list"]],inputs:{messagePrefix:"messagePrefix"},decls:40,vars:36,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epersonsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm",3,"title","click",4,"ngIf"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","ePeopleMembersOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h3",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"h4",1),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(8,"div")(9,"select",3)(10,"option",4),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"option",5),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",6)(17,"div",7),e.\u0275\u0275element(18,"input",8),e.\u0275\u0275elementStart(19,"span",9)(20,"button",10),e.\u0275\u0275element(21,"i",11),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(24,"div")(25,"button",12),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(28,qe,22,24,"ds-pagination",13),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275template(30,Ze,3,3,"div",14),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementStart(32,"h4"),e.\u0275\u0275text(33),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(35,tt,22,24,"ds-pagination",13),e.\u0275\u0275pipe(36,"async"),e.\u0275\u0275template(37,nt,3,3,"div",14),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275pipe(39,"async"),e.\u0275\u0275elementContainerEnd()),2&t){let r,a,d,v;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,12,n.messagePrefix+".head")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,14,n.messagePrefix+".search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,n.messagePrefix+".search.scope.metadata")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,n.messagePrefix+".search.scope.email")),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(23,20,n.messagePrefix+".search.button"),""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(27,22,n.messagePrefix+".button.see-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(29,24,n.ePeopleSearchDtos))?null:r.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(31,26,n.ePeopleSearchDtos))?null:a.totalElements)&&n.searchDone),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(34,28,n.messagePrefix+".headMembers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(d=e.\u0275\u0275pipeBind1(36,30,n.ePeopleMembersOfGroupDtos))?null:d.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null==e.\u0275\u0275pipeBind1(38,32,n.ePeopleMembersOfGroupDtos)||0==(null==(v=e.\u0275\u0275pipeBind1(39,34,n.ePeopleMembersOfGroupDtos))?null:v.totalElements))}},directives:[m._Y,m.JL,m.sg,m.EJ,m.JJ,m.u,m.YN,m.Kr,m.Fj,u.O5,E.Q,u.sg,P.yS],pipes:[L.X$,u.Ov],encapsulation:2}),i})();const se=function(i){return{name:i}};function rt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",23),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteSubgroupFromGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",24),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,se,t.name)))}}function at(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".table.edit.currentGroup"))}}function ot(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).addSubgroupToGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",26),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.add",e.\u0275\u0275pureFunction1(4,se,t.name)))}}const he=function(i){return[i]};function st(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",16)(4,"a",18),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).groupDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",16)(10,"div",19),e.\u0275\u0275template(11,rt,3,6,"button",20),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275template(14,at,3,3,"p",21),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275template(16,ot,3,6,"button",22),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(19,he,n.groupDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,7,t.object))||null==r.payload?null:r.payload.name),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(12,9,n.isSubgroupOfGroup(t))&&!e.\u0275\u0275pipeBind1(13,11,n.isActiveGroup(t))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(15,13,n.isActiveGroup(t))),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(17,15,n.isSubgroupOfGroup(t))&&!e.\u0275\u0275pipeBind1(18,17,n.isActiveGroup(t)))}}function lt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",13)(4,"table",14)(5,"thead")(6,"tr")(7,"th",15),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",15),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",16),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,st,19,21,"tr",17),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r,a;e.\u0275\u0275property("paginationOptions",t.configSearch)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,10,t.searchResults$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,12,t.searchResults$))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(21,22,t.searchResults$))||null==a.payload?null:a.payload.page)}}function pt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-items")," ")}}function ct(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",16)(4,"a",18),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).groupDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",16)(10,"div",19)(11,"button",23),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).deleteSubgroupFromGroup(a)}),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275element(13,"i",24),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(10,he,n.groupDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,5,t.object))||null==r.payload?null:r.payload.name),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(12,7,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(12,se,t.name)))}}function ut(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",13)(4,"table",28)(5,"thead")(6,"tr")(7,"th",15),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",15),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th"),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,ct,14,14,"tr",17),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r,a;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,10,t.subGroups$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,12,t.subGroups$))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(21,22,t.subGroups$))||null==a.payload?null:a.payload.page)}}function mt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-subgroups-yet")," ")}}var J=(()=>{return(i=J||(J={}))[i.Members=0]="Members",i[i.ActiveGroup=1]="ActiveGroup",i[i.SearchResults=2]="SearchResults",J;var i})();let dt=(()=>{class i{constructor(t,n,r,a,d,v){this.groupDataService=t,this.translateService=n,this.notificationsService=r,this.formBuilder=a,this.paginationService=d,this.router=v,this.searchResults$=new x.X(void 0),this.subGroups$=new x.X(void 0),this.subs=new Map,this.configSearch=Object.assign(new U.r,{id:"ssgl",pageSize:5,currentPage:1}),this.config=Object.assign(new U.r,{id:"sgl",pageSize:5,currentPage:1}),this.currentSearchQuery=""}ngOnInit(){this.searchForm=this.formBuilder.group({query:""}),this.subs.set(J.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveSubGroups())}))}retrieveSubGroups(){this.unsubFrom(J.Members),this.subs.set(J.Members,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,g.w)(t=>this.groupDataService.findAllByHref(this.groupBeingEdited._links.subgroups.href,{currentPage:t.currentPage,elementsPerPage:t.pageSize},!0,!0,(0,Q.l)("object")))).subscribe(t=>{this.subGroups$.next(t)}))}isSubgroupOfGroup(t){return this.groupDataService.getActiveGroup().pipe((0,f.q)(1),(0,ae.z)(n=>null!=n?n.uuid===t.uuid?(0,G.of)(!1):this.groupDataService.findAllByHref(n._links.subgroups.href,{currentPage:1,elementsPerPage:9999}).pipe((0,c.xw)(),(0,c.xe)(),(0,b.U)(r=>r.page.filter(a=>a.id===t.id)),(0,b.U)(r=>r.length>0)):(0,G.of)(!1)))}isActiveGroup(t){return this.groupDataService.getActiveGroup().pipe((0,f.q)(1),(0,ae.z)(n=>(0,G.of)(null!=n&&n.uuid===t.uuid)))}deleteSubgroupFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.deleteSubGroupFromGroup(n,t);this.showNotifications("deleteSubgroup",r,t.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addSubgroupToGroup(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n)if(n.uuid!==t.uuid){const r=this.groupDataService.addSubGroupToGroup(n,t);this.showNotifications("addSubgroup",r,t.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.subgroupToAddIsActiveGroup"));else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){const n=t.query;null!=n&&this.currentSearchQuery!==n&&(this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLink(this.groupBeingEdited)),this.currentSearchQuery=n,this.configSearch.currentPage=1),this.searchDone=!0,this.unsubFrom(J.SearchResults),this.subs.set(J.SearchResults,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,g.w)(r=>this.groupDataService.searchGroups(this.currentSearchQuery,{currentPage:r.currentPage,elementsPerPage:r.pageSize},!0,!0,(0,Q.l)("object")))).subscribe(r=>{this.searchResults$.next(r)}))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,r,a){n.pipe((0,c.hC)()).subscribe(d=>{d.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:r})),this.groupDataService.clearGroupLinkRequests(a._links.subgroups.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:r}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.O),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(m.qu),e.\u0275\u0275directiveInject(O.N),e.\u0275\u0275directiveInject(P.F0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-subgroups-list"]],inputs:{messagePrefix:"messagePrefix"},decls:31,vars:28,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group","mr-3"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary","float-right",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groupsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm deleteButton",3,"title","click",4,"ngIf"],[4,"ngIf"],["class","btn btn-outline-primary btn-sm addButton",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm","deleteButton",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm","addButton",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","subgroupsOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h3",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"h4",1),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(8,"div",3)(9,"div",4),e.\u0275\u0275element(10,"input",5),e.\u0275\u0275elementStart(11,"span",6)(12,"button",7),e.\u0275\u0275element(13,"i",8),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(16,"div")(17,"button",9),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(20,lt,22,24,"ds-pagination",10),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275template(22,pt,3,3,"div",11),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementStart(24,"h4"),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,ut,22,24,"ds-pagination",10),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275template(29,mt,3,3,"div",11),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275elementContainerEnd()),2&t){let r,a,d,v;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,10,n.messagePrefix+".head")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,12,n.messagePrefix+".search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(15,14,n.messagePrefix+".search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,16,n.messagePrefix+".button.see-all")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(21,18,n.searchResults$))||null==r.payload?null:r.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(23,20,n.searchResults$))||null==a.payload?null:a.payload.totalElements)&&n.searchDone),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,22,n.messagePrefix+".headSubgroups")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(d=e.\u0275\u0275pipeBind1(28,24,n.subGroups$))||null==d.payload?null:d.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(v=e.\u0275\u0275pipeBind1(30,26,n.subGroups$))||null==v.payload?null:v.payload.totalElements))}},directives:[m._Y,m.JL,m.sg,m.Fj,m.JJ,m.u,u.O5,E.Q,u.sg,P.yS],pipes:[L.X$,u.Ov],encapsulation:2}),i})();function gt(i,s){1&i&&e.\u0275\u0275element(0,"div")}function ft(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h2",14),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".head.create"))}}function ht(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h2",14),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".head.edit"))}}function vt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-alert",15),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("type",t.AlertTypeEnum.Warning)("content",t.messagePrefix+".alert.permanent")}}const bt=function(i,s,t){return{name:i,comcol:s,comcolEditRolesRoute:t}};function St(i,s){if(1&i&&(e.\u0275\u0275element(0,"ds-alert",15),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async")),2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275property("type",t.AlertTypeEnum.Warning)("content",e.\u0275\u0275pipeBind2(1,2,t.messagePrefix+".alert.workflowGroup",e.\u0275\u0275pureFunction3(11,bt,null==(n=e.\u0275\u0275pipeBind1(2,5,t.getLinkedDSO(t.groupBeingEdited)))||null==n.payload?null:n.payload.name,null==(n=e.\u0275\u0275pipeBind1(3,7,t.getLinkedDSO(t.groupBeingEdited)))||null==n.payload?null:n.payload.type,e.\u0275\u0275pipeBind1(4,9,t.getLinkedEditRolesRoute(t.groupBeingEdited)))))}}function _t(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",16)(1,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().delete()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275element(3,"i",18),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(2,2,t.canEdit$)||t.groupBeingEdited.permanent),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,4,t.messagePrefix+".actions.delete")," ")}}function xt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-members-list",19),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("messagePrefix",t.messagePrefix+".members-list")}}function yt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-subgroups-list",19),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("messagePrefix",t.messagePrefix+".subgroups-list")}}let ve=(()=>{class i{constructor(t,n,r,a,d,v,y,h,V,A,ee,pe){this.groupDataService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=r,this.formBuilderService=a,this.translateService=d,this.notificationsService=v,this.route=y,this.router=h,this.authorizationService=V,this.modalService=A,this.requestService=ee,this.changeDetectorRef=pe,this.messagePrefix="admin.access-control.groups.form",this.formId="group-form",this.formLayout={groupName:{grid:{host:"row"}},groupDescription:{grid:{host:"row"}}},this.submitForm=new e.EventEmitter,this.cancelForm=new e.EventEmitter,this.subs=[],this.AlertTypeEnum=Qe.N}ngOnInit(){this.initialisePage()}initialisePage(){this.subs.push(this.route.params.subscribe(t=>{"newGroup"!==t.groupId&&this.setActiveGroup(t.groupId)})),this.canEdit$=this.groupDataService.getActiveGroup().pipe((0,p.tz)(),(0,g.w)(t=>(0,S.a)(this.authorizationService.isAuthorized(I.i.CanDelete,(0,p.UE)(t)?t.self:void 0),this.hasLinkedDSO(t),(n,r)=>n&&!r))),(0,S.a)(this.translateService.get(`${this.messagePrefix}.groupName`),this.translateService.get(`${this.messagePrefix}.groupCommunity`),this.translateService.get(`${this.messagePrefix}.groupDescription`)).subscribe(([t,n,r])=>{this.groupName=new H.b1u({id:"groupName",label:t,name:"groupName",validators:{required:null},required:!0}),this.groupCommunity=new H.b1u({id:"groupCommunity",label:n,name:"groupCommunity",required:!1,readOnly:!0}),this.groupDescription=new H.HBf({id:"groupDescription",label:r,name:"groupDescription",required:!1}),this.formModel=[this.groupName,this.groupDescription],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.formGroup.controls.groupName&&(this.formGroup.controls.groupName.setAsyncValidators(class We{static createValidator(s){return t=>s.searchGroups(t.value,{currentPage:1,elementsPerPage:100}).pipe((0,c.LQ)(),(0,b.U)(n=>n.filter(r=>r.name===t.value)),(0,b.U)(n=>n.length>0?{groupExists:!0}:null))}}.createValidator(this.groupDataService)),this.groupNameValueChangeSubscribe=this.groupName.valueChanges.pipe((0,te.b)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()})),this.subs.push((0,S.a)(this.groupDataService.getActiveGroup(),this.canEdit$,this.groupDataService.getActiveGroup().pipe((0,Ue.h)(a=>(0,p.Uh)(a)),(0,g.w)(a=>this.getLinkedDSO(a).pipe((0,c.Gp)())))).subscribe(([a,d,v])=>{var y;null!=a&&(this.formGroup.controls.groupName.clearAsyncValidators(),this.groupBeingEdited=a,(null==v?void 0:v.name)?(this.formBuilderService.insertFormGroupControl(1,this.formGroup,this.formModel,this.groupCommunity),this.formGroup.patchValue({groupName:a.name,groupCommunity:null!==(y=null==v?void 0:v.name)&&void 0!==y?y:"",groupDescription:a.firstMetadataValue("dc.description")})):(this.formModel=[this.groupName,this.groupDescription],this.formGroup.patchValue({groupName:a.name,groupDescription:a.firstMetadataValue("dc.description")})),setTimeout(()=>{(!d||a.permanent)&&this.formGroup.disable()},200))}))})}onCancel(){this.groupDataService.cancelEditGroup(),this.cancelForm.emit(),this.router.navigate([this.groupDataService.getGroupRegistryRouterLink()])}onSubmit(){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(t=>{null===t?this.createNewGroup({name:this.groupName.value,metadata:{"dc.description":[{value:this.groupDescription.value}]}}):this.editGroup(t)})}createNewGroup(t){const n=Object.assign(new Ve.Z,t);this.groupDataService.create(n).pipe((0,c.hC)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.created.success",{name:n.name})),this.submitForm.emit(n),(0,p.UE)(r.payload)&&(this.setActiveGroupWithLink(r.payload._links.self.href),this.groupDataService.clearGroupsRequests(),this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLinkWithID(r.payload.uuid)))):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.created.failure",{name:n.name})),this.showNotificationIfNameInUse(n,"created"),this.cancelForm.emit())})}showNotificationIfNameInUse(t,n){this.subs.push(this.groupDataService.searchGroups(t.name,{currentPage:1,elementsPerPage:0}).pipe((0,c.xw)(),(0,c.xe)()).subscribe(r=>{r.totalElements>0&&this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification."+n+".failure.groupNameInUse",{name:t.name}))}))}editGroup(t){let n=[];(0,p.Uh)(this.groupDescription.value)&&(n=[...n,{op:"replace",path:"/metadata/dc.description/0/value",value:this.groupDescription.value}]),(0,p.Uh)(this.groupName.value)&&(n=[...n,{op:"replace",path:"/name",value:this.groupName.value}]),this.groupDataService.patch(t,n).pipe((0,c.hC)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.edited.success",{name:r.payload.name})),this.submitForm.emit(r.payload)):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.edited.failure",{name:t.name})),this.cancelForm.emit())})}setActiveGroup(t){this.groupDataService.cancelEditGroup(),this.groupDataService.findById(t).pipe((0,c.xw)(),(0,c.xe)()).subscribe(n=>{this.groupDataService.editGroup(n)})}setActiveGroupWithLink(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{null===n&&(this.groupDataService.cancelEditGroup(),this.groupDataService.findByHref(t,!1,!1,(0,Q.l)("subgroups"),(0,Q.l)("epersons"),(0,Q.l)("object")).pipe((0,c.xw)(),(0,c.xe)()).subscribe(r=>{this.groupDataService.editGroup(r)}))})}delete(){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(t=>{const n=this.modalService.open(C.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel=this.messagePrefix+".delete-group.modal.header",n.componentInstance.infoLabel=this.messagePrefix+".delete-group.modal.info",n.componentInstance.cancelLabel=this.messagePrefix+".delete-group.modal.cancel",n.componentInstance.confirmLabel=this.messagePrefix+".delete-group.modal.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,f.q)(1)).subscribe(r=>{r&&(0,p.Uh)(t.id)&&this.groupDataService.delete(t.id).pipe((0,c.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.deleted.success",{name:t.name})),this.onCancel()):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.deleted.failure.title",{name:t.name}),this.translateService.get(this.messagePrefix+".notification.deleted.failure.content",{cause:a.errorMessage}))})})})}ngOnDestroy(){this.groupDataService.cancelEditGroup(),this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe()),(0,p.Uh)(this.groupNameValueChangeSubscribe)&&this.groupNameValueChangeSubscribe.unsubscribe()}hasLinkedDSO(t){if((0,p.Uh)(t)&&(0,p.Uh)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,b.U)(n=>(0,p.Uh)(n)&&(0,p.Uh)(n.payload)),(0,de.K)(()=>(0,G.of)(!1)))}getLinkedDSO(t){if((0,p.Uh)(t)&&(0,p.Uh)(t._links.object.href))return void 0===t.object?this.dSpaceObjectDataService.findByHref(t._links.object.href):t.object}getLinkedEditRolesRoute(t){if((0,p.Uh)(t)&&(0,p.Uh)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,b.U)(n=>{if((0,p.Uh)(n)&&(0,p.Uh)(n.payload))switch(n.payload.type){case He.S.type.value:return(0,ke.eq)(n.payload.id);case ze.F.type.value:return(0,Ne.Po)(n.payload.id)}}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.O),e.\u0275\u0275directiveInject(j.k),e.\u0275\u0275directiveInject(ge.D),e.\u0275\u0275directiveInject($.c),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(P.gz),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(N._),e.\u0275\u0275directiveInject(q.FF),e.\u0275\u0275directiveInject(F.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-group-form"]],hostBindings:function(t,n){1&t&&e.\u0275\u0275listener("beforeunload",function(){return n.ngOnDestroy()},!1,e.\u0275\u0275resolveWindow)},outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:23,vars:22,consts:[[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"type","content",4,"ngIf"],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["after","","class","btn-group",4,"ngIf"],[1,"mb-5"],[3,"messagePrefix",4,"ngIf"],[1,"border-bottom","pb-2"],[3,"type","content"],["after","",1,"btn-group"],[1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fa","fa-trash"],[3,"messagePrefix"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275template(3,gt,1,0,"div",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,ft,3,3,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(7,ht,3,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(9,vt,1,2,"ds-alert",6),e.\u0275\u0275template(10,St,5,15,"ds-alert",6),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementStart(13,"ds-form",7),e.\u0275\u0275listener("submitForm",function(){return n.onSubmit()}),e.\u0275\u0275elementStart(14,"div",8)(15,"button",9),e.\u0275\u0275listener("click",function(){return n.onCancel()}),e.\u0275\u0275element(16,"i",10),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(19,_t,6,6,"div",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",12),e.\u0275\u0275template(21,xt,1,1,"ds-members-list",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,yt,1,1,"ds-subgroups-list",13),e.\u0275\u0275elementEnd()()()),2&t){const r=e.\u0275\u0275reference(6),a=e.\u0275\u0275reference(8);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,14,n.groupDataService.getActiveGroup()))("ngIfThen",a)("ngIfElse",r),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",null==n.groupBeingEdited?null:n.groupBeingEdited.permanent),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,16,n.canEdit$)&&e.\u0275\u0275pipeBind1(12,18,n.groupDataService.getActiveGroup())),e.\u0275\u0275advance(3),e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formGroup",n.formGroup)("formLayout",n.formLayout)("displayCancel",!1),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,20,n.messagePrefix+".return"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited)}},directives:[u.O5,Je.w,k.U,m.JL,m.sg,it,dt],pipes:[u.Ov,L.X$],encapsulation:2}),i})();var Pt=o(18505);class It{}var Et=o(9168);function Ct(i,s){1&i&&e.\u0275\u0275element(0,"ds-loading")}const be=function(i){return{name:i}};function Bt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"button",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",31),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,2,n.messagePrefix+"table.edit.buttons.edit",e.\u0275\u0275pureFunction1(5,be,t.group.name))),e.\u0275\u0275property("routerLink",n.groupService.getGroupEditPageRouterLink(t.group))}}function Ft(i,s){1&i&&(e.\u0275\u0275elementStart(0,"button",32),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",31),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("disabled",!0)("ngbTooltip",e.\u0275\u0275pipeBind1(1,2,"admin.access-control.epeople.table.edit.buttons.edit-disabled"))}function Dt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",33),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",34),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+"table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,be,t.group.name)))}}function Gt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"tr")(1,"td"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td")(11,"div",25),e.\u0275\u0275elementContainerStart(12,26),e.\u0275\u0275template(13,Bt,3,7,"button",27),e.\u0275\u0275template(14,Ft,3,4,"button",28),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(15,Dt,3,6,"button",29),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit;let n;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.group.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.group.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(n=e.\u0275\u0275pipeBind1(7,8,t.group.object))||null==n.payload?null:n.payload.name),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate((null==t.epersons?null:t.epersons.totalElements)+(null==t.subgroups?null:t.subgroups.totalElements)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngSwitch",t.ableToEdit),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",!0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",!1),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null!=t.group&&t.group.permanent)&&t.ableToDelete)}}function Tt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",20),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th",23),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",23),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",23),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"th",23),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"th"),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(21,"tbody"),e.\u0275\u0275template(22,Gt,16,10,"tr",24),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",t.pageInfoState$)("collectionSize",null==(n=e.\u0275\u0275pipeBind1(1,11,t.pageInfoState$))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,13,t.messagePrefix+"table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,15,t.messagePrefix+"table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,17,t.messagePrefix+"table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,19,t.messagePrefix+"table.members")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(20,21,t.messagePrefix+"table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(23,23,t.groupsDto$))?null:r.page)}}function wt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",35),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+"no-items")," ")}}const Ot=function(){return["newGroup"]};let Lt=(()=>{class i{constructor(t,n,r,a,d,v,y,h,V,A,ee){this.groupService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=r,this.translateService=a,this.notificationsService=d,this.formBuilder=v,this.routeService=y,this.router=h,this.authorizationService=V,this.paginationService=A,this.requestService=ee,this.messagePrefix="admin.access-control.groups.",this.config=Object.assign(new U.r,{id:"gl",pageSize:5,currentPage:1}),this.groupsDto$=new x.X({}),this.deletedGroupsIds=[],this.pageInfoState$=new x.X(void 0),this.loading$=new x.X(!1),this.subs=[],this.currentSearchQuery="",this.searchForm=this.formBuilder.group({query:this.currentSearchQuery})}ngOnInit(){this.search({query:this.currentSearchQuery})}search(t){(0,p.Uh)(this.searchSub)&&(this.searchSub.unsubscribe(),this.subs=this.subs.filter(n=>n!==this.searchSub)),this.searchSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,Pt.b)(()=>this.loading$.next(!0)),(0,g.w)(n=>{const r=t.query;return null!=r&&this.currentSearchQuery!==r&&(this.currentSearchQuery=r,this.paginationService.updateRouteWithUrl(this.config.id,[],{page:1})),this.groupService.searchGroups(this.currentSearchQuery.trim(),{currentPage:n.currentPage,elementsPerPage:n.pageSize},!0,!0,(0,Q.l)("object"))}),(0,c.g1)(),(0,c.xe)(),(0,g.w)(n=>0===n.page.length?(0,G.of)((0,M.b)(n.pageInfo,[])):this.authorizationService.isAuthorized(I.i.AdministratorOf).pipe((0,g.w)(r=>(0,S.a)(n.page.map(a=>{if((0,p.Uh)(a)&&!this.deletedGroupsIds.includes(a.id))return(0,S.a)([this.authorizationService.isAuthorized(I.i.CanDelete,a.self),this.canManageGroup$(r,a),this.hasLinkedDSO(a),this.getSubgroups(a),this.getMembers(a)]).pipe((0,b.U)(([d,v,y,h,V])=>{const A=new It;return A.ableToDelete=d&&!y,A.ableToEdit=v,A.group=a,A.subgroups=h.payload,A.epersons=V.payload,A}))})).pipe((0,b.U)(a=>(0,M.b)(n.pageInfo,a))))))).subscribe(n=>{this.groupsDto$.next(n),this.pageInfoState$.next(n.pageInfo),this.loading$.next(!1)}),this.subs.push(this.searchSub)}canManageGroup$(t,n){return t?(0,G.of)(!0):this.authorizationService.isAuthorized(I.i.CanManageGroup,n.self)}deleteGroup(t){(0,p.Uh)(t.group.id)&&this.groupService.delete(t.group.id).pipe((0,c.hC)()).subscribe(n=>{n.hasSucceeded?(this.deletedGroupsIds=[...this.deletedGroupsIds,t.group.id],this.notificationsService.success(this.translateService.get(this.messagePrefix+"notification.deleted.success",{name:t.group.name}))):this.notificationsService.error(this.translateService.get(this.messagePrefix+"notification.deleted.failure.title",{name:t.group.name}),this.translateService.get(this.messagePrefix+"notification.deleted.failure.content",{cause:n.errorMessage}))})}getMembers(t){return this.ePersonDataService.findAllByHref(t._links.epersons.href).pipe((0,c.xw)())}getSubgroups(t){return this.groupService.findAllByHref(t._links.subgroups.href).pipe((0,c.xw)())}hasLinkedDSO(t){return this.dSpaceObjectDataService.findByHref(t._links.object.href).pipe((0,c.xw)(),(0,b.U)(n=>(0,p.Uh)(n)&&(0,p.Uh)(n.payload)),(0,de.K)(()=>(0,G.of)(!1)))}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){(0,p.Uh)(this.paginationSub)&&this.paginationSub.unsubscribe(),this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(K.O),e.\u0275\u0275directiveInject(j.k),e.\u0275\u0275directiveInject(ge.D),e.\u0275\u0275directiveInject(L.sK),e.\u0275\u0275directiveInject(z.T),e.\u0275\u0275directiveInject(m.qu),e.\u0275\u0275directiveInject(Et.MZ),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(N._),e.\u0275\u0275directiveInject(O.N),e.\u0275\u0275directiveInject(F.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-groups-registry"]],decls:38,vars:35,consts:[[1,"container"],[1,"groups-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn-group","edit-field"],[3,"ngSwitch"],["class","btn btn-outline-primary btn-sm btn-edit",3,"routerLink","title",4,"ngSwitchCase"],["class","btn btn-outline-primary btn-sm btn-edit","placement","left",3,"disabled","ngbTooltip",4,"ngSwitchCase"],["class","btn btn-outline-danger btn-sm btn-delete",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["placement","left",1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"disabled","ngbTooltip"],[1,"btn","btn-outline-danger","btn-sm","btn-delete",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div")(8,"button",5),e.\u0275\u0275element(9,"i",6),e.\u0275\u0275elementStart(10,"span",7),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(13,"h3",8),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"form",9),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(17,"div",10)(18,"div",11),e.\u0275\u0275element(19,"input",12),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementStart(22,"span",13)(23,"button",14),e.\u0275\u0275element(24,"i",15),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(27,"div")(28,"button",16),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(31,Ct,1,0,"ds-loading",17),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275template(33,Tt,24,25,"ds-pagination",18),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275pipe(35,"async"),e.\u0275\u0275template(36,wt,3,3,"div",19),e.\u0275\u0275pipe(37,"async"),e.\u0275\u0275elementEnd()()()),2&t){let r,a;e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,12,n.messagePrefix+"head")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction0(34,Ot)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,14,n.messagePrefix+"button.add")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,16,n.messagePrefix+"search.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(21,20,n.messagePrefix+"search.placeholder")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(20,18,n.messagePrefix+"search.placeholder")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,22,n.messagePrefix+"search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(30,24,n.messagePrefix+"button.see-all")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(32,26,n.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(34,28,n.pageInfoState$))?null:r.totalElements)>0&&!e.\u0275\u0275pipeBind1(35,30,n.loading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(37,32,n.pageInfoState$))?null:a.totalElements))}},directives:[P.rH,m._Y,m.JL,m.sg,m.Fj,m.JJ,m.u,u.O5,_.N,E.Q,u.sg,u.RF,u.n9,q._L],pipes:[L.X$,u.Ov],encapsulation:2}),i})();var le=o(71725),ie=o(84186),Rt=o(29616),Mt=o(3592);let $t=(()=>{class i extends Rt.I{constructor(t,n,r,a){super(n,r,a),this.halEndpointService=t,this.authorizationService=n,this.router=r,this.authService=a,this.groupsEndpoint="groups"}getFeatureIDs(t,n){return(0,G.of)([I.i.CanManageGroup])}getObjectUrl(t,n){return this.halEndpointService.getEndpoint(this.groupsEndpoint).pipe((0,b.U)(r=>{var a;return`${r}/${null===(a=null==t?void 0:t.params)||void 0===a?void 0:a.groupId}`}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(Mt.q),e.\u0275\u0275inject(N._),e.\u0275\u0275inject(P.F0),e.\u0275\u0275inject(Z.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Se=o(44025),jt=o(70711);let At=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[P.Bz.forChild([{path:"epeople",component:Ae,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.epeople.title",breadcrumbKey:"admin.access-control.epeople"},canActivate:[jt.X]},{path:le.CH,component:Lt,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.groups.title",breadcrumbKey:"admin.access-control.groups"},canActivate:[Se.E]},{path:`${le.CH}/newGroup`,component:ve,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.groups.title.addGroup",breadcrumbKey:"admin.access-control.groups.addGroup"},canActivate:[Se.E]},{path:`${le.CH}/:groupId`,component:ve,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.groups.title.singleGroup",breadcrumbKey:"admin.access-control.groups.singleGroup"},canActivate:[$t]}])]]}),i})();var Ut=o(83429);let Nt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[u.ez,l.m,P.Bz,At,Ut.e]]}),i})()},53982:(Y,w,o)=>{o.d(w,{a:()=>u});class u{constructor(l,x){this.text=l,this.url=x}}},84186:(Y,w,o)=>{o.d(w,{t:()=>S});var u=o(38475),P=o(1272),l=o(5e3),x=o(55633);let S=(()=>{class g{constructor(f){this.breadcrumbService=f}resolve(f,M){const j=f.data.breadcrumbKey;if((0,u.xI)(j))throw new Error('You provided an i18nBreadcrumbResolver for url "'+f.url+"\" but no breadcrumbKey in the route's data");const p=(0,P.i)(f);return{provider:this.breadcrumbService,key:j,url:p}}}return g.\u0275fac=function(f){return new(f||g)(l.\u0275\u0275inject(x.d))},g.\u0275prov=l.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},55633:(Y,w,o)=>{o.d(w,{d:()=>S});var u=o(53982),P=o(39646),l=o(5e3);let S=(()=>{class g{getBreadcrumbs(f,M){return(0,P.of)([new u.a(f+".breadcrumbs",M)])}}return g.\u0275fac=function(f){return new(f||g)},g.\u0275prov=l.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},59038:(Y,w,o)=>{o.d(w,{m:()=>X});var u=o(64025),P=o(3592),l=o(71776),x=o(39300),S=o(54004),g=o(40367),b=o(38475),f=o(2779),M=o(46283),j=o(33890),p=o(5e3);let z=(()=>{class I{parse(c,C){const F=C.payload,D=Object.assign(new f.Y,F);return new j.tp(C.statusCode,void 0,D)}}return I.\u0275fac=function(c){return new(c||I)},I.\u0275prov=p.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"}),I})();var U=o(96530);let X=(()=>{class I{constructor(c,C,F){this.requestService=c,this.rdbService=C,this.halService=F,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(c){return this.halService.getEndpoint(this.linkPath).pipe((0,x.h)(C=>(0,b.UE)(C)),(0,S.U)(C=>`${C}${this.searchByTokenPath}${c}`))}registerEmail(c){const C=new f.Y;C.email=c;const F=this.requestService.generateRequestId();return this.getRegistrationEndpoint().pipe((0,g.s)(O=>(0,b.Uh)(O)),(0,S.U)(O=>{const e=new l.xo(F,O,C);this.requestService.send(e)})).subscribe(),this.rdbService.buildFromRequestUUID(F).pipe((0,M.hC)())}searchByToken(c){const C=this.requestService.generateRequestId(),F=this.getTokenSearchEndpoint(c).pipe((0,g.s)(D=>(0,b.Uh)(D)));return F.subscribe(D=>{const O=new l.Gl(C,D);Object.assign(O,{getResponseParser:()=>z}),this.requestService.send(O,!0)}),this.rdbService.buildSingle(F).pipe((0,S.U)(D=>D.hasSucceeded&&(0,b.Uh)(D.payload)?Object.assign(D,{payload:Object.assign(D.payload,{token:c})}):D))}}return I.\u0275fac=function(c){return new(c||I)(p.\u0275\u0275inject(u.s),p.\u0275\u0275inject(U.Q),p.\u0275\u0275inject(P.q))},I.\u0275prov=p.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},83429:(Y,w,o)=>{o.d(w,{e:()=>re});var u=o(69808),P=o(50358),l=o(5e3),x=o(8108),S=o(19084);function g(B,k){if(1&B){const _=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"ds-dynamic-form-control-container",1),l.\u0275\u0275listener("dfBlur",function(R){l.\u0275\u0275restoreView(_);const T=l.\u0275\u0275nextContext();return T.onCustomEvent(R,T.blur)})("dfChange",function(R){l.\u0275\u0275restoreView(_);const T=l.\u0275\u0275nextContext();return T.onCustomEvent(R,T.change)})("dfFocus",function(R){l.\u0275\u0275restoreView(_);const T=l.\u0275\u0275nextContext();return T.onCustomEvent(R,T.focus)})("ngbEvent",function(R){l.\u0275\u0275restoreView(_);const T=l.\u0275\u0275nextContext();return T.onCustomEvent(R,T.ngbEvent)}),l.\u0275\u0275elementEnd()}if(2&B){const _=k.$implicit,E=l.\u0275\u0275nextContext();l.\u0275\u0275classProp("d-none",_.hidden),l.\u0275\u0275property("formId",E.formId)("group",E.formGroup)("hasErrorMessaging",_.hasErrorMessages)("hidden",_.hidden)("layout",E.formLayout)("model",_)("templates",E.templates)("asBootstrapFormGroup",!0)}}let b=(()=>{class B extends x.rmD{constructor(_,E){super(_,E),this.blur=new l.EventEmitter,this.change=new l.EventEmitter,this.focus=new l.EventEmitter,this.ngbEvent=new l.EventEmitter}}return B.\u0275fac=function(_){return new(_||B)(l.\u0275\u0275directiveInject(l.ChangeDetectorRef),l.\u0275\u0275directiveInject(x.rJA))},B.\u0275cmp=l.\u0275\u0275defineComponent({type:B,selectors:[["ds-dynamic-form"]],contentQueries:function(_,E,R){if(1&_&&l.\u0275\u0275contentQuery(R,x.ATj,4),2&_){let T;l.\u0275\u0275queryRefresh(T=l.\u0275\u0275loadQuery())&&(E.templates=T)}},viewQuery:function(_,E){if(1&_&&l.\u0275\u0275viewQuery(S.B,5),2&_){let R;l.\u0275\u0275queryRefresh(R=l.\u0275\u0275loadQuery())&&(E.components=R)}},inputs:{formId:"formId",formGroup:"formGroup",formModel:"formModel",formLayout:"formLayout"},outputs:{blur:"dfBlur",change:"dfChange",focus:"dfFocus",ngbEvent:"ngbEvent"},features:[l.\u0275\u0275InheritDefinitionFeature],decls:1,vars:2,consts:[[3,"formId","group","hasErrorMessaging","hidden","d-none","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent"]],template:function(_,E){1&_&&l.\u0275\u0275template(0,g,1,10,"ds-dynamic-form-control-container",0),2&_&&l.\u0275\u0275property("ngForOf",E.formModel)("ngForTrackBy",E.trackByFn)},directives:[u.sg,S.B],encapsulation:2}),B})();o(43714),o(6084),o(71673),o(56804),o(46047),o(59072),o(20771),o(96153),o(93181);var c=o(77778),C=o(11860),L=(o(72816),o(26625),o(26690),o(8756),o(42501)),m=o(86956),q=o(53956),ne=(o(13821),o(26076),o(99069),o(55741),o(65806)),$=o(93075),Z=o(21283);let re=(()=>{class B{}return B.\u0275fac=function(_){return new(_||B)},B.\u0275mod=l.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=l.\u0275\u0275defineInjector({providers:[{provide:x.y8$,useValue:S._}],imports:[[u.ez,x.H9g,ne.zj,q.t,L.m,m.aw]]}),B})();l.\u0275\u0275setComponentScope(c.i,[$.JL,$.sg,$.x0,u.mk,u.sg,S.B],[]),l.\u0275\u0275setComponentScope(C.s,[$.JL,$.sg,$.CE,u.mk,Z.Wj,u.sg,Z.Zt,Z.Bh,$.x0,u.tP,S.B],[]),l.\u0275\u0275setComponentScope(P.U,[$._Y,$.JL,$.sg,b,x.ATj,u.O5],[m.X$,u.Ov])}}]);