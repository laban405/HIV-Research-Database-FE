"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5159],{84186:(N,x,r)=>{r.d(x,{t:()=>I});var t=r(38475),O=r(1272),P=r(5e3),C=r(55633);let I=(()=>{class v{constructor(a){this.breadcrumbService=a}resolve(a,U){const E=a.data.breadcrumbKey;if((0,t.xI)(E))throw new Error('You provided an i18nBreadcrumbResolver for url "'+a.url+"\" but no breadcrumbKey in the route's data");const n=(0,O.i)(a);return{provider:this.breadcrumbService,key:E,url:n}}}return v.\u0275fac=function(a){return new(a||v)(P.\u0275\u0275inject(C.d))},v.\u0275prov=P.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},55633:(N,x,r)=>{r.d(x,{d:()=>I});var t=r(53982),O=r(39646),P=r(5e3);let I=(()=>{class v{getBreadcrumbs(a,U){return(0,O.of)([new t.a(a+".breadcrumbs",U)])}}return v.\u0275fac=function(a){return new(a||v)},v.\u0275prov=P.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},43772:(N,x,r)=>{r.d(x,{M0:()=>t,Pu:()=>O,X$:()=>P,dI:()=>C,kJ:()=>I,Gr:()=>v,N:()=>T});const t="withdraw",O="reinstate",P="private",C="public",I="delete",v="move",T="authorizations"},22349:(N,x,r)=>{r.d(x,{v:()=>h});var t=r(61135),O=r(54004),P=r(95698),C=r(58134),I=r(55489),v=r(43772),T=r(46283),a=r(5e3),U=r(63782),E=r(74202),n=r(86956),_=r(13344);let h=(()=>{class D{constructor(f,M,g,B,W,y){this.dsoNameService=f,this.notificationsService=M,this.resourcePolicyService=g,this.route=B,this.router=W,this.translate=y,this.processing$=new t.X(!1)}ngOnInit(){this.route.data.pipe((0,O.U)(f=>f),(0,P.q)(1)).subscribe(f=>{this.targetResourceUUID=f.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(f.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${v.N}`],{relativeTo:this.route})}createResourcePolicy(f){let M;this.processing$.next(!0),M="eperson"===f.target.type?this.resourcePolicyService.create(f.object,this.targetResourceUUID,f.target.uuid):this.resourcePolicyService.create(f.object,this.targetResourceUUID,null,f.target.uuid),M.pipe((0,T.hC)()).subscribe(g=>{this.processing$.next(!1),g.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}}return D.\u0275fac=function(f){return new(f||D)(a.\u0275\u0275directiveInject(U._),a.\u0275\u0275directiveInject(I.T),a.\u0275\u0275directiveInject(C.Z),a.\u0275\u0275directiveInject(E.gz),a.\u0275\u0275directiveInject(E.F0),a.\u0275\u0275directiveInject(n.sK))},D.\u0275cmp=a.\u0275\u0275defineComponent({type:D,selectors:[["ds-resource-policy-create"]],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"isProcessing","reset","submit"]],template:function(f,M){1&f&&(a.\u0275\u0275elementStart(0,"div",0)(1,"h4",1),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"ds-resource-policy-form",2),a.\u0275\u0275listener("reset",function(){return M.redirectToAuthorizationsPage()})("submit",function(B){return M.createResourcePolicy(B)}),a.\u0275\u0275elementEnd()()),2&f&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate2("",a.\u0275\u0275pipeBind1(3,3,"resource-policies.create.page.heading")," ",M.targetResourceName,""),a.\u0275\u0275advance(2),a.\u0275\u0275property("isProcessing",M.isProcessing()))},directives:[_.Z],pipes:[n.X$],encapsulation:2}),D})()},85286:(N,x,r)=>{r.d(x,{x:()=>K});var t=r(61135),O=r(39646),P=r(39841),C=r(54004),I=r(95698),v=r(58134),T=r(55489),a=r(38835),U=r(43772),E=r(46283),n=r(5e3),_=r(74202),h=r(86956),D=r(13344);let K=(()=>{class f{constructor(g,B,W,y,e){this.notificationsService=g,this.resourcePolicyService=B,this.route=W,this.router=y,this.translate=e,this.processing$=new t.X(!1)}ngOnInit(){this.route.data.pipe((0,C.U)(g=>g),(0,I.q)(1)).subscribe(g=>{this.resourcePolicy=g.resourcePolicy.payload})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${U.N}`],{relativeTo:this.route})}updateResourcePolicy(g){this.processing$.next(!0);const B=Object.assign({},g.object,{id:this.resourcePolicy.id,type:a.A.value,_links:this.resourcePolicy._links}),W=g.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,g.target.uuid,g.target.type).pipe((0,E.hC)(),(0,C.U)(e=>e&&e.hasSucceeded)):(0,O.of)(!0),y=this.resourcePolicyService.update(B).pipe((0,E.hC)(),(0,C.U)(e=>e&&e.hasSucceeded));(0,P.a)([W,y]).subscribe(([e,l])=>{this.processing$.next(!1),e&&l?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get(l?"resource-policies.edit.page.target-failure.content":e?"resource-policies.edit.page.other-failure.content":"resource-policies.edit.page.failure.content"))})}}return f.\u0275fac=function(g){return new(g||f)(n.\u0275\u0275directiveInject(T.T),n.\u0275\u0275directiveInject(v.Z),n.\u0275\u0275directiveInject(_.gz),n.\u0275\u0275directiveInject(_.F0),n.\u0275\u0275directiveInject(h.sK))},f.\u0275cmp=n.\u0275\u0275defineComponent({type:f,selectors:[["ds-resource-policy-edit"]],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"resourcePolicy","isProcessing","reset","submit"]],template:function(g,B){1&g&&(n.\u0275\u0275elementStart(0,"div",0)(1,"h4",1),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(4,"ds-resource-policy-form",2),n.\u0275\u0275listener("reset",function(){return B.redirectToAuthorizationsPage()})("submit",function(y){return B.updateResourcePolicy(y)}),n.\u0275\u0275elementEnd()()),2&g&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate2("",n.\u0275\u0275pipeBind1(3,4,"resource-policies.edit.page.heading")," ",B.resourcePolicy.id,""),n.\u0275\u0275advance(2),n.\u0275\u0275property("resourcePolicy",B.resourcePolicy)("isProcessing",B.isProcessing()))},directives:[D.Z],pipes:[h.X$],encapsulation:2}),f})()},46176:(N,x,r)=>{r.d(x,{W:()=>W});var t=r(5e3),O=r(61135),P=r(54004),C=r(17489),v=r(74293),T=r(38475),a=r(43568),U=r(690),E=r(10726),n=r(72031),_=r(46283),h=r(94799),D=r(36877),K=r(63782);function f(y,e){if(1&y){const l=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ds-eperson-search-box",3),t.\u0275\u0275listener("search",function(u){return t.\u0275\u0275restoreView(l),t.\u0275\u0275nextContext().onSearch(u)}),t.\u0275\u0275elementEnd()}}function M(y,e){if(1&y){const l=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ds-group-search-box",3),t.\u0275\u0275listener("search",function(u){return t.\u0275\u0275restoreView(l),t.\u0275\u0275nextContext().onSearch(u)}),t.\u0275\u0275elementEnd()}}function g(y,e){if(1&y){const l=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"tr"),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275elementStart(2,"td"),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"td"),t.\u0275\u0275text(5),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(6,"td",7)(7,"button",9),t.\u0275\u0275listener("click",function(){const b=t.\u0275\u0275restoreView(l).$implicit;return t.\u0275\u0275nextContext(2).emitSelect(b)}),t.\u0275\u0275text(8),t.\u0275\u0275pipe(9,"translate"),t.\u0275\u0275elementEnd()()()}if(2&y){const l=e.$implicit,c=t.\u0275\u0275nextContext(2);t.\u0275\u0275classProp("table-primary",t.\u0275\u0275pipeBind1(1,5,c.isSelected(l))),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(l.id),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(c.dsoNameService.getName(l)),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(9,7,"resource-policies.form.eperson-group-list.select.btn")," ")}}function B(y,e){if(1&y&&(t.\u0275\u0275elementStart(0,"ds-pagination",4),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275elementStart(2,"div",5)(3,"table",6)(4,"thead")(5,"tr",7)(6,"th"),t.\u0275\u0275text(7),t.\u0275\u0275pipe(8,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(9,"th"),t.\u0275\u0275text(10),t.\u0275\u0275pipe(11,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(12,"th"),t.\u0275\u0275text(13),t.\u0275\u0275pipe(14,"translate"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(15,"tbody"),t.\u0275\u0275template(16,g,10,9,"tr",8),t.\u0275\u0275pipe(17,"async"),t.\u0275\u0275elementEnd()()()()),2&y){const l=t.\u0275\u0275nextContext();let c,u;t.\u0275\u0275property("paginationOptions",l.paginationOptions)("collectionSize",null==(c=t.\u0275\u0275pipeBind1(1,8,l.getList()))||null==c.payload?null:c.payload.totalElements)("retainScrollPosition",!0)("hideGear",!0),t.\u0275\u0275advance(7),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(8,10,"resource-policies.form.eperson-group-list.table.headers.id")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(11,12,"resource-policies.form.eperson-group-list.table.headers.name")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(14,14,"resource-policies.form.eperson-group-list.table.headers.action")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",null==(u=t.\u0275\u0275pipeBind1(17,16,l.getList()))||null==u.payload?null:u.payload.page)}}let W=(()=>{class y{constructor(l,c,u){this.dsoNameService=l,this.parentInjector=c,this.paginationService=u,this.isListOfEPerson=!0,this.select=new t.EventEmitter,this.currentSearchQuery="",this.currentSearchScope="metadata",this.paginationOptions=new v.r,this.list$=new O.X({}),this.entrySelectedId=new O.X(""),this.subs=[]}ngOnInit(){const c=(0,a.p)(this.isListOfEPerson?U.U:E.o);this.dataService=t.Injector.create({providers:[],parent:this.parentInjector}).get(c),this.paginationOptions.id=(0,C.uniqueId)("egl"),this.paginationOptions.pageSize=5,this.initSelected&&this.entrySelectedId.next(this.initSelected),this.updateList(this.currentSearchScope,this.currentSearchQuery)}emitSelect(l){this.select.emit(l),this.entrySelectedId.next(l.id)}getList(){return this.list$.asObservable()}isSelected(l){return this.entrySelectedId.asObservable().pipe((0,P.U)(c=>(0,T.UE)(c)&&c===l.id))}onSearch(l){this.currentSearchQuery=l.query,this.currentSearchScope=l.scope,this.paginationService.resetPage(this.paginationOptions.id),this.updateList(this.currentSearchScope,this.currentSearchQuery)}updateList(l,c){(0,T.Uh)(this.pageConfigSub)&&this.pageConfigSub.unsubscribe(),this.pageConfigSub=this.paginationService.getCurrentPagination(this.paginationOptions.id,this.paginationOptions).subscribe(u=>{const b=Object.assign({},new D.R,{elementsPerPage:u.pageSize,currentPage:u.currentPage}),G=this.isListOfEPerson?this.dataService.searchByScope(l,c,b):this.dataService.searchGroups(c,b);this.subs.push(G.pipe((0,_.hC)()).subscribe(Y=>{(0,T.Uh)(this.list$)&&this.list$.next(Y)}))})}ngOnDestroy(){this.list$=null,this.subs.filter(l=>(0,T.Uh)(l)).forEach(l=>l.unsubscribe()),this.paginationService.clearPagination(this.paginationOptions.id)}}return y.\u0275fac=function(l){return new(l||y)(t.\u0275\u0275directiveInject(K._),t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(h.N))},y.\u0275cmp=t.\u0275\u0275defineComponent({type:y,selectors:[["ds-eperson-group-list"]],inputs:{isListOfEPerson:"isListOfEPerson",initSelected:"initSelected"},outputs:{select:"select"},decls:5,vars:6,consts:[[1,"mt-3"],[3,"search",4,"ngIf"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear",4,"ngIf"],[3,"search"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear"],[1,"table-responsive"],["id","groups",1,"table","table-sm","table-striped","table-hover","table-bordered"],[1,"text-center"],[3,"table-primary",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(l,c){if(1&l&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275template(1,f,1,0,"ds-eperson-search-box",1),t.\u0275\u0275template(2,M,1,0,"ds-group-search-box",1),t.\u0275\u0275template(3,B,18,18,"ds-pagination",2),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275elementEnd()),2&l){let u;t.\u0275\u0275property("@fadeInOut",void 0),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",c.isListOfEPerson),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!c.isListOfEPerson),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",(null==(u=t.\u0275\u0275pipeBind1(4,4,c.getList()))||null==u.payload?null:u.payload.totalElements)>0)}},styles:[""],data:{animation:[n.Ic]}}),y})()},13344:(N,x,r)=>{r.d(x,{Z:()=>H});var t=r(5e3),O=r(39646),P=r(61135),C=r(39841),I=r(54004),v=r(39300),T=r(95698),a=r(8108),U=r(27377),E=r(97137),n=(()=>{return(d=n||(n={})).TYPE_SUBMISSION="TYPE_SUBMISSION",d.TYPE_WORKFLOW="TYPE_WORKFLOW",d.TYPE_INHERITED="TYPE_INHERITED",d.TYPE_CUSTOM="TYPE_CUSTOM",n;var d})(),_=(()=>{return(d=_||(_={})).READ="READ",d.WRITE="WRITE",d.DELETE="DELETE",d.ADD="ADD",d.REMOVE="REMOVE",d[d.WORKFLOW_STEP_1=5]="WORKFLOW_STEP_1",d[d.WORKFLOW_STEP_2=6]="WORKFLOW_STEP_2",d[d.WORKFLOW_STEP_3=7]="WORKFLOW_STEP_3",d[d.WORKFLOW_ABORT=8]="WORKFLOW_ABORT",d.DEFAULT_BITSTREAM_READ="DEFAULT_BITSTREAM_READ",d.DEFAULT_ITEM_READ="DEFAULT_ITEM_READ",d.ADMIN="ADMIN",d.WITHDRAWN_READ="WITHDRAWN_READ",_;var d})();const h=[{label:n.TYPE_SUBMISSION,value:n.TYPE_SUBMISSION},{label:n.TYPE_WORKFLOW,value:n.TYPE_WORKFLOW},{label:n.TYPE_INHERITED,value:n.TYPE_INHERITED},{label:n.TYPE_CUSTOM,value:n.TYPE_CUSTOM}],D=[{label:_.READ.toString(),value:_.READ},{label:_.WRITE.toString(),value:_.WRITE},{label:_.REMOVE.toString(),value:_.REMOVE},{label:_.ADMIN.toString(),value:_.ADMIN},{label:_.DELETE.toString(),value:_.DELETE},{label:_.WITHDRAWN_READ.toString(),value:_.WITHDRAWN_READ},{label:_.DEFAULT_BITSTREAM_READ.toString(),value:_.DEFAULT_BITSTREAM_READ},{label:_.DEFAULT_ITEM_READ.toString(),value:_.DEFAULT_ITEM_READ}],K={id:"name",label:"resource-policies.form.name.label",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},f={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},M={id:"policyType",label:"resource-policies.form.policy-type.label",options:h,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},g={id:"action",label:"resource-policies.form.action-type.label",options:D,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},B={id:"date",group:[]},W={element:{control:"form-row"}},y={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},e={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},l={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},c={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}};var u=r(85597),b=r(38475),G=r(57149),Y=r(38835),V=r(88155),J=r(20789),Q=r(17967),z=r(46283),Z=r(64025),w=r(63782),$=r(17656),X=r(69808),k=r(50358),q=r(46176),ee=r(86956);const te=["content"];function m(d,j){if(1&d&&t.\u0275\u0275element(0,"ds-form",16,17),2&d){const s=t.\u0275\u0275nextContext();t.\u0275\u0275property("formId",s.formId)("formModel",s.formModel)("displaySubmit",!1)("displayCancel",!1)}}function L(d,j){if(1&d){const s=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ds-eperson-group-list",18),t.\u0275\u0275listener("select",function(S){return t.\u0275\u0275restoreView(s),t.\u0275\u0275nextContext().updateObjectSelected(S,!0)}),t.\u0275\u0275elementEnd()}}function o(d,j){if(1&d){const s=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"ds-eperson-group-list",19),t.\u0275\u0275listener("select",function(S){return t.\u0275\u0275restoreView(s),t.\u0275\u0275nextContext().updateObjectSelected(S,!1)}),t.\u0275\u0275elementEnd()}2&d&&t.\u0275\u0275property("isListOfEPerson",!1)}function i(d,j){1&d&&(t.\u0275\u0275elementStart(0,"span"),t.\u0275\u0275element(1,"i",20),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()),2&d&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,1,"submission.workflow.tasks.generic.processing")," "))}function R(d,j){1&d&&(t.\u0275\u0275elementStart(0,"span"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()),2&d&&(t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(2,1,"form.submit")," "))}function F(d,j){if(1&d){const s=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",21)(1,"h4",22),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"button",23),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(s).$implicit.close()}),t.\u0275\u0275elementStart(5,"span",24),t.\u0275\u0275text(6,"\xd7"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(7,"div",25)(8,"div",26)(9,"div",27),t.\u0275\u0275element(10,"i",28),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(11,"div"),t.\u0275\u0275element(12,"p",29),t.\u0275\u0275pipe(13,"translate"),t.\u0275\u0275element(14,"p",30),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(16,"div",31)(17,"button",32),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(s).$implicit.close()}),t.\u0275\u0275text(18),t.\u0275\u0275pipe(19,"translate"),t.\u0275\u0275elementEnd()()}if(2&d){const s=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,4,"resource-policies.form.eperson-group-list.modal.header")),t.\u0275\u0275advance(10),t.\u0275\u0275property("innerHTML",t.\u0275\u0275pipeBind1(13,6,"eperson"===s.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),t.\u0275\u0275sanitizeHtml),t.\u0275\u0275advance(2),t.\u0275\u0275property("innerHTML",t.\u0275\u0275pipeBind1(15,8,"resource-policies.form.eperson-group-list.modal.text2"),t.\u0275\u0275sanitizeHtml),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(19,10,"resource-policies.form.eperson-group-list.modal.close"))}}let H=(()=>{class d{constructor(s,p,S,A,re,ne){this.dsoNameService=s,this.ePersonService=p,this.formService=S,this.groupService=A,this.requestService=re,this.modalService=ne,this.isProcessing=(0,O.of)(!1),this.reset=new t.EventEmitter,this.submit=new t.EventEmitter,this.resourcePolicyTargetName$=new P.X(""),this.subs=[],this.resourcePolicyTargetUpdated=!1}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){const s=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,z.xw)()),p=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,z.xw)()),S=(0,C.a)([s,p]).pipe((0,I.U)(A=>A.find(re=>(0,b.UE)(re.payload))),(0,b.tz)());this.subs.push(S.pipe((0,v.h)(()=>this.isActive)).subscribe(A=>{this.resourcePolicyGrant=A.payload,this.navActiveId=String(A.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,I.U)(s=>s&&(0,b.UE)(this.resourcePolicyGrant)))}buildResourcePolicyForm(){const s=[];s.push(new E.u(K),new u.D(f),new a.nMt(M),new a.nMt(g));const p=new a.oqv(y,e),S=new a.oqv(l,c),A=Object.assign({},B,{group:[]});return A.group.push(p,S),s.push(new a.S_O(A,W)),this.initModelsValue(s),s}initModelsValue(s){return this.resourcePolicy&&s.forEach(p=>{"date"===p.id?((0,b.Uh)(this.resourcePolicy.startDate)&&(p.get(0).value=(0,V.bj)(this.resourcePolicy.startDate)),(0,b.Uh)(this.resourcePolicy.endDate)&&(p.get(1).value=(0,V.bj)(this.resourcePolicy.endDate))):this.resourcePolicy.hasOwnProperty(p.id)&&this.resourcePolicy[p.id]&&(p.value=this.resourcePolicy[p.id])}),s}isBeingEdited(){return!(0,b.xb)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,b.UE)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(s,p){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=s,this.resourcePolicyGrantType=p?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}onSubmit(){this.formService.getFormData(this.formId).pipe((0,T.q)(1)).subscribe(s=>{const p=Object.create({});p.object=this.createResourcePolicyByFormData(s),p.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},p.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(p)})}createResourcePolicyByFormData(s){const p=new U.A;return p.name=s.name?s.name[0].value:null,p.description=s.description?s.description[0].value:null,p.policyType=s.policyType?s.policyType[0].value:null,p.action=s.action?s.action[0].value:null,p.startDate=s.date&&s.date.start?(0,V.iV)(s.date.start[0].value):null,p.endDate=s.date&&s.date.end?(0,V.iV)(s.date.end[0].value):null,p.type=Y.A,p}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(s=>(0,b.Uh)(s)).forEach(s=>s.unsubscribe())}onNavChange(s){this.isBeingEdited()&&(s.preventDefault(),this.modalService.open(this.content))}}return d.\u0275fac=function(s){return new(s||d)(t.\u0275\u0275directiveInject(w._),t.\u0275\u0275directiveInject(J.k),t.\u0275\u0275directiveInject(G.o),t.\u0275\u0275directiveInject(Q.O),t.\u0275\u0275directiveInject(Z.s),t.\u0275\u0275directiveInject($.FF))},d.\u0275cmp=t.\u0275\u0275defineComponent({type:d,selectors:[["ds-resource-policy-form"]],viewQuery:function(s,p){if(1&s&&t.\u0275\u0275viewQuery(te,5),2&s){let S;t.\u0275\u0275queryRefresh(S=t.\u0275\u0275loadQuery())&&(p.content=S.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},decls:38,vars:34,consts:[[3,"formId","formModel","displaySubmit","displayCancel",4,"ngIf"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],["ngbNav","",1,"nav-pills",3,"activeId","activeIdChange","navChange"],["nav","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"form-group","row"],[1,"col","text-right"],["type","reset",1,"btn","btn-default",3,"disabled","click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],["content",""],[3,"formId","formModel","displaySubmit","displayCancel"],["formRef","formComponent"],[3,"select"],[3,"isListOfEPerson","select"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"mr-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"font-weight-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(s,p){if(1&s&&(t.\u0275\u0275elementStart(0,"div"),t.\u0275\u0275template(1,m,2,4,"ds-form",0),t.\u0275\u0275elementStart(2,"div",1)(3,"label",2),t.\u0275\u0275text(4),t.\u0275\u0275pipe(5,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(6,"input",3),t.\u0275\u0275pipe(7,"async"),t.\u0275\u0275elementStart(8,"ul",4,5),t.\u0275\u0275listener("activeIdChange",function(A){return p.navActiveId=A})("navChange",function(A){return p.onNavChange(A)}),t.\u0275\u0275elementStart(10,"li",6)(11,"a",7),t.\u0275\u0275text(12),t.\u0275\u0275pipe(13,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(14,L,1,0,"ng-template",8),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(15,"li",6)(16,"a",7),t.\u0275\u0275text(17),t.\u0275\u0275pipe(18,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(19,o,1,1,"ng-template",8),t.\u0275\u0275elementEnd()(),t.\u0275\u0275element(20,"div",9),t.\u0275\u0275elementStart(21,"div"),t.\u0275\u0275element(22,"hr"),t.\u0275\u0275elementStart(23,"div",10)(24,"div",11)(25,"button",12),t.\u0275\u0275listener("click",function(){return p.onReset()}),t.\u0275\u0275pipe(26,"async"),t.\u0275\u0275text(27),t.\u0275\u0275pipe(28,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(29,"button",13),t.\u0275\u0275listener("click",function(){return p.onSubmit()}),t.\u0275\u0275pipe(30,"async"),t.\u0275\u0275pipe(31,"async"),t.\u0275\u0275template(32,i,4,3,"span",14),t.\u0275\u0275pipe(33,"async"),t.\u0275\u0275template(34,R,3,3,"span",14),t.\u0275\u0275pipe(35,"async"),t.\u0275\u0275elementEnd()()()()()(),t.\u0275\u0275template(36,F,20,12,"ng-template",null,15,t.\u0275\u0275templateRefExtractor)),2&s){const S=t.\u0275\u0275reference(9);t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",p.formModel),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(5,14,"resource-policies.form.eperson-group-list.label")),t.\u0275\u0275advance(2),t.\u0275\u0275property("value",t.\u0275\u0275pipeBind1(7,16,p.resourcePolicyTargetName$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("activeId",p.navActiveId),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngbNavItem","eperson"),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(13,18,"resource-policies.form.eperson-group-list.tab.eperson")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngbNavItem","group"),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(18,20,"resource-policies.form.eperson-group-list.tab.group")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngbNavOutlet",S),t.\u0275\u0275advance(5),t.\u0275\u0275property("disabled",t.\u0275\u0275pipeBind1(26,22,p.isProcessing)),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(28,24,"form.cancel")),t.\u0275\u0275advance(2),t.\u0275\u0275property("disabled",!t.\u0275\u0275pipeBind1(30,26,p.isFormValid())||t.\u0275\u0275pipeBind1(31,28,p.isProcessing)),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(33,30,p.isProcessing)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",!t.\u0275\u0275pipeBind1(35,32,p.isProcessing))}},directives:[X.O5,k.U,$.Pz,$.nv,$.Vx,$.uN,q.W,$.tO],pipes:[ee.X$,X.Ov],encapsulation:2}),d})()},16880:(N,x,r)=>{r.d(x,{a:()=>T});var t=r(5e3),O=r(43568),P=r(4905),C=r(38475),I=r(46283),v=r(74202);let T=(()=>{class a{constructor(E,n){this.parentInjector=E,this.router=n}resolve(E,n){const _=E.queryParamMap.get("targetType"),h=E.queryParamMap.get("policyTargetId");((0,C.xb)(_)||(0,C.xb)(h))&&this.router.navigateByUrl("/404",{skipLocationChange:!0});const D=(0,O.p)(new P._(_));return this.dataService=t.Injector.create({providers:[],parent:this.parentInjector}).get(D),this.dataService.findById(h).pipe((0,I.hC)())}}return a.\u0275fac=function(E){return new(E||a)(t.\u0275\u0275inject(t.Injector),t.\u0275\u0275inject(v.F0))},a.\u0275prov=t.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac}),a})()},41466:(N,x,r)=>{r.d(x,{b:()=>T});var t=r(38475),O=r(58134),P=r(18838),C=r(46283),I=r(5e3),v=r(74202);let T=(()=>{class a{constructor(E,n){this.resourcePolicyService=E,this.router=n}resolve(E,n){const _=E.queryParamMap.get("policyId");return(0,t.xb)(_)&&this.router.navigateByUrl("/404",{skipLocationChange:!0}),this.resourcePolicyService.findById(_,!0,!1,(0,P.l)("eperson"),(0,P.l)("group")).pipe((0,C.hC)())}}return a.\u0275fac=function(E){return new(E||a)(I.\u0275\u0275inject(O.Z),I.\u0275\u0275inject(v.F0))},a.\u0275prov=I.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac}),a})()},32369:(N,x,r)=>{r.d(x,{F:()=>te});var t=r(61135),O=r(50457),P=r(39300),C=r(70207),I=r(54004),v=r(71884),T=r(24351),a=r(22940),U=r(95698),E=r(68675),n=r(58134),_=r(46283),h=r(17967),D=r(38475),K=r(20789),f=r(64025),M=r(55489),g=r(88155),B=r(18838),W=r(63352),y=r(71725),e=r(5e3),l=r(63782),c=r(74202),u=r(86956),b=r(69808),G=r(42616),Y=r(93075);function V(m,L){if(1&m&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275elementContainerEnd()),2&m){const o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" (",o.resourceUUID,") ")}}function J(m,L){1&m&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",11),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&m&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"submission.workflow.tasks.generic.processing")," "))}function Q(m,L){1&m&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&m&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"resource-policies.delete.btn")," "))}function z(m,L){if(1&m){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr",13)(1,"th")(2,"div",14)(3,"input",15),e.\u0275\u0275listener("change",function(R){return e.\u0275\u0275restoreView(o),e.\u0275\u0275nextContext().selectAllCheckbox(R)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"label",16),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"th"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"th"),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"th"),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"th"),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"th"),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"th"),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"th"),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"th"),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"th"),e.\u0275\u0275text(30),e.\u0275\u0275pipe(31,"translate"),e.\u0275\u0275elementEnd()()}if(2&m){const o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("id","selectAll_"+o.resourceUUID),e.\u0275\u0275advance(1),e.\u0275\u0275property("for","selectAll_"+o.resourceUUID),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,11,"resource-policies.table.headers.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(10,13,"resource-policies.table.headers.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(13,15,"resource-policies.table.headers.policyType")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(16,17,"resource-policies.table.headers.action")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(19,19,"resource-policies.table.headers.eperson")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,21,"resource-policies.table.headers.group")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(25,23,"resource-policies.table.headers.date.start")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(28,25,"resource-policies.table.headers.date.end")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(31,27,"resource-policies.table.headers.edit"))}}function Z(m,L){if(1&m&&(e.\u0275\u0275elementStart(0,"td"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&m){const o=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,i.getEPersonName(o.policy))," ")}}function w(m,L){1&m&&e.\u0275\u0275element(0,"td")}function $(m,L){if(1&m&&(e.\u0275\u0275elementStart(0,"td"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&m){const o=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,i.getGroupName(o.policy))," ")}}function X(m,L){1&m&&e.\u0275\u0275element(0,"td")}function k(m,L){if(1&m){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",21),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(o);const R=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).redirectToGroupEditPage(R.policy)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",24),e.\u0275\u0275elementEnd()}2&m&&e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(1,1,"resource-policies.table.headers.edit.group"))}function q(m,L){if(1&m){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",13)(2,"div",14)(3,"input",18),e.\u0275\u0275listener("ngModelChange",function(R){const H=e.\u0275\u0275restoreView(o).$implicit;return e.\u0275\u0275nextContext(2).selectCheckbox(H,R)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"label",16),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"th",19),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"td"),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td"),e.\u0275\u0275text(10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"td"),e.\u0275\u0275text(12),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,Z,3,3,"td",5),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275template(15,w,1,0,"td",5),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275template(17,$,3,3,"td",5),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275template(19,X,1,0,"td",5),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementStart(21,"td"),e.\u0275\u0275text(22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"td"),e.\u0275\u0275text(24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"td",13)(26,"div",20)(27,"button",21),e.\u0275\u0275listener("click",function(){const F=e.\u0275\u0275restoreView(o).$implicit;return e.\u0275\u0275nextContext(2).redirectToResourcePolicyEditPage(F.policy)}),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275element(29,"i",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(30,k,3,3,"button",23),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementEnd()()()}if(2&m){const o=L.$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("id",o.id)("ngModel",o.checked),e.\u0275\u0275advance(1),e.\u0275\u0275property("for",o.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",o.id," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o.policy.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o.policy.policyType),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o.policy.action),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(14,15,i.hasEPerson(o.policy))),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(16,17,i.hasEPerson(o.policy))),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(18,19,i.hasGroup(o.policy))),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(20,21,i.hasGroup(o.policy))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.formatDate(o.policy.startDate)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.formatDate(o.policy.endDate)),e.\u0275\u0275advance(3),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(28,23,"resource-policies.table.headers.edit.policy")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(31,25,i.hasGroup(o.policy)))}}function ee(m,L){if(1&m&&(e.\u0275\u0275elementStart(0,"tbody"),e.\u0275\u0275template(1,q,32,27,"tr",17),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&m){const o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(2,1,o.getResourcePolicies()))}}let te=(()=>{class m{constructor(o,i,R,F,H,d,j,s,p,S){this.cdr=o,this.dsoNameService=i,this.ePersonService=R,this.groupService=F,this.notificationsService=H,this.requestService=d,this.resourcePolicyService=j,this.route=s,this.router=p,this.translate=S,this.processingDelete$=new t.X(!1),this.resourcePoliciesEntries$=new t.X([]),this.subs=[]}ngOnInit(){this.isActive=!0,this.initResourcePolicyLIst()}canDelete(){return(0,O.D)(this.resourcePoliciesEntries$.value).pipe((0,P.h)(o=>o.checked),(0,C.u)((o,i)=>[...o,i],[]),(0,I.U)(o=>(0,D.UE)(o)),(0,v.x)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const o=this.resourcePoliciesEntries$.value.filter(i=>i.checked);this.subs.push((0,O.D)(o).pipe((0,T.b)(i=>this.resourcePolicyService.delete(i.policy.id)),(0,a.R)((i,R)=>[...i,R],[]),(0,P.h)(i=>i.length===o.length),(0,U.q)(1)).subscribe(i=>{const R=i.filter(F=>!F);(0,D.xb)(R)?this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content")),this.processingDelete$.next(!1)}))}formatDate(o){return(0,D.UE)(o)?(0,g.UW)((0,g.bj)(o)):""}getEPersonName(o){return o.eperson.pipe((0,P.h)(()=>this.isActive),(0,_.A6)(),(0,I.U)(i=>this.dsoNameService.getName(i)),(0,E.O)(""))}getGroupName(o){return o.group.pipe((0,P.h)(()=>this.isActive),(0,_.A6)(),(0,I.U)(i=>this.dsoNameService.getName(i)),(0,E.O)(""))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}hasEPerson(o){return o.eperson.pipe((0,P.h)(()=>this.isActive),(0,_.Gp)(),(0,I.U)(i=>(0,D.UE)(i)),(0,E.O)(!1))}hasGroup(o){return o.group.pipe((0,P.h)(()=>this.isActive),(0,_.Gp)(),(0,I.U)(i=>(0,D.UE)(i)),(0,E.O)(!1))}initResourcePolicyLIst(){this.subs.push(this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,B.l)("eperson"),(0,B.l)("group")).pipe((0,P.h)(()=>this.isActive),(0,_.g1)()).subscribe(o=>{const i=o.payload.page.map(R=>({id:R.id,policy:R,checked:!1}));this.resourcePoliciesEntries$.next(i),this.cdr.detectChanges()}))}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}redirectToResourcePolicyEditPage(o){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:o.id}})}redirectToGroupEditPage(o){this.subs.push(this.groupService.findByHref(o._links.group.href,!1).pipe((0,P.h)(()=>this.isActive),(0,_.Gp)(),(0,I.U)(i=>i.id)).subscribe(i=>{this.router.navigate([W.QX,y.CH,i])}))}selectAllCheckbox(o){const i=o.target.checked;this.resourcePoliciesEntries$.value.forEach(R=>R.checked=i)}selectCheckbox(o,i){o.checked=i}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.subs.filter(o=>(0,D.Uh)(o)).forEach(o=>o.unsubscribe())}}return m.\u0275fac=function(o){return new(o||m)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(l._),e.\u0275\u0275directiveInject(K.k),e.\u0275\u0275directiveInject(h.O),e.\u0275\u0275directiveInject(M.T),e.\u0275\u0275directiveInject(f.s),e.\u0275\u0275directiveInject(n.Z),e.\u0275\u0275directiveInject(c.gz),e.\u0275\u0275directiveInject(c.F0),e.\u0275\u0275directiveInject(u.sK))},m.\u0275cmp=e.\u0275\u0275defineComponent({type:m,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},decls:31,vars:34,consts:[[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[4,"ngIf"],[1,"space-children-mr"],[1,"btn","btn-danger","p-1",3,"disabled","title","click"],[1,"btn","btn-success","p-1",3,"disabled","title","click"],[1,"fas","fa-plus"],["class","text-center",4,"ngIf"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-trash-alt","fa-fw"],[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","change"],[1,"custom-control-label",3,"for"],[4,"ngFor","ngForTrackById","ngForOf"],["type","checkbox",1,"custom-control-input",3,"id","ngModel","ngModelChange"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"title","click"],[1,"fas","fa-edit","fa-fw"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],[1,"fas","fa-users","fa-fw"]],template:function(o,i){if(1&o&&(e.\u0275\u0275elementStart(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th",2)(5,"div",3)(6,"span"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementStart(9,"span",4),e.\u0275\u0275text(10),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(11,V,2,1,"ng-container",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",6)(13,"button",7),e.\u0275\u0275listener("click",function(){return i.deleteSelectedResourcePolicies()}),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275template(17,J,4,3,"span",5),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275template(19,Q,4,3,"span",5),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",8),e.\u0275\u0275listener("click",function(){return i.redirectToResourcePolicyCreatePage()}),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275element(24,"i",9),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275template(27,z,32,29,"tr",10),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(29,ee,3,3,"tbody",5),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275elementEnd()()),2&o){let R,F;e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(8,12,"resource-policies.table.headers.title.for."+i.resourceType)," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",i.resourceName," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","item"!=i.resourceType),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(14,14,i.canDelete())||e.\u0275\u0275pipeBind1(15,16,i.isProcessingDelete()))("title",e.\u0275\u0275pipeBind1(16,18,"resource-policies.delete.btn.title")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(18,20,i.isProcessingDelete())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(20,22,i.isProcessingDelete())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,24,i.isProcessingDelete()))("title",e.\u0275\u0275pipeBind1(23,26,"resource-policies.add.for."+i.resourceType)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,28,"resource-policies.add.button")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(R=e.\u0275\u0275pipeBind1(28,30,i.getResourcePolicies()))?null:R.length)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(F=e.\u0275\u0275pipeBind1(30,32,i.getResourcePolicies()))?null:F.length)>0)}},directives:[b.O5,b.sg,G.$,Y.Wl,Y.JJ,Y.On],pipes:[u.X$,b.Ov],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]}),m})()},64165:(N,x,r)=>{r.d(x,{q:()=>y});var t=r(69808),O=r(86956),T=(r(32369),r(13344),r(85286),r(22349),r(83429)),a=r(41466),U=r(16880),E=r(46176),n=r(5e3),_=r(38475),h=r(93075);let D=(()=>{class e{constructor(c){this.formBuilder=c,this.labelPrefix="admin.access-control.groups.",this.subs=[],this.search=new n.EventEmitter,this.searchForm=this.formBuilder.group({query:""})}reset(){this.searchForm=this.formBuilder.group({query:""})}submit(c){const u={scope:"",query:(0,_.K0)(c)?c.query:""};this.search.emit(u)}}return e.\u0275fac=function(c){return new(c||e)(n.\u0275\u0275directiveInject(h.qu))},e.\u0275cmp=n.\u0275\u0275defineComponent({type:e,selectors:[["ds-group-search-box"]],outputs:{search:"search"},decls:13,vars:7,consts:[[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-button","btn","btn-secondary",3,"click"]],template:function(c,u){1&c&&(n.\u0275\u0275elementStart(0,"form",0),n.\u0275\u0275listener("ngSubmit",function(G){return u.submit(u.searchForm.value),G.stopImmediatePropagation()}),n.\u0275\u0275elementStart(1,"div",1)(2,"div",2),n.\u0275\u0275element(3,"input",3),n.\u0275\u0275elementStart(4,"span",4)(5,"button",5),n.\u0275\u0275element(6,"i",6),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275elementEnd()()()(),n.\u0275\u0275elementStart(9,"div")(10,"button",7),n.\u0275\u0275listener("click",function(){return u.submit(null),u.reset()}),n.\u0275\u0275text(11),n.\u0275\u0275pipe(12,"translate"),n.\u0275\u0275elementEnd()()()),2&c&&(n.\u0275\u0275property("formGroup",u.searchForm),n.\u0275\u0275advance(7),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(8,3,u.labelPrefix+"search.button")," "),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(12,5,u.labelPrefix+"button.see-all")," "))},directives:[h._Y,h.JL,h.sg,h.Fj,h.JJ,h.u],pipes:[O.X$],encapsulation:2}),e})(),K=(()=>{class e{constructor(c){this.formBuilder=c,this.labelPrefix="admin.access-control.epeople.",this.subs=[],this.search=new n.EventEmitter,this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}reset(){this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}submit(c){const u={scope:(0,_.K0)(c)?c.scope:"metadata",query:(0,_.K0)(c)?c.query:""};this.search.emit(u)}}return e.\u0275fac=function(c){return new(c||e)(n.\u0275\u0275directiveInject(h.qu))},e.\u0275cmp=n.\u0275\u0275defineComponent({type:e,selectors:[["ds-eperson-search-box"]],outputs:{search:"search"},decls:21,vars:13,consts:[[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-button","btn","btn-secondary",3,"click"]],template:function(c,u){1&c&&(n.\u0275\u0275elementStart(0,"form",0),n.\u0275\u0275listener("ngSubmit",function(G){return u.submit(u.searchForm.value),G.stopImmediatePropagation()}),n.\u0275\u0275elementStart(1,"div")(2,"select",1)(3,"option",2),n.\u0275\u0275text(4),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"option",3),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275elementEnd()()(),n.\u0275\u0275elementStart(9,"div",4)(10,"div",5),n.\u0275\u0275element(11,"input",6),n.\u0275\u0275elementStart(12,"span",7)(13,"button",8),n.\u0275\u0275element(14,"i",9),n.\u0275\u0275text(15),n.\u0275\u0275pipe(16,"translate"),n.\u0275\u0275elementEnd()()()(),n.\u0275\u0275elementStart(17,"div")(18,"button",10),n.\u0275\u0275listener("click",function(){return u.submit(null),u.reset()}),n.\u0275\u0275text(19),n.\u0275\u0275pipe(20,"translate"),n.\u0275\u0275elementEnd()()()),2&c&&(n.\u0275\u0275property("formGroup",u.searchForm),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(5,5,u.labelPrefix+"search.scope.metadata")),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(8,7,u.labelPrefix+"search.scope.email")),n.\u0275\u0275advance(8),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(16,9,u.labelPrefix+"search.button")," "),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(20,11,u.labelPrefix+"button.see-all")," "))},directives:[h._Y,h.JL,h.sg,h.EJ,h.JJ,h.u,h.YN,h.Kr,h.Fj],pipes:[O.X$],encapsulation:2}),e})();var f=r(17656),M=r(42501),g=r(92396);const W=[a.b,U.a];let y=(()=>{class e{}return e.\u0275fac=function(c){return new(c||e)},e.\u0275mod=n.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=n.\u0275\u0275defineInjector({providers:[...W],imports:[[f.IJ,t.ez,T.e,O.aw,M.m]]}),e})();n.\u0275\u0275setComponentScope(E.W,[t.O5,K,D,g.Q,t.sg],[t.Ov,O.X$])}}]);