(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[4067,3429],{86656:(ne,W,i)=>{"use strict";i.d(W,{K:()=>v});var n=i(38475),E=i(69972);class v extends E.R{constructor(l,...b){super(l,...b),this._rootElement=l,this._subRootElement=b.join("/")}get rootElement(){return this._rootElement}get subRootElement(){return this._subRootElement}getPath(l){(0,n.pT)(l)&&Array.isArray(l)&&(l=l.join("/"));let b="/"+this.toString();return(0,n.pT)(l)&&(b+="/"+l),{rootElement:this._rootElement,subRootElement:this._subRootElement,path:b}}}},83429:(ne,W,i)=>{"use strict";i.d(W,{e:()=>se});var n=i(69808),E=i(50358),v=i(5e3),e=i(8108),l=i(19084);function b(Z,ce){if(1&Z){const N=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"ds-dynamic-form-control-container",1),v.\u0275\u0275listener("dfBlur",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.blur)})("dfChange",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.change)})("dfFocus",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.focus)})("ngbEvent",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.ngbEvent)}),v.\u0275\u0275elementEnd()}if(2&Z){const N=ce.$implicit,ae=v.\u0275\u0275nextContext();v.\u0275\u0275classProp("d-none",N.hidden),v.\u0275\u0275property("formId",ae.formId)("group",ae.formGroup)("hasErrorMessaging",N.hasErrorMessages)("hidden",N.hidden)("layout",ae.formLayout)("model",N)("templates",ae.templates)("asBootstrapFormGroup",!0)}}let a=(()=>{class Z extends e.rmD{constructor(N,ae){super(N,ae),this.blur=new v.EventEmitter,this.change=new v.EventEmitter,this.focus=new v.EventEmitter,this.ngbEvent=new v.EventEmitter}}return Z.\u0275fac=function(N){return new(N||Z)(v.\u0275\u0275directiveInject(v.ChangeDetectorRef),v.\u0275\u0275directiveInject(e.rJA))},Z.\u0275cmp=v.\u0275\u0275defineComponent({type:Z,selectors:[["ds-dynamic-form"]],contentQueries:function(N,ae,ue){if(1&N&&v.\u0275\u0275contentQuery(ue,e.ATj,4),2&N){let V;v.\u0275\u0275queryRefresh(V=v.\u0275\u0275loadQuery())&&(ae.templates=V)}},viewQuery:function(N,ae){if(1&N&&v.\u0275\u0275viewQuery(l.B,5),2&N){let ue;v.\u0275\u0275queryRefresh(ue=v.\u0275\u0275loadQuery())&&(ae.components=ue)}},inputs:{formId:"formId",formGroup:"formGroup",formModel:"formModel",formLayout:"formLayout"},outputs:{blur:"dfBlur",change:"dfChange",focus:"dfFocus",ngbEvent:"ngbEvent"},features:[v.\u0275\u0275InheritDefinitionFeature],decls:1,vars:2,consts:[[3,"formId","group","hasErrorMessaging","hidden","d-none","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent"]],template:function(N,ae){1&N&&v.\u0275\u0275template(0,b,1,10,"ds-dynamic-form-control-container",0),2&N&&v.\u0275\u0275property("ngForOf",ae.formModel)("ngForTrackBy",ae.trackByFn)},directives:[n.sg,l.B],encapsulation:2}),Z})();i(43714),i(6084),i(71673),i(56804),i(46047),i(59072),i(20771),i(96153),i(93181);var L=i(77778),$=i(11860),H=(i(72816),i(26625),i(26690),i(8756),i(42501)),O=i(86956),y=i(53956),g=(i(13821),i(26076),i(99069),i(55741),i(65806)),h=i(93075),D=i(21283);let se=(()=>{class Z{}return Z.\u0275fac=function(N){return new(N||Z)},Z.\u0275mod=v.\u0275\u0275defineNgModule({type:Z}),Z.\u0275inj=v.\u0275\u0275defineInjector({providers:[{provide:e.y8$,useValue:l._}],imports:[[n.ez,e.H9g,g.zj,y.t,H.m,O.aw]]}),Z})();v.\u0275\u0275setComponentScope(L.i,[h.JL,h.sg,h.x0,n.mk,n.sg,l.B],[]),v.\u0275\u0275setComponentScope($.s,[h.JL,h.sg,h.CE,n.mk,D.Wj,n.sg,D.Zt,D.Bh,h.x0,n.tP,l.B],[]),v.\u0275\u0275setComponentScope(E.U,[h._Y,h.JL,h.sg,a,e.ATj,n.O5],[O.X$,n.Ov])},31423:(ne,W,i)=>{"use strict";i.r(W),i.d(W,{SubmissionEditComponent:()=>A});var n=i(61135),E=i(63900),v=i(39300),e=i(78372),l=i(38475),b=i(20445),a=i(55489),F=i(46283),P=i(58187),z=i(45269),w=i(35473),C=i(5e3),U=i(74202),K=i(86956),_=i(44064);let A=(()=>{class L{constructor(f,B,u,T,H,O,y,j){this.changeDetectorRef=f,this.notificationsService=B,this.route=u,this.router=T,this.itemDataService=H,this.submissionService=O,this.translate=y,this.submissionJsonPatchOperationsService=j,this.subs=[],this.itemLink$=new n.X(void 0)}ngOnInit(){this.subs.push(this.route.paramMap.pipe((0,E.w)(f=>this.submissionService.retrieveSubmission(f.get("id"))),(0,v.h)(f=>(0,l.K0)(f))).subscribe(f=>{if(f.hasSucceeded)if((0,l.xb)(f.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:B}=f.payload;this.submissionErrors=(0,w.Z)(B),this.submissionId=f.payload.id.toString(),this.collectionId=f.payload.collection.id,this.selfUrl=f.payload._links.self.href,this.sections=f.payload.sections,this.itemLink$.next(f.payload._links.item.href),this.item=f.payload.item,this.submissionDefinition=f.payload.submissionDefinition}else 404===f.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,l.iy)(),(0,E.w)(f=>this.itemDataService.findByHref(f)),(0,F.g1)(),(0,e.b)(300)).subscribe(f=>{this.item=f.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(f=>(0,l.Uh)(f)).forEach(f=>f.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}}return L.\u0275fac=function(f){return new(f||L)(C.\u0275\u0275directiveInject(C.ChangeDetectorRef),C.\u0275\u0275directiveInject(a.T),C.\u0275\u0275directiveInject(U.gz),C.\u0275\u0275directiveInject(U.F0),C.\u0275\u0275directiveInject(P.S),C.\u0275\u0275directiveInject(b.b),C.\u0275\u0275directiveInject(K.sK),C.\u0275\u0275directiveInject(z.E))},L.\u0275cmp=C.\u0275\u0275defineComponent({type:L,selectors:[["ds-submission-edit"]],decls:2,vars:7,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","submissionId"]],template:function(f,B){1&f&&(C.\u0275\u0275elementStart(0,"div",0),C.\u0275\u0275element(1,"ds-submission-form",1),C.\u0275\u0275elementEnd()),2&f&&(C.\u0275\u0275advance(1),C.\u0275\u0275property("collectionId",B.collectionId)("sections",B.sections)("selfUrl",B.selfUrl)("submissionDefinition",B.submissionDefinition)("submissionErrors",B.submissionErrors)("item",B.item)("submissionId",B.submissionId))},directives:[_.G],styles:[""]}),L})()},11503:(ne,W,i)=>{"use strict";i.d(W,{I:()=>e});var n=i(79094),E=i(5e3);function v(l,b){}let e=(()=>{class l extends n.F{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(a){return i(8377)(`./${a}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,31423))}}return l.\u0275fac=function(){let b;return function(F){return(b||(b=E.\u0275\u0275getInheritedFactory(l)))(F||l)}}(),l.\u0275cmp=E.\u0275\u0275defineComponent({type:l,selectors:[["ds-themed-submission-edit"]],features:[E.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,F){1&a&&E.\u0275\u0275template(0,v,0,0,"ng-template",null,0,E.\u0275\u0275templateRefExtractor)},encapsulation:2}),l})()},36262:(ne,W,i)=>{"use strict";i.d(W,{z:()=>O});var n=i(5e3),E=i(61135),v=i(39646),e=i(40367),l=i(54004),b=i(86099),a=i(38475),F=i(86656),P=i(7522),z=i(20445),w=i(45269),C=i(31054),U=i(86649),K=i(74033),_=i(46283),A=i(6991),L=i(69808),$=i(17656),f=i(86956);function B(y,j){if(1&y&&(n.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"span",4),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"div",5)(6,"span",4),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"async"),n.\u0275\u0275elementEnd()()()),2&y){const p=n.\u0275\u0275nextContext();n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(4,2,"submission.sections.general.collection")),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(8,4,p.selectedCollectionName$))}}function u(y,j){1&y&&(n.\u0275\u0275elementStart(0,"span"),n.\u0275\u0275element(1,"i",13),n.\u0275\u0275elementEnd())}function T(y,j){if(1&y&&(n.\u0275\u0275elementStart(0,"span"),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"async"),n.\u0275\u0275elementEnd()),2&y){const p=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(2,1,p.selectedCollectionName$))}}function H(y,j){if(1&y){const p=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",6,7),n.\u0275\u0275listener("openChange",function(d){return n.\u0275\u0275restoreView(p),n.\u0275\u0275nextContext().toggled(d)}),n.\u0275\u0275elementStart(2,"div",3)(3,"span",8),n.\u0275\u0275text(4),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(6,"button",9),n.\u0275\u0275listener("blur",function(){return n.\u0275\u0275restoreView(p),n.\u0275\u0275nextContext().onClose()})("click",function(){return n.\u0275\u0275restoreView(p),n.\u0275\u0275nextContext().onClose()}),n.\u0275\u0275pipe(7,"async"),n.\u0275\u0275template(8,u,2,0,"span",10),n.\u0275\u0275pipe(9,"async"),n.\u0275\u0275template(10,T,3,3,"span",10),n.\u0275\u0275pipe(11,"async"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(12,"div",11)(13,"ds-collection-dropdown",12),n.\u0275\u0275listener("selectionChange",function(d){return n.\u0275\u0275restoreView(p),n.\u0275\u0275nextContext().onSelect(d)}),n.\u0275\u0275elementEnd()()()}if(2&y){const p=n.\u0275\u0275nextContext();n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(5,4,"submission.sections.general.collection")," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("disabled",n.\u0275\u0275pipeBind1(7,6,p.processingChange$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(9,8,p.processingChange$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(11,10,p.processingChange$))}}let O=(()=>{class y{constructor(p,x,d,g,h,D){this.cdr=p,this.collectionDataService=x,this.operationsBuilder=d,this.operationsService=g,this.submissionService=h,this.sectionsService=D,this.collectionChange=new n.EventEmitter,this.processingChange$=new E.X(!1),this.subs=[]}ngOnChanges(p){(0,a.Uh)(p.currentCollectionId)&&(0,a.Uh)(p.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,e.s)(x=>(0,a.UE)(x.payload)),(0,l.U)(x=>x.payload.name)))}ngOnInit(){this.pathCombiner=new F.K("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,A.i.collection)}ngOnDestroy(){this.subs.filter(p=>(0,a.Uh)(p)).forEach(p=>p.unsubscribe())}onSelect(p){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),p.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,b.z)(x=>this.submissionService.retrieveSubmission(x[0].id).pipe((0,_.Gp)()))).subscribe(x=>{this.selectedCollectionId=p.collection.id,this.selectedCollectionName$=(0,v.of)(p.collection.name),this.collectionChange.emit(x),this.submissionService.changeSubmissionCollection(this.submissionId,p.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown.reset()}toggled(p){p||this.collectionDropdown.reset()}}return y.\u0275fac=function(p){return new(p||y)(n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(C.W),n.\u0275\u0275directiveInject(P.w),n.\u0275\u0275directiveInject(w.E),n.\u0275\u0275directiveInject(z.b),n.\u0275\u0275directiveInject(K.J))},y.\u0275cmp=n.\u0275\u0275defineComponent({type:y,selectors:[["ds-submission-form-collection"]],viewQuery:function(p,x){if(1&p&&n.\u0275\u0275viewQuery(U.H,5),2&p){let d;n.\u0275\u0275queryRefresh(d=n.\u0275\u0275loadQuery())&&(x.collectionDropdown=d.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",submissionId:"submissionId"},outputs:{collectionChange:"collectionChange"},features:[n.\u0275\u0275NgOnChangesFeature],decls:5,vars:6,consts:[["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["collectionControls","ngbDropdown"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"disabled","blur","click"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(p,x){1&p&&(n.\u0275\u0275elementStart(0,"div"),n.\u0275\u0275template(1,B,9,6,"div",0),n.\u0275\u0275pipe(2,"async"),n.\u0275\u0275template(3,H,14,12,"div",1),n.\u0275\u0275pipe(4,"async"),n.\u0275\u0275elementEnd()),2&p&&(n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(2,2,x.available$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(4,4,x.available$)))},directives:[L.O5,$.jt,$.iD,$.Vi,U.H],pipes:[L.Ov,f.X$],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{left:0!important}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;box-shadow:var(--bs-btn-focus-box-shadow)}"]}),y})()},16949:(ne,W,i)=>{"use strict";i.d(W,{z:()=>u});var n=i(39646),E=i(54004),v=i(6633),e=i(20445),l=i(46144),b=i(38475),a=i(5e3),F=i(17656),P=i(69808),z=i(54283),w=i(86956);function C(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",13),a.\u0275\u0275listener("click",function(j){a.\u0275\u0275restoreView(O);const p=a.\u0275\u0275nextContext(2),x=a.\u0275\u0275reference(2);return j.preventDefault(),p.confirmDiscard(x)}),a.\u0275\u0275pipe(1,"dsBrowserOnly"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275element(4,"i",14),a.\u0275\u0275text(5),a.\u0275\u0275pipe(6,"translate"),a.\u0275\u0275elementEnd()}if(2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(2,5,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(3,7,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(1,3,"discard")),a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(6,9,"submission.general.discard.submit")," ")}}function U(T,H){1&T&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275element(1,"i",15),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()),2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"submission.general.info.saved")," "))}function K(T,H){1&T&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275element(1,"i",16),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()),2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"submission.general.info.pending-changes")," "))}function _(T,H){1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1,"Saving..."),a.\u0275\u0275elementEnd()),2&T&&a.\u0275\u0275styleProp("width","100%")}function A(T,H){1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1,"Depositing..."),a.\u0275\u0275elementEnd()),2&T&&a.\u0275\u0275styleProp("width","100%")}function L(T,H){if(1&T&&(a.\u0275\u0275elementStart(0,"div",17)(1,"div",18),a.\u0275\u0275template(2,_,2,2,"div",19),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275template(4,A,2,2,"div",19),a.\u0275\u0275pipe(5,"async"),a.\u0275\u0275elementEnd()()),2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(3,2,O.processingSaveStatus)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(5,4,O.processingDepositStatus))}}function $(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",21),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext(2).deposit(j)}),a.\u0275\u0275pipe(1,"dsBrowserOnly"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275elementStart(4,"span"),a.\u0275\u0275element(5,"i",22),a.\u0275\u0275text(6),a.\u0275\u0275pipe(7,"translate"),a.\u0275\u0275elementEnd()()}if(2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(2,5,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(3,7,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(1,3,"deposit")),a.\u0275\u0275advance(6),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(7,9,"submission.general.deposit"),"")}}function f(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",2)(1,"div",3),a.\u0275\u0275template(2,C,7,11,"button",4),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"div",5),a.\u0275\u0275template(5,U,4,3,"span",6),a.\u0275\u0275pipe(6,"async"),a.\u0275\u0275pipe(7,"async"),a.\u0275\u0275pipe(8,"async"),a.\u0275\u0275template(9,K,4,3,"span",6),a.\u0275\u0275pipe(10,"async"),a.\u0275\u0275pipe(11,"async"),a.\u0275\u0275pipe(12,"async"),a.\u0275\u0275template(13,L,6,6,"div",7),a.\u0275\u0275pipe(14,"async"),a.\u0275\u0275pipe(15,"async"),a.\u0275\u0275elementStart(16,"div",8)(17,"button",9),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext().save(j)}),a.\u0275\u0275pipe(18,"dsBrowserOnly"),a.\u0275\u0275pipe(19,"async"),a.\u0275\u0275pipe(20,"async"),a.\u0275\u0275elementStart(21,"span"),a.\u0275\u0275element(22,"i",10),a.\u0275\u0275text(23),a.\u0275\u0275pipe(24,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(25,"button",11),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext().saveLater(j)}),a.\u0275\u0275pipe(26,"async"),a.\u0275\u0275pipe(27,"async"),a.\u0275\u0275pipe(28,"dsBrowserOnly"),a.\u0275\u0275pipe(29,"async"),a.\u0275\u0275pipe(30,"async"),a.\u0275\u0275elementStart(31,"span"),a.\u0275\u0275element(32,"i",10),a.\u0275\u0275text(33),a.\u0275\u0275pipe(34,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(35,$,8,11,"button",12),a.\u0275\u0275pipe(36,"async"),a.\u0275\u0275elementEnd()()()}if(2&T){const O=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(3,15,O.showDepositAndDiscard)),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(6,17,O.hasUnsavedModification)&&!a.\u0275\u0275pipeBind1(7,19,O.processingSaveStatus)&&!a.\u0275\u0275pipeBind1(8,21,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(10,23,O.hasUnsavedModification)&&!a.\u0275\u0275pipeBind1(11,25,O.processingSaveStatus)&&!a.\u0275\u0275pipeBind1(12,27,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(14,29,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(15,31,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(19,35,O.processingSaveStatus)||!a.\u0275\u0275pipeBind1(20,37,O.hasUnsavedModification)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(18,33,"save")),a.\u0275\u0275advance(6),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(24,39,"submission.general.save"),""),a.\u0275\u0275advance(2),a.\u0275\u0275classProp("btn-primary",!a.\u0275\u0275pipeBind1(26,41,O.showDepositAndDiscard))("btn-secondary",a.\u0275\u0275pipeBind1(27,43,O.showDepositAndDiscard)),a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(29,47,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(30,49,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(28,45,"save-for-later")),a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(34,51,"submission.general.save-later"),""),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(36,53,O.showDepositAndDiscard))}}function B(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",23)(1,"h4",24),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"button",25),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).dismiss("cancel")}),a.\u0275\u0275elementStart(5,"span",26),a.\u0275\u0275text(6,"\xd7"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(7,"div",27)(8,"p"),a.\u0275\u0275text(9),a.\u0275\u0275pipe(10,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(11,"div",28)(12,"button",29),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).close("cancel")}),a.\u0275\u0275text(13),a.\u0275\u0275pipe(14,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(15,"button",30),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).close("ok")}),a.\u0275\u0275text(16),a.\u0275\u0275pipe(17,"translate"),a.\u0275\u0275elementEnd()()}2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,4,"submission.general.discard.confirm.title")),a.\u0275\u0275advance(7),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(10,6,"submission.general.discard.confirm.info")),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(14,8,"submission.general.discard.confirm.cancel")),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(17,10,"submission.general.discard.confirm.submit")))}let u=(()=>{class T{constructor(O,y,j){this.modalService=O,this.restService=y,this.submissionService=j,this.submissionIsInvalid=(0,n.of)(!0)}ngOnChanges(O){(0,b.UE)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,E.U)(y=>!1===y)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,n.of)(this.submissionService.getSubmissionScope()===l.S.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(O){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(O){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(O){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(O){this.modalService.open(O).result.then(y=>{"ok"===y&&this.submissionService.dispatchDiscard(this.submissionId)})}}return T.\u0275fac=function(O){return new(O||T)(a.\u0275\u0275directiveInject(F.FF),a.\u0275\u0275directiveInject(v.F),a.\u0275\u0275directiveInject(e.b))},T.\u0275cmp=a.\u0275\u0275defineComponent({type:T,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},features:[a.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[["class","row",4,"ngIf"],["content",""],[1,"row"],[1,"col"],["type","button","id","discard","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"disabled","click"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"disabled","click"],["type","button","id","deposit","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button","id","discard",1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(O,y){1&O&&(a.\u0275\u0275template(0,f,37,55,"div",0),a.\u0275\u0275template(1,B,18,12,"ng-template",null,1,a.\u0275\u0275templateRefExtractor)),2&O&&a.\u0275\u0275property("ngIf",!!y.submissionId)},directives:[P.O5],pipes:[z.g,P.Ov,w.X$],styles:[""]}),T})()},94375:(ne,W,i)=>{"use strict";i.d(W,{i:()=>C});var n=i(54004),E=i(74033),v=i(95900),e=i(20445),l=i(5e3),b=i(17656),a=i(69808),F=i(86956);function P(U,K){1&U&&(l.\u0275\u0275elementStart(0,"button",7),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"translate"),l.\u0275\u0275elementEnd()),2&U&&(l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind1(2,1,"submission.sections.general.no-sections")," "))}function z(U,K){if(1&U){const _=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"button",8),l.\u0275\u0275listener("click",function(){const $=l.\u0275\u0275restoreView(_).$implicit;return l.\u0275\u0275nextContext().addSection($.id)}),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"translate"),l.\u0275\u0275elementEnd()}if(2&U){const _=K.$implicit;l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind1(2,1,"submission.sections."+_.header)," ")}}const w=function(U){return{"w-100":U}};let C=(()=>{class U{constructor(_,A,L){this.sectionService=_,this.submissionService=A,this.windowService=L}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,n.U)(_=>_.length>0))}addSection(_){this.sectionService.addSection(this.submissionId,_)}}return U.\u0275fac=function(_){return new(_||U)(l.\u0275\u0275directiveInject(E.J),l.\u0275\u0275directiveInject(e.b),l.\u0275\u0275directiveInject(v.I))},U.\u0275cmp=l.\u0275\u0275defineComponent({type:U,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},decls:14,vars:25,consts:[["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["sectionAdd","ngbDropdown"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"disabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(_,A){1&_&&(l.\u0275\u0275elementStart(0,"div",0,1)(2,"button",2),l.\u0275\u0275pipe(3,"async"),l.\u0275\u0275pipe(4,"async"),l.\u0275\u0275text(5),l.\u0275\u0275pipe(6,"translate"),l.\u0275\u0275element(7,"i",3),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(8,"div",4),l.\u0275\u0275pipe(9,"async"),l.\u0275\u0275template(10,P,3,3,"button",5),l.\u0275\u0275pipe(11,"async"),l.\u0275\u0275template(12,z,3,3,"button",6),l.\u0275\u0275pipe(13,"async"),l.\u0275\u0275elementEnd()()),2&_&&(l.\u0275\u0275property("ngClass",l.\u0275\u0275pureFunction1(19,w,A.windowService.isXs())),l.\u0275\u0275advance(2),l.\u0275\u0275property("disabled",!l.\u0275\u0275pipeBind1(3,7,A.hasSections$))("ngClass",l.\u0275\u0275pureFunction1(21,w,l.\u0275\u0275pipeBind1(4,9,A.windowService.isXs()))),l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind1(6,11,"submission.sections.general.add-more")," "),l.\u0275\u0275advance(3),l.\u0275\u0275property("ngClass",l.\u0275\u0275pureFunction1(23,w,l.\u0275\u0275pipeBind1(9,13,A.windowService.isXs()))),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngIf",!l.\u0275\u0275pipeBind1(11,15,A.hasSections$)),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngForOf",l.\u0275\u0275pipeBind1(13,17,A.sectionList$)))},directives:[b.jt,a.mk,b.iD,b.Vi,a.O5,a.sg],pipes:[a.Ov,F.X$],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]}),U})()},44064:(ne,W,i)=>{"use strict";i.d(W,{G:()=>x});var n=i(39646),E=i(39300),v=i(54004),e=i(71884),l=i(63900),b=i(36696),F=(i(17660),i(3592)),P=i(38475),z=i(96130),w=i(20445),U=(i(44542),i(6991)),K=i(74033),_=i(5e3),A=i(69808),L=i(86042),$=i(36262),f=i(94375),B=i(27924),u=i(2077),T=i(16949);function H(d,g){if(1&d&&(_.\u0275\u0275elementStart(0,"div",12),_.\u0275\u0275element(1,"ds-submission-upload-files",13)(2,"div",14),_.\u0275\u0275elementEnd()),2&d){const h=_.\u0275\u0275nextContext(2);_.\u0275\u0275advance(1),_.\u0275\u0275property("submissionId",h.submissionId)("collectionId",h.collectionId)("uploadFilesOptions",h.uploadFilesOptions)}}function O(d,g){if(1&d){const h=_.\u0275\u0275getCurrentView();_.\u0275\u0275elementStart(0,"div",6),_.\u0275\u0275template(1,H,3,3,"div",7),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementStart(3,"div",8)(4,"ds-submission-form-collection",9),_.\u0275\u0275listener("collectionChange",function(oe){return _.\u0275\u0275restoreView(h),_.\u0275\u0275nextContext().onCollectionChange(oe)}),_.\u0275\u0275elementEnd()(),_.\u0275\u0275elementStart(5,"div",10),_.\u0275\u0275element(6,"ds-submission-form-section-add",11),_.\u0275\u0275elementEnd()()}if(2&d){const h=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(2,6,h.uploadEnabled$)),_.\u0275\u0275advance(3),_.\u0275\u0275property("currentCollectionId",h.collectionId)("currentDefinition",h.definitionId)("submissionId",h.submissionId),_.\u0275\u0275advance(2),_.\u0275\u0275property("collectionId",h.collectionId)("submissionId",h.submissionId)}}function y(d,g){1&d&&_.\u0275\u0275element(0,"ds-loading",15)}function j(d,g){if(1&d&&(_.\u0275\u0275elementContainerStart(0),_.\u0275\u0275element(1,"ds-submission-section-container",16),_.\u0275\u0275elementContainerEnd()),2&d){const h=g.$implicit,D=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("collectionId",D.collectionId)("submissionId",D.submissionId)("sectionData",h)}}function p(d,g){if(1&d&&(_.\u0275\u0275elementStart(0,"div",17),_.\u0275\u0275element(1,"ds-submission-form-footer",18),_.\u0275\u0275elementEnd()),2&d){const h=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("submissionId",h.submissionId)}}let x=(()=>{class d{constructor(h,D,oe,se,Z){this.authService=h,this.changeDetectorRef=D,this.halService=oe,this.submissionService=se,this.sectionsService=Z,this.loading=(0,n.of)(!0),this.uploadFilesOptions=new z.n,this.subs=[],this.isActive=!0}ngOnChanges(h){h.collectionId&&this.collectionId&&h.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,E.h)(()=>this.isActive),(0,v.U)(D=>D.isLoading),(0,v.U)(D=>D),(0,e.x)(),(0,l.w)(D=>D?(0,n.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,U.i.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,E.h)(()=>this.isActive),(0,v.U)(D=>D.isLoading),(0,v.U)(D=>D),(0,e.x)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,E.h)(D=>(0,P.UE)(D)),(0,e.x)()).subscribe(D=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=D.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(h=>(0,P.Uh)(h)).forEach(h=>h.unsubscribe())}onCollectionChange(h){this.collectionId=h.collection.id,this.definitionId!==h.submissionDefinition.name?(this.sections=h.sections,this.submissionDefinition=h.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,h._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,E.h)(h=>(0,P.UE)(h)),(0,v.U)(h=>h))}}return d.\u0275fac=function(h){return new(h||d)(_.\u0275\u0275directiveInject(b.e8),_.\u0275\u0275directiveInject(_.ChangeDetectorRef),_.\u0275\u0275directiveInject(F.q),_.\u0275\u0275directiveInject(w.b),_.\u0275\u0275directiveInject(K.J))},d.\u0275cmp=_.\u0275\u0275defineComponent({type:d,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},features:[_.\u0275\u0275NgOnChangesFeature],decls:10,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[3,"currentCollectionId","currentDefinition","submissionId","collectionChange"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(h,D){1&h&&(_.\u0275\u0275elementStart(0,"div",0),_.\u0275\u0275template(1,O,7,8,"div",1),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementStart(3,"div",2),_.\u0275\u0275template(4,y,1,0,"ds-loading",3),_.\u0275\u0275pipe(5,"async"),_.\u0275\u0275template(6,j,2,3,"ng-container",4),_.\u0275\u0275pipe(7,"async"),_.\u0275\u0275elementEnd(),_.\u0275\u0275template(8,p,2,1,"div",5),_.\u0275\u0275pipe(9,"async"),_.\u0275\u0275elementEnd()),2&h&&(_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(2,4,D.isLoading())),_.\u0275\u0275advance(3),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(5,6,D.isLoading())),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngForOf",_.\u0275\u0275pipeBind1(7,8,D.submissionSections)),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(9,10,D.isLoading())))},directives:[A.O5,L.h,$.z,f.i,B.N,A.sg,u.y,T.z],pipes:[A.Ov],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]}),d})()},86042:(ne,W,i)=>{"use strict";i.d(W,{h:()=>L});var n=i(39646),E=i(50590),v=i(95698),e=i(74033),l=i(38475),b=i(99944),a=i(20445),F=i(55489),P=i(35473),z=i(45269),w=i(6991),C=i(5e3),U=i(86956),K=i(69808),_=i(54240);function A($,f){if(1&$){const B=C.\u0275\u0275getCurrentView();C.\u0275\u0275elementStart(0,"ds-uploader",1),C.\u0275\u0275listener("onCompleteItem",function(T){return C.\u0275\u0275restoreView(B),C.\u0275\u0275nextContext().onCompleteItem(T)})("onUploadError",function(){return C.\u0275\u0275restoreView(B),C.\u0275\u0275nextContext().onUploadError()}),C.\u0275\u0275elementEnd()}if(2&$){const B=C.\u0275\u0275nextContext();C.\u0275\u0275property("dropMsg",B.dropMsg)("dropOverDocumentMsg",B.dropOverDocumentMsg)("enableDragOverDocument",B.enableDragOverDocument)("onBeforeUpload",B.onBeforeUpload)("uploadFilesOptions",B.uploadFilesOptions)}}let L=(()=>{class ${constructor(B,u,T,H,O){this.notificationsService=B,this.operationsService=u,this.sectionService=T,this.submissionService=H,this.translate=O,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,n.of)(!1),this.onBeforeUpload=()=>{const y=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(y),y}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,w.i.Upload)}onCompleteItem(B){this.subs.push(this.uploadEnabled.pipe((0,E.P)()).subscribe(u=>{if(u){const{sections:T}=B,{errors:H}=B,O=(0,P.Z)(H);T&&(0,l.UE)(T)&&Object.keys(T).forEach(y=>{const j=(0,b.Vv)(T[y]),p=O[y];this.sectionService.isSectionType(this.submissionId,y,w.i.Upload).pipe((0,v.q)(1)).subscribe(x=>{x&&((0,l.xb)(p)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,y,j,p,p)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(B=>(0,l.Uh)(B)).forEach(B=>B.unsubscribe())}}return $.\u0275fac=function(B){return new(B||$)(C.\u0275\u0275directiveInject(F.T),C.\u0275\u0275directiveInject(z.E),C.\u0275\u0275directiveInject(e.J),C.\u0275\u0275directiveInject(a.b),C.\u0275\u0275directiveInject(U.sK))},$.\u0275cmp=C.\u0275\u0275defineComponent({type:$,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},features:[C.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError"]],template:function(B,u){1&B&&C.\u0275\u0275template(0,A,1,5,"ds-uploader",0),2&B&&C.\u0275\u0275property("ngIf",u.uploadFilesOptions.url)},directives:[K.O5,_.B],encapsulation:2}),$})()},80133:(ne,W,i)=>{"use strict";i.d(W,{v:()=>U}),i(75525);var E=i(98634),v=i(86099),e=i(20445),l=i(55489),b=i(32215),a=i(5e3),F=i(17656),P=i(74202),z=i(69808),w=i(86956);function C(K,_){if(1&K&&(a.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"strong"),a.\u0275\u0275text(3),a.\u0275\u0275pipe(4,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(5,"p"),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd()()()),2&K){const A=_.$implicit;a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(4,2,"item.preview."+A.key)),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(A.value.value)}}let U=(()=>{class K{constructor(A,L,$,f,B){this.activeModal=A,this.submissionService=L,this.modalService=$,this.router=f,this.notificationService=B}ngOnInit(){this.metadataList=[],Object.keys(this.externalSourceEntry.metadata).forEach(L=>{this.metadataList.push({key:L,value:E.S.first(this.externalSourceEntry.metadata,L)})})}closeMetadataModal(){this.activeModal.dismiss(!1)}import(){this.modalRef=this.modalService.open(b.L,{size:"lg"}),this.modalRef.componentInstance.entityType=this.labelPrefix,this.closeMetadataModal(),this.modalRef.componentInstance.selectedEvent.pipe((0,v.z)(A=>this.submissionService.createSubmissionFromExternalSource(this.externalSourceEntry._links.self.href,A.collection.id))).subscribe(A=>{let L=!1;1===A.length&&null!==A[0]&&(L=!0,this.router.navigateByUrl("/workspaceitems/"+A[0].id+"/edit")),L||this.notificationService.error("submission.import-external.preview.error.import.title","submission.import-external.preview.error.import.body"),this.modalRef.close()})}}return K.\u0275fac=function(A){return new(A||K)(a.\u0275\u0275directiveInject(F.Kz),a.\u0275\u0275directiveInject(e.b),a.\u0275\u0275directiveInject(F.FF),a.\u0275\u0275directiveInject(P.F0),a.\u0275\u0275directiveInject(l.T))},K.\u0275cmp=a.\u0275\u0275defineComponent({type:K,selectors:[["ds-submission-import-external-preview"]],inputs:{externalSourceEntry:"externalSourceEntry"},decls:27,vars:10,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-12"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-12","text-right"],["role","button",1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fa","fa-file-import"]],template:function(A,L){1&A&&(a.\u0275\u0275elementStart(0,"div",0)(1,"h2"),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"button",1),a.\u0275\u0275listener("click",function(){return L.closeMetadataModal()}),a.\u0275\u0275elementStart(5,"span",2),a.\u0275\u0275text(6,"\xd7"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"p"),a.\u0275\u0275text(12),a.\u0275\u0275pipe(13,"translate"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(14,"div",5)(15,"div",6),a.\u0275\u0275element(16,"hr"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(17,C,7,4,"div",7),a.\u0275\u0275elementStart(18,"div",5)(19,"div",6),a.\u0275\u0275element(20,"hr"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(21,"div",5)(22,"div",8)(23,"button",9),a.\u0275\u0275listener("click",function(){return L.import()}),a.\u0275\u0275element(24,"i",10),a.\u0275\u0275text(25),a.\u0275\u0275pipe(26,"translate"),a.\u0275\u0275elementEnd()()()()()),2&A&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,4,"submission.import-external.preview.title."+L.labelPrefix)),a.\u0275\u0275advance(10),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(13,6,"submission.import-external.preview.subtitle")),a.\u0275\u0275advance(5),a.\u0275\u0275property("ngForOf",L.metadataList),a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(26,8,"submission.import-external.preview.button.import")," "))},directives:[z.sg],pipes:[w.X$],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),K})()},76275:(ne,W,i)=>{"use strict";i.d(W,{p:()=>O});var n=i(5e3),E=i(39646),v=i(70262),e=i(18505),l=i(73529),b=i(79046),a=i(18433),F=i(99405),P=i(28737),z=i(46283),w=i(95900),C=i(38475),U=i(36877),K=i(69808),_=i(93075),A=i(17656),L=i(48689),$=i(86956);function f(y,j){if(1&y){const p=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",10)(1,"input",11),n.\u0275\u0275listener("keyup.enter",function(){n.\u0275\u0275restoreView(p);const d=n.\u0275\u0275nextContext();return""===d.searchString?null:d.search()})("ngModelChange",function(d){return n.\u0275\u0275restoreView(p),n.\u0275\u0275nextContext().searchString=d}),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd()()}if(2&y){const p=n.\u0275\u0275nextContext();n.\u0275\u0275advance(1),n.\u0275\u0275propertyInterpolate("placeholder",n.\u0275\u0275pipeBind1(2,2,"submission.import-external.search.placeholder")),n.\u0275\u0275property("ngModel",p.searchString)}}function B(y,j){if(1&y){const p=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"input",11),n.\u0275\u0275listener("keyup.enter",function(){n.\u0275\u0275restoreView(p);const d=n.\u0275\u0275nextContext();return""===d.searchString?null:d.search()})("ngModelChange",function(d){return n.\u0275\u0275restoreView(p),n.\u0275\u0275nextContext().searchString=d}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275elementEnd()}if(2&y){const p=n.\u0275\u0275nextContext();n.\u0275\u0275propertyInterpolate("placeholder",n.\u0275\u0275pipeBind1(1,2,"submission.import-external.search.placeholder")),n.\u0275\u0275property("ngModel",p.searchString)}}function u(y,j){if(1&y){const p=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",12),n.\u0275\u0275listener("click",function(){const g=n.\u0275\u0275restoreView(p).$implicit;return n.\u0275\u0275nextContext().makeSourceSelection(g)}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd()}if(2&y){const p=j.$implicit;n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.import-external.source."+(null==p?null:p.name))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,4,"submission.import-external.source."+(null==p?null:p.name)))}}function T(y,j){1&y&&(n.\u0275\u0275elementStart(0,"div",13)(1,"p"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd()()),2&y&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,1,"submission.import-external.source.loading")))}const H=function(y){return{"input-group-append":y}};let O=(()=>{class y{constructor(p,x,d){this.externalService=p,this.cdr=x,this.windowService=d,this.sourceListLoading=!1,this.externalSourceData=new n.EventEmitter}ngOnInit(){this.selectedElement={id:"",name:"loading"},this.searchString="",this.sourceList=[],this.findListOptions=Object.assign({},new U.R,{elementsPerPage:5,currentPage:1,searchParams:[new l.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,v.K)(()=>{const p=new F.S,x=(0,a.b)(p,[]),d=(0,P.AC)(x);return(0,E.of)(d)}),(0,z.Gp)()).subscribe(p=>{p.page.forEach(x=>{this.sourceList.push({id:x.id,name:x.name}),this.initExternalSourceData.sourceId===x.id&&(this.selectedElement={id:x.id,name:x.name},this.searchString=this.initExternalSourceData.query)}),""===this.selectedElement.id&&(this.selectedElement=this.sourceList[0]),this.pageInfo=p.pageInfo,this.cdr.detectChanges()}),this.isXsOrSm$=this.windowService.isXsOrSm()}makeSourceSelection(p){this.selectedElement=p}onScroll(){!this.sourceListLoading&&this.pageInfo.currentPage+1<=this.pageInfo.totalPages&&(this.sourceListLoading=!0,this.findListOptions=Object.assign({},new U.R,{elementsPerPage:5,currentPage:this.findListOptions.currentPage+1,searchParams:[new l.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,v.K)(()=>{const p=new F.S,x=(0,a.b)(p,[]),d=(0,P.AC)(x);return(0,E.of)(d)}),(0,z.xw)(),(0,e.b)(()=>this.sourceListLoading=!1)).subscribe(p=>{p.payload.page.forEach(x=>{this.sourceList.push({id:x.id,name:x.name})}),this.pageInfo=p.payload.pageInfo,this.cdr.detectChanges()}))}search(){this.externalSourceData.emit({entity:this.initExternalSourceData.entity,sourceId:this.selectedElement.id,query:this.searchString})}ngOnDestroy(){(0,C.Uh)(this.sub)&&this.sub.unsubscribe()}}return y.\u0275fac=function(p){return new(p||y)(n.\u0275\u0275directiveInject(b.z),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(w.I))},y.\u0275cmp=n.\u0275\u0275defineComponent({type:y,selectors:[["ds-submission-import-external-searchbar"]],inputs:{initExternalSourceData:"initExternalSourceData"},outputs:{externalSourceData:"externalSourceData"},decls:20,vars:31,consts:[["class","input-group mb-2",4,"ngIf"],[1,"input-group","mb-5"],["type","text","class","form-control","aria-label","","aria-describedby","",3,"ngModel","placeholder","keyup.enter","ngModelChange",4,"ngIf"],["ngbDropdown","","role","group","aria-label","",3,"ngClass"],["ngbDropdownToggle","",1,"btn","btn-outline-secondary","w-fx",3,"title"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false","aria-labelledby","scrollableDropdownMenuButton",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["aria-labelledby","scrollableDropdownMenuButton","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow","scrolled"],["ngbDropdownItem","","class","dropdown-item text-truncate",3,"title","click",4,"ngFor","ngForOf"],["ngbDropdownItem","","class","scrollable-dropdown-loading text-center",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"title","disabled","click"],[1,"input-group","mb-2"],["type","text","aria-label","","aria-describedby","",1,"form-control",3,"ngModel","placeholder","keyup.enter","ngModelChange"],["ngbDropdownItem","",1,"dropdown-item","text-truncate",3,"title","click"],["ngbDropdownItem","",1,"scrollable-dropdown-loading","text-center"]],template:function(p,x){1&p&&(n.\u0275\u0275template(0,f,3,4,"div",0),n.\u0275\u0275pipe(1,"async"),n.\u0275\u0275elementStart(2,"div",1),n.\u0275\u0275template(3,B,2,4,"input",2),n.\u0275\u0275pipe(4,"async"),n.\u0275\u0275elementStart(5,"div",3),n.\u0275\u0275pipe(6,"async"),n.\u0275\u0275elementStart(7,"button",4),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275text(9),n.\u0275\u0275pipe(10,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(11,"div",5)(12,"div",6),n.\u0275\u0275listener("scrolled",function(){return x.onScroll()}),n.\u0275\u0275template(13,u,4,6,"button",7),n.\u0275\u0275template(14,T,4,3,"div",8),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(15,"button",9),n.\u0275\u0275listener("click",function(){return x.search()}),n.\u0275\u0275pipe(16,"translate"),n.\u0275\u0275pipe(17,"translate"),n.\u0275\u0275text(18),n.\u0275\u0275pipe(19,"translate"),n.\u0275\u0275elementEnd()()()),2&p&&(n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(1,13,x.isXsOrSm$)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(4,15,x.isXsOrSm$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(29,H,!n.\u0275\u0275pipeBind1(6,17,x.isXsOrSm$))),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(8,19,"submission.import-external.search.source.hint")),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(10,21,"submission.import-external.source."+(null==x.selectedElement?null:x.selectedElement.name))),n.\u0275\u0275advance(3),n.\u0275\u0275property("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",x.sourceList),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",x.sourceListLoading),n.\u0275\u0275advance(1),n.\u0275\u0275property("title",""===x.searchString?n.\u0275\u0275pipeBind1(16,23,"submission.import-external.search.button.hint"):n.\u0275\u0275pipeBind1(17,25,"submission.import-external.search.button"))("disabled",""===x.searchString),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(19,27,"submission.import-external.search.button")))},directives:[K.O5,_.Fj,_.JJ,_.On,A.jt,K.mk,A.iD,A.Vi,L.R,K.sg,A.TH],pipes:[K.Ov,$.X$],styles:[".input-group-append[_ngcontent-%COMP%]:last-child > .btn[_ngcontent-%COMP%]:not(:last-child):not(.dropdown-toggle){margin-left:-1px;border-radius:0 .25rem .25rem 0}.input-group-append[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{border-radius:0}.w-fx[_ngcontent-%COMP%]{min-width:200px}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:calc(var(--ds-dropdown-menu-max-height) / 2);overflow-x:hidden}.scrollable-dropdown-loading[_ngcontent-%COMP%]{height:calc(var(--bs-spacer) * 2)!important}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}"]}),y})()},79657:(ne,W,i)=>{"use strict";i.r(W),i.d(W,{SubmissionImportExternalComponent:()=>Le});var n=i(61135),E=i(39841),v=i(95698),e=i(39300),l=i(63900),b=i(18505),a=i(86099),F=i(79046),P=i(18433),z=i(61107),w=i(41823),C=i(74293),U=i(9168),K=i(28737),_=i(80133),A=i(72031),L=i(99405),$=i(38475),f=i(46283),B=i(18194),u=i(5e3),T=i(74202),H=i(17656),O=i(76275),y=i(69808),j=i(41989),p=i(33098),x=i(27924),d=i(84561),g=i(86956);function h(k,_e){1&k&&(u.\u0275\u0275elementStart(0,"h3"),u.\u0275\u0275text(1),u.\u0275\u0275pipe(2,"translate"),u.\u0275\u0275elementEnd()),2&k&&(u.\u0275\u0275advance(1),u.\u0275\u0275textInterpolate(u.\u0275\u0275pipeBind1(2,1,"submission.sections.describe.relationship-lookup.selection-tab.title")))}const D=function(k,_e){return{repeatable:k,listId:_e}};function oe(k,_e){if(1&k){const R=u.\u0275\u0275getCurrentView();u.\u0275\u0275elementStart(0,"ds-viewable-collection",14),u.\u0275\u0275listener("importObject",function(fe){return u.\u0275\u0275restoreView(R),u.\u0275\u0275nextContext(4).import(fe)}),u.\u0275\u0275elementEnd()}if(2&k){const R=u.\u0275\u0275nextContext().ngVar,q=u.\u0275\u0275nextContext(3);u.\u0275\u0275property("@fadeIn",void 0)("objects",R)("selectionConfig",u.\u0275\u0275pureFunction2(8,D,q.repeatable,q.listId))("config",q.initialPagination)("hideGear",!0)("context",q.context)("importable",!0)("importConfig",q.importConfig)}}function se(k,_e){1&k&&(u.\u0275\u0275element(0,"ds-loading",15),u.\u0275\u0275pipe(1,"translate")),2&k&&u.\u0275\u0275propertyInterpolate("message",u.\u0275\u0275pipeBind1(1,1,"loading.search-results"))}function Z(k,_e){1&k&&(u.\u0275\u0275elementStart(0,"div",16)(1,"ds-alert",17),u.\u0275\u0275text(2),u.\u0275\u0275pipe(3,"translate"),u.\u0275\u0275elementEnd()()),2&k&&(u.\u0275\u0275advance(1),u.\u0275\u0275property("type","alert-info"),u.\u0275\u0275advance(1),u.\u0275\u0275textInterpolate(u.\u0275\u0275pipeBind1(3,2,"search.results.empty")))}function ce(k,_e){if(1&k&&(u.\u0275\u0275elementContainerStart(0),u.\u0275\u0275template(1,h,3,3,"h3",10),u.\u0275\u0275template(2,oe,1,11,"ds-viewable-collection",11),u.\u0275\u0275pipe(3,"async"),u.\u0275\u0275template(4,se,2,3,"ds-loading",12),u.\u0275\u0275pipe(5,"async"),u.\u0275\u0275template(6,Z,4,4,"div",13),u.\u0275\u0275pipe(7,"async"),u.\u0275\u0275elementContainerEnd()),2&k){const R=_e.ngVar,q=u.\u0275\u0275nextContext(3);u.\u0275\u0275advance(1),u.\u0275\u0275property("ngIf",R&&0!==(null==R||null==R.payload||null==R.payload.page?null:R.payload.page.length)),u.\u0275\u0275advance(1),u.\u0275\u0275property("ngIf",(null==R?null:R.hasSucceeded)&&!u.\u0275\u0275pipeBind1(3,4,q.isLoading$)&&(null==R||null==R.payload||null==R.payload.page?null:R.payload.page.length)>0),u.\u0275\u0275advance(2),u.\u0275\u0275property("ngIf",u.\u0275\u0275pipeBind1(5,6,q.isLoading$)),u.\u0275\u0275advance(2),u.\u0275\u0275property("ngIf",!u.\u0275\u0275pipeBind1(7,8,q.isLoading$)&&0===(null==R||null==R.payload||null==R.payload.page?null:R.payload.page.length))}}function N(k,_e){if(1&k&&(u.\u0275\u0275elementStart(0,"div",2),u.\u0275\u0275template(1,ce,8,10,"ng-container",9),u.\u0275\u0275pipe(2,"async"),u.\u0275\u0275elementEnd()),2&k){const R=u.\u0275\u0275nextContext(2);u.\u0275\u0275advance(1),u.\u0275\u0275property("ngVar",u.\u0275\u0275pipeBind1(2,1,R.entriesRD$))}}function ae(k,_e){1&k&&(u.\u0275\u0275elementStart(0,"div",2)(1,"ds-alert",17)(2,"p",18),u.\u0275\u0275text(3),u.\u0275\u0275pipe(4,"translate"),u.\u0275\u0275elementEnd()()()),2&k&&(u.\u0275\u0275advance(1),u.\u0275\u0275property("type","alert-info"),u.\u0275\u0275advance(2),u.\u0275\u0275textInterpolate(u.\u0275\u0275pipeBind1(4,2,"submission.import-external.page.hint")))}function ue(k,_e){if(1&k&&(u.\u0275\u0275elementStart(0,"div",1),u.\u0275\u0275template(1,N,3,3,"div",8),u.\u0275\u0275template(2,ae,5,4,"div",8),u.\u0275\u0275elementEnd()),2&k){const R=u.\u0275\u0275nextContext();u.\u0275\u0275advance(1),u.\u0275\u0275property("ngIf",""!==R.reload$.value.sourceId),u.\u0275\u0275advance(1),u.\u0275\u0275property("ngIf",""===R.reload$.value.sourceId)}}const V=function(){return["/mydspace"]};let Le=(()=>{class k{constructor(R,q,fe,Te,Ne){this.searchConfigService=R,this.externalService=q,this.routeService=fe,this.router=Te,this.modalService=Ne,this.entriesRD$=new n.X(null),this.isLoading$=new n.X(!1),this.reload$=new n.X({entity:"",query:"",sourceId:""}),this.initialPagination=Object.assign(new C.r,{id:"spc",pageSize:10}),this.subs=[]}ngOnInit(){this.listId="list-submission-external-sources",this.context=w._.EntitySearchModalWithNameVariants,this.repeatable=!1,this.routeData={entity:"",sourceId:"",query:""},this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label},this.entriesRD$=new n.X((0,K.AC)((0,P.b)(new L.S,[]))),this.isLoading$=new n.X(!1),this.subs.push((0,E.a)([this.routeService.getQueryParameterValue("entity"),this.routeService.getQueryParameterValue("sourceId"),this.routeService.getQueryParameterValue("query")]).pipe((0,v.q)(1)).subscribe(([R,q,fe])=>{this.reload$.next({entity:R||B.N,query:fe,sourceId:q}),this.selectLabel(R),this.retrieveExternalSources()}))}getExternalSourceData(R){this.router.navigate([],{queryParams:R,replaceUrl:!0}).then(()=>{this.reload$.next(R),this.retrieveExternalSources()})}import(R){this.modalRef=this.modalService.open(_.v,{size:"lg"});const q=this.modalRef.componentInstance;q.externalSourceEntry=R,q.labelPrefix=this.label}ngOnDestroy(){this.subs.filter(R=>(0,$.Uh)(R)).forEach(R=>R.unsubscribe()),(0,$.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe()}retrieveExternalSources(){(0,$.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe(),this.retrieveExternalSourcesSub=this.reload$.pipe((0,e.h)(R=>(0,$.UE)(R.sourceId)&&(0,$.UE)(R.query)),(0,l.w)(R=>{const q=R.query;return this.routeData=R,this.searchConfigService.paginatedSearchOptions.pipe((0,b.b)(()=>this.isLoading$.next(!0)),(0,e.h)(fe=>fe.query===q),(0,a.z)(fe=>this.externalService.getExternalSourceEntries(this.routeData.sourceId,fe).pipe((0,f.sJ)())))})).subscribe(R=>{this.entriesRD$.next(R),this.isLoading$.next(!1)})}selectLabel(R){this.label=R,this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label}}}return k.\u0275fac=function(R){return new(R||k)(u.\u0275\u0275directiveInject(z.U),u.\u0275\u0275directiveInject(F.z),u.\u0275\u0275directiveInject(U.MZ),u.\u0275\u0275directiveInject(T.F0),u.\u0275\u0275directiveInject(H.FF))},k.\u0275cmp=u.\u0275\u0275defineComponent({type:k,selectors:[["ds-submission-import-external"]],decls:15,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],["id","header",1,"pb-2"],[3,"initExternalSourceData","externalSourceData"],["class","row",4,"ngIf"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-chevron-left"],["class","col-md-12",4,"ngIf"],[4,"ngVar"],[4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject",4,"ngIf"],[3,"message",4,"ngIf"],["id","empty-external-entry-list",4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject"],[3,"message"],["id","empty-external-entry-list"],[3,"type"],[1,"lead","mb-0"]],template:function(R,q){1&R&&(u.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),u.\u0275\u0275text(4),u.\u0275\u0275pipe(5,"translate"),u.\u0275\u0275elementEnd(),u.\u0275\u0275elementStart(6,"ds-submission-import-external-searchbar",4),u.\u0275\u0275listener("externalSourceData",function(Te){return q.getExternalSourceData(Te)}),u.\u0275\u0275elementEnd()()(),u.\u0275\u0275template(7,ue,3,2,"div",5),u.\u0275\u0275elementStart(8,"div",1)(9,"div",2),u.\u0275\u0275element(10,"hr"),u.\u0275\u0275elementStart(11,"a",6),u.\u0275\u0275element(12,"i",7),u.\u0275\u0275text(13),u.\u0275\u0275pipe(14,"translate"),u.\u0275\u0275elementEnd()()()()),2&R&&(u.\u0275\u0275advance(4),u.\u0275\u0275textInterpolate(u.\u0275\u0275pipeBind1(5,5,"submission.import-external.title"+(q.label?"."+q.label:""))),u.\u0275\u0275advance(2),u.\u0275\u0275property("initExternalSourceData",q.reload$.value),u.\u0275\u0275advance(1),u.\u0275\u0275property("ngIf",q.reload$.value.entity),u.\u0275\u0275advance(4),u.\u0275\u0275property("routerLink",u.\u0275\u0275pureFunction0(9,V)),u.\u0275\u0275advance(2),u.\u0275\u0275textInterpolate1(" ",u.\u0275\u0275pipeBind1(14,7,"submission.import-external.back-to-my-dspace")," "))},directives:[O.p,y.O5,j.g,p.c,x.N,d.w,T.yS],pipes:[g.X$,y.Ov],styles:[""],data:{animation:[A.Ji]}}),k})()},59161:(ne,W,i)=>{"use strict";i.d(W,{i:()=>e});var n=i(79094),E=i(5e3);function v(l,b){}let e=(()=>{class l extends n.F{getComponentName(){return"SubmissionImportExternalComponent"}importThemedComponent(a){return i(49252)(`./${a}/app/submission/import-external/submission-import-external.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,79657))}}return l.\u0275fac=function(){let b;return function(F){return(b||(b=E.\u0275\u0275getInheritedFactory(l)))(F||l)}}(),l.\u0275cmp=E.\u0275\u0275defineComponent({type:l,selectors:[["ds-themed-submission-import-external"]],features:[E.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,F){1&a&&E.\u0275\u0275template(0,v,0,0,"ng-template",null,0,E.\u0275\u0275templateRefExtractor)},encapsulation:2}),l})()},2077:(ne,W,i)=>{"use strict";i.d(W,{y:()=>j});var n=i(5e3),E=i(64396),v=i(99414),e=i(60300),l=i(69808),b=i(17656),a=i(84561),F=i(86956);const P=["sectionRef"];function z(p,x){1&p&&(n.\u0275\u0275element(0,"i",18),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&p&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.warnings.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.warnings.aria")))}function w(p,x){1&p&&(n.\u0275\u0275element(0,"i",19),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&p&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.errors.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.errors.aria")))}function C(p,x){1&p&&(n.\u0275\u0275element(0,"i",20),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&p&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.valid.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.valid.aria")))}function U(p,x){1&p&&(n.\u0275\u0275element(0,"i",21),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&p&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.info.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.info.aria")))}const K=function(p){return{"text-white":p}};function _(p,x){if(1&p&&n.\u0275\u0275element(0,"span",22),2&p){n.\u0275\u0275nextContext(3);const d=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(1,K,d.isInfo()))}}function A(p,x){1&p&&n.\u0275\u0275element(0,"span",23)}function L(p,x){if(1&p){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"a",24),n.\u0275\u0275listener("click",function(h){return n.\u0275\u0275restoreView(d),n.\u0275\u0275nextContext(3).removeSection(h)}),n.\u0275\u0275element(1,"i",25),n.\u0275\u0275elementEnd()}}const $=function(p){return{sectionHeader:p}};function f(p,x){if(1&p&&(n.\u0275\u0275elementStart(0,"span",8),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"div",9),n.\u0275\u0275template(4,z,3,6,"i",10),n.\u0275\u0275pipe(5,"async"),n.\u0275\u0275template(6,w,3,6,"i",11),n.\u0275\u0275template(7,C,3,6,"i",12),n.\u0275\u0275pipe(8,"async"),n.\u0275\u0275template(9,U,3,6,"i",13),n.\u0275\u0275elementStart(10,"a",14),n.\u0275\u0275pipe(11,"translate"),n.\u0275\u0275pipe(12,"translate"),n.\u0275\u0275pipe(13,"translate"),n.\u0275\u0275template(14,_,1,3,"span",15),n.\u0275\u0275template(15,A,1,0,"span",16),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(16,L,2,0,"a",17),n.\u0275\u0275elementEnd()),2&p){const d=n.\u0275\u0275nextContext(2),g=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(24,K,g.isInfo())),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(2,11,"submission.sections."+d.sectionData.header)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(5,13,g.isValid())&&!g.hasErrors()&&!g.isInfo()),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",g.hasErrors()&&!g.isInfo()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(8,15,g.isValid())&&!g.hasErrors()&&!g.isInfo()),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",g.isInfo()),n.\u0275\u0275advance(1),n.\u0275\u0275property("title",n.\u0275\u0275pipeBind1(13,22,g.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind2(11,17,g.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",n.\u0275\u0275pureFunction1(26,$,n.\u0275\u0275pipeBind1(12,20,"submission.sections."+d.sectionData.header)))),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngIf",g.isOpen()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!g.isOpen()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!g.isMandatory())}}function B(p,x){if(1&p){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ds-alert",31),n.\u0275\u0275listener("close",function(){const D=n.\u0275\u0275restoreView(d).index;return n.\u0275\u0275nextContext(4),n.\u0275\u0275reference(1).removeError(D)}),n.\u0275\u0275elementEnd()}if(2&p){const d=x.$implicit,g=n.\u0275\u0275nextContext(4);n.\u0275\u0275property("content",d)("dismissible",!0)("type",g.AlertTypeEnum.Error)}}function u(p,x){if(1&p&&(n.\u0275\u0275elementStart(0,"div",29),n.\u0275\u0275template(1,B,1,3,"ds-alert",30),n.\u0275\u0275elementEnd()),2&p){const d=n.\u0275\u0275nextContext(3),g=n.\u0275\u0275reference(1);n.\u0275\u0275propertyInterpolate1("id","sectionGenericError_",d.sectionData.id,""),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",g.getErrors())}}function T(p,x){1&p&&n.\u0275\u0275elementContainer(0)}function H(p,x){if(1&p){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275template(0,u,2,2,"div",26),n.\u0275\u0275elementStart(1,"div",27),n.\u0275\u0275listener("click",function(h){return n.\u0275\u0275restoreView(d),n.\u0275\u0275nextContext(2),n.\u0275\u0275reference(1).setFocus(h)}),n.\u0275\u0275template(2,T,1,0,"ng-container",28),n.\u0275\u0275elementEnd()}if(2&p){const d=n.\u0275\u0275nextContext(2),g=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngIf",g.hasGenericErrors()),n.\u0275\u0275advance(1),n.\u0275\u0275propertyInterpolate1("id","sectionContent_",d.sectionData.id,""),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngComponentOutlet",d.getSectionContent())("ngComponentOutletInjector",d.objectInjector)}}function O(p,x){if(1&p){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ngb-accordion",3,4),n.\u0275\u0275listener("panelChange",function(h){return n.\u0275\u0275restoreView(d),n.\u0275\u0275nextContext(),n.\u0275\u0275reference(1).sectionChange(h)}),n.\u0275\u0275elementStart(2,"ngb-panel",5),n.\u0275\u0275template(3,f,17,28,"ng-template",6),n.\u0275\u0275template(4,H,3,4,"ng-template",7),n.\u0275\u0275elementEnd()()}if(2&p){const d=n.\u0275\u0275nextContext(),g=n.\u0275\u0275reference(1);n.\u0275\u0275propertyInterpolate("activeIds",d.sectionData.id),n.\u0275\u0275property("destroyOnHide",!1),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("id",d.sectionData.id),n.\u0275\u0275property("type",g.isInfo()?"info":"")}}const y=function(p){return{"section-focus":p}};let j=(()=>{class p{constructor(d){this.injector=d,this.AlertTypeEnum=e.N}ngOnInit(){this.objectInjector=n.Injector.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(d){d.preventDefault(),d.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return(0,v.A)(this.sectionData.sectionType)}}return p.\u0275fac=function(d){return new(d||p)(n.\u0275\u0275directiveInject(n.Injector))},p.\u0275cmp=n.\u0275\u0275defineComponent({type:p,selectors:[["ds-submission-section-container"]],viewQuery:function(d,g){if(1&d&&n.\u0275\u0275viewQuery(P,5),2&d){let h;n.\u0275\u0275queryRefresh(h=n.\u0275\u0275loadQuery())&&(g.sectionRef=h.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},decls:4,vars:11,consts:[["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],["sectionRef","sectionRef"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"activeIds","destroyOnHide","panelChange"],["acc","ngbAccordion"],[3,"id","type"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title",3,"ngClass"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-info-circle mr-3 text-white","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",3,"ngClass",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],["role","img",1,"fas","fa-info-circle","mr-3","text-white",3,"title"],[1,"fas","fa-chevron-up","fa-fw",3,"ngClass"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"id","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"id"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"content","dismissible","type","close"]],template:function(d,g){if(1&d&&(n.\u0275\u0275elementStart(0,"div",0,1),n.\u0275\u0275template(2,O,5,4,"ngb-accordion",2),n.\u0275\u0275pipe(3,"async"),n.\u0275\u0275elementEnd()),2&d){const h=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(9,y,h.isSectionActive()))("mandatory",g.sectionData.mandatory)("submissionId",g.submissionId)("sectionType",g.sectionData.sectionType)("sectionId",g.sectionData.id),n.\u0275\u0275attribute("id","section_"+g.sectionData.id),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(3,7,h.isEnabled()))}},directives:[E.y,l.mk,l.O5,b.gY,b.Gk,b.Cu,b.gW,l.sg,a.w,l.$G],pipes:[l.Ov,F.X$],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important}[_nghost-%COMP%]     .card-header button{width:100%}"]}),p})()},99414:(ne,W,i)=>{"use strict";i.d(W,{E:()=>E,A:()=>v});const n=new Map;function E(e){return function(b){!b||n.set(e,b)}}function v(e){return n.get(e)}},6991:(ne,W,i)=>{"use strict";i.d(W,{i:()=>n});var n=(()=>{return(E=n||(n={})).Relationships="relationships",E.SubmissionForm="submission-form",E.Upload="upload",E.License="license",E.CcLicense="cclicense",E.collection="collection",E.AccessesCondition="accessCondition",E.SherpaPolicies="sherpaPolicy",n;var E})()},64396:(ne,W,i)=>{"use strict";i.d(W,{y:()=>P});var n=i(54004),E=i(17489),e=i(74033),l=i(38475),b=i(55457),a=i(20445),F=i(5e3);let P=(()=>{class z{constructor(C,U,K){this.changeDetectorRef=C,this.submissionService=U,this.sectionService=K,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,n.U)(C=>(C&&this.resetErrors(),C))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(C=>{(0,l.UE)(C)?C.forEach(U=>{(0,b.Z)(U.path).forEach(_=>{_.fieldId?this.allSectionErrors.push(U.message):this.genericSectionErrors=(0,E.uniq)(this.genericSectionErrors.concat(U.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(C=>{const U=this.active;this.active=C===this.sectionId,U!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,l.K0)(C)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(C=>(0,l.Uh)(C)).forEach(C=>C.unsubscribe())}sectionChange(C){this.sectionState=C.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(C,U){this.sectionService.removeSection(C,U)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(C){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(C){this.genericSectionErrors.splice(C)}resetErrors(){(0,l.UE)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}}return z.\u0275fac=function(C){return new(C||z)(F.\u0275\u0275directiveInject(F.ChangeDetectorRef),F.\u0275\u0275directiveInject(a.b),F.\u0275\u0275directiveInject(e.J))},z.\u0275dir=F.\u0275\u0275defineDirective({type:z,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"]}),z})()},74033:(ne,W,i)=>{"use strict";i.d(W,{J:()=>j});var n=i(39841),E=i(54004),v=i(71884),e=i(86099),l=i(39300),b=i(95698),a=i(17489),P=i(38475),z=i(20619),w=i(35709),C=i(46144),U=i(55457),K=i(11355),_=i(55489),A=i(20445),L=i(6991),$=i(99944),f=i(8108),B=i(57149),u=i(86656),T=i(5e3),H=i(13909),O=i(65620),y=i(86956);let j=(()=>{class p{constructor(d,g,h,D,oe,se){this.formService=d,this.notificationsService=g,this.scrollToService=h,this.submissionService=D,this.store=oe,this.translate=se}checkSectionErrors(d,g,h,D,oe=[]){if((0,P.xb)(D))this.store.dispatch(new z.QC(d,g)),this.store.dispatch(new K.y5(h));else if(!(0,a.isEqual)(D,oe)){const se=[];D.forEach(Z=>{(0,U.Z)(Z.path).forEach(N=>{N.fieldId&&(this.formService.addError(h,N.fieldId,N.fieldIndex,Z.message),se.push(N.fieldId))})}),oe.forEach(Z=>{(0,U.Z)(Z.path).forEach(N=>{N.fieldId&&(se.includes(N.fieldId)||this.formService.removeError(h,N.fieldId,N.fieldIndex))})})}}dispatchRemoveSectionErrors(d,g){this.store.dispatch(new z.QC(d,g))}dispatchSetSectionFormId(d,g,h){this.store.dispatch(new z.re(d,g,h))}getSectionData(d,g,h){return this.store.select((0,w.y5)(d,g)).pipe((0,E.U)(D=>h===L.i.SubmissionForm?(0,$.Vv)(D):D),(0,v.x)())}getShownSectionErrors(d,g,h){let D;return D=h!==L.i.SubmissionForm?this.getSectionErrors(d,g):this.getSectionState(d,g,h).pipe((0,e.z)(oe=>this.formService.getFormErrors(oe.formId).pipe((0,E.U)(se=>{const Z=new u.K("sections",g),ce=se.map(N=>({path:Z.getPath(N.fieldId.replace(/\_/g,".")).path,message:N.message})).filter(N=>-1===(0,a.findIndex)(oe.errorsToShow,{path:N.path}));return[...oe.errorsToShow,...ce]})))),D}getSectionErrors(d,g){return this.store.select((0,w.Mb)(d,g)).pipe((0,v.x)())}getSectionServerErrors(d,g){return this.store.select((0,w.fh)(d,g)).pipe((0,v.x)())}getSectionState(d,g,h){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(D=>(0,P.Uh)(D)),(0,E.U)(D=>D),(0,E.U)(D=>(0,P.Uh)(D.data)&&h===L.i.SubmissionForm?Object.assign({},D,{data:(0,$.Vv)(D.data)}):D),(0,v.x)())}isSectionValid(d,g){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(h=>(0,P.Uh)(h)),(0,E.U)(h=>h.isValid),(0,v.x)())}isSectionActive(d,g){return this.submissionService.getActiveSectionId(d).pipe((0,E.U)(h=>g===h),(0,v.x)())}isSectionEnabled(d,g){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(h=>(0,P.Uh)(h)),(0,E.U)(h=>h.enabled),(0,v.x)())}isSectionReadOnly(d,g,h){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(D=>(0,P.Uh)(D)),(0,E.U)(D=>(0,P.UE)(D.visibility)&&"READONLY"===D.visibility.other&&h!==C.S.WorkspaceItem),(0,v.x)())}isSectionAvailable(d,g){return this.store.select((0,w.ak)(d)).pipe((0,l.h)(h=>(0,P.pT)(h)),(0,E.U)(h=>(0,P.pT)(h.sections)&&(0,P.pT)(h.sections[g])),(0,v.x)())}isSectionTypeAvailable(d,g){return this.store.select((0,w.ak)(d)).pipe((0,l.h)(h=>(0,P.pT)(h)),(0,E.U)(h=>(0,P.pT)(h.sections)&&(0,P.pT)((0,a.findKey)(h.sections,{sectionType:g}))),(0,v.x)())}isSectionType(d,g,h){return this.store.select((0,w.ak)(d)).pipe((0,l.h)(D=>(0,P.pT)(D)),(0,E.U)(D=>(0,P.pT)(D.sections)&&(0,P.pT)(D.sections[g])&&D.sections[g].sectionType===h),(0,v.x)())}addSection(d,g){this.store.dispatch(new z.gn(d,g)),this.scrollToService.scrollTo({target:g,offset:-70})}removeSection(d,g){this.store.dispatch(new z.s0(d,g))}updateSectionData(d,g,h,D=[],oe=[],se){if((0,P.UE)(h)){const Z=this.isSectionAvailable(d,g),ce=this.isSectionEnabled(d,g);(0,n.a)(Z,ce).pipe((0,b.q)(1),(0,l.h)(([N,ae])=>N)).subscribe(([N,ae])=>{this.store.dispatch(new z.z6(d,g,h,D,oe,se))})}}setSectionError(d,g,h){this.store.dispatch(new z.uO(d,g,h))}setSectionStatus(d,g,h){this.store.dispatch(new z.hx(d,g,h))}computeSectionConfiguredMetadata(d){const g=[],h="string"==typeof d?JSON.parse(d,f.WMN):d;return h.rows&&!(0,P.xb)(h.rows)&&h.rows.forEach(D=>{D.fields&&!(0,P.xb)(D.fields)&&D.fields.forEach(oe=>{oe.selectableMetadata&&!(0,P.xb)(oe.selectableMetadata)&&oe.selectableMetadata.forEach(se=>{g.includes(se.metadata)||g.push(se.metadata)})})}),g}getIsInformational(d){return d===L.i.SherpaPolicies}}return p.\u0275fac=function(d){return new(d||p)(T.\u0275\u0275inject(B.o),T.\u0275\u0275inject(_.T),T.\u0275\u0275inject(H.ij),T.\u0275\u0275inject(A.b),T.\u0275\u0275inject(O.yh),T.\u0275\u0275inject(y.sK))},p.\u0275prov=T.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac}),p})()},94067:(ne,W,i)=>{"use strict";i.d(W,{o:()=>uo});var n=i(72081),E=i(42501),v=i(70655),e=i(5e3),l=i(39841),b=i(54004),a=i(18505),F=i(86099),P=i(95698),z=i(40367),w=i(71884),C=i(39300),U=i(86956),K=i(17489),_=i(94407),A=i(50358),L=i(57149),$=i(68675),f=i(38475);let B=(()=>{class o{constructor(t,r,c){this.injectedCollectionId=t,this.injectedSectionData=r,this.injectedSubmissionId=c,this.collectionId=t,this.sectionData=r,this.submissionId=c}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,C.h)(t=>(0,f.pT)(t)),(0,$.O)(!0)).subscribe(t=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,t)})}ngOnDestroy(){(0,f.Uh)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(t,r){},encapsulation:2}),o})();var u=i(91046),T=i(86656);class H{constructor(s=null,t=null){this._path=s,this._value=t}get path(){return this._path}set path(s){this._path=s}get value(){return this._value}set value(s){this._value=s}delete(){this._value=null,this._path=null}isPathEqual(s){return this._path&&(0,K.isEqual)(this._path,s)}}var O=i(99414),y=i(6991),j=i(20445),p=i(23481),x=i(55489),d=i(74033),g=i(22661),h=i(6177),D=i(46283),oe=i(7068),se=i(27139),Z=i(64025),ce=i(18838),N=i(41298),ae=i(46144),ue=i(29305),V=i(69808),Le=i(27924);const k=["formRef"];function _e(o,s){1&o&&e.\u0275\u0275element(0,"ds-loading",2)}function R(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",3,4),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)})("dfFocus",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onFocus(c)})("remove",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)})("ngbEvent",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCustomEvent(c)})("removeArrayItem",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!1)("displayCancel",!1)}}let q=class extends B{constructor(s,t,r,c,m,I,M,X,te,S,G,le,Q,ie,pe){super(Q,ie,pe),this.cdr=s,this.formBuilderService=t,this.formOperationsService=r,this.formService=c,this.formConfigService=m,this.notificationsService=I,this.sectionService=M,this.submissionService=X,this.translate=te,this.submissionObjectService=S,this.objectCache=G,this.requestService=le,this.injectedCollectionId=Q,this.injectedSectionData=ie,this.injectedSubmissionId=pe,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new H,this.subs=[]}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,b.U)(s=>s.payload),(0,a.b)(s=>this.formConfig=s),(0,F.z)(()=>(0,l.a)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,ce.l)("item")).pipe((0,D.xw)(),(0,D.xe)())])),(0,P.q)(1)).subscribe(([s,t])=>{(0,f.o8)(this.formModel)&&(this.submissionObject=t,this.initForm(s),this.sectionData.data=s,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}getSectionStatus(){const s=this.formService.isValid(this.formId),t=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,b.U)(r=>(0,f.xb)(r)));return(0,l.a)([s,t]).pipe((0,b.U)(([r,c])=>r&&c))}hasMetadataEnrichment(s){const t={};Object.keys(s).forEach(m=>{this.sectionMetadata&&this.sectionMetadata.includes(m)&&this.inCurrentSubmissionScope(m)&&(t[m]=s[m])});const r=[],c=(0,g.e5)(t,this.formData);return Object.keys(c).forEach(m=>{c[m].forEach(I=>{I.hasOwnProperty("value")&&(0,K.findIndex)(this.formData[m],{value:I.value})<0&&r.push(I)})}),(0,f.UE)(r)}inCurrentSubmissionScope(s){var t,r,c;switch(null===(c=null===(r=null===(t=this.formConfig)||void 0===t?void 0:t.rows.find(I=>{var M,X,te,S;return(null===(S=null===(te=null===(X=null===(M=I.fields)||void 0===M?void 0:M[0])||void 0===X?void 0:X.selectableMetadata)||void 0===te?void 0:te[0])||void 0===S?void 0:S.metadata)===s}).fields)||void 0===r?void 0:r[0])||void 0===c?void 0:c.scope){case ae.S.WorkspaceItem:return this.submissionObject.type===h.K.type;case ae.S.WorkflowItem:return this.submissionObject.type===ue.p.type;default:return!0}}initForm(s){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,s,this.submissionService.getSubmissionScope());const t=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,s,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors,t)}catch(t){const c={message:this.translate.instant("error.submission.sections.init-form-error")+t.toString(),path:"/sections/"+this.sectionData.id};console.error(t.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,c)}}updateForm(s,t){(0,f.UE)(s)&&!(0,K.isEqual)(s,this.sectionData.data)?(this.sectionData.data=s,this.hasMetadataEnrichment(s)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(s),this.checksForErrors(t),this.isUpdating=!1,this.cdr.detectChanges()):((0,f.UE)(t)||(0,f.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(t)):((0,f.UE)(t)||(0,f.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(t)}checksForErrors(s){this.formService.isFormInitialized(this.formId).pipe((0,z.s)(t=>!0===t&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,s,this.sectionData.errorsToShow),this.sectionData.errorsToShow=s,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,w.x)()).subscribe(s=>{this.formData=s}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,C.h)(s=>(0,f.UE)(s)&&((0,f.UE)(s.data)||(0,f.UE)(s.errorsToShow))),(0,w.x)()).subscribe(s=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=s.metadata,this.updateForm(s.data,s.errorsToShow)}))}onChange(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(s.model),this.formOperationsService.getArrayIndexFromEvent(s)));const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);(-1!==N.N.submission.autosave.metadata.indexOf(t)&&(0,f.UE)(r)||this.hasRelatedCustomError(t))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(s){const t=(0,K.findIndex)(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(s).path});if(-1!==t){const c=this.sectionData.errorsToShow[t].message.replace("error.validation.","");return!N.N.form.validatorMap.hasOwnProperty(c)}return!1}onFocus(s){const t=this.formOperationsService.getFieldValueFromChangeEvent(s),r=this.formBuilderService.getPath(s.model);this.formBuilderService.hasMappedGroupValue(s.model)?(this.previousValue.path=r,this.previousValue.value=this.formOperationsService.getQualdropValueMap(s)):(0,f.UE)(t)&&("object"==typeof t&&(0,f.UE)(t.value)||"string"==typeof t)&&(this.previousValue.path=r,this.previousValue.value=t)}onRemove(s){const t=this.formBuilderService.getId(s.model),r=this.formOperationsService.getArrayIndexFromEvent(s);if(this.fieldsOnTheirWayToBeRemoved.has(t)){const c=this.fieldsOnTheirWayToBeRemoved.get(t);c.push(r),this.fieldsOnTheirWayToBeRemoved.set(t,c)}else this.fieldsOnTheirWayToBeRemoved.set(t,[r]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(t,r))}hasStoredValue(s,t){return!!(0,f.UE)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(s)&&(0,f.UE)(this.sectionData.data[s][t])&&!this.isFieldToRemove(s,t)}isFieldToRemove(s,t){return this.fieldsOnTheirWayToBeRemoved.has(s)&&this.fieldsOnTheirWayToBeRemoved.get(s).includes(t)}onCustomEvent(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,null)}};q.\u0275fac=function(s){return new(s||q)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(p.m),e.\u0275\u0275directiveInject(L.o),e.\u0275\u0275directiveInject(u.a),e.\u0275\u0275directiveInject(x.T),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(U.sK),e.\u0275\u0275directiveInject(oe.O),e.\u0275\u0275directiveInject(se.a),e.\u0275\u0275directiveInject(Z.s),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},q.\u0275cmp=e.\u0275\u0275defineComponent({type:q,selectors:[["ds-submission-section-form"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(k,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem"],["formRef","formComponent"]],template:function(s,t){1&s&&(e.\u0275\u0275template(0,_e,1,0,"ds-loading",0),e.\u0275\u0275template(1,R,2,4,"ds-form",1)),2&s&&(e.\u0275\u0275property("ngIf",t.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.isLoading&&t.formModel))},directives:[V.O5,Le.N,A.U],styles:[""]}),q=(0,v.gn)([(0,O.E)(y.i.SubmissionForm),(0,v.w6)("design:paramtypes",[e.ChangeDetectorRef,_.c,p.m,L.o,u.a,x.T,d.J,j.b,U.sK,oe.O,se.a,Z.s,String,Object,String])],q);i(64396),i(36262),i(16949),i(44064),i(94375),i(2077);var Ee=i(65620),J=i(26991),St=i(4380),ze=i(50457),he=i(39646),ve=i(63900),Me=i(70262),Ue=i(11365),Fe=i(45269),Ct=i(35473),Y=i(20619),Et=i(55457);function xt(o,s,t){return o?o[s.sections[t].formId]:null}function yt(o,s,t,r){if(r||t!==y.i.SubmissionForm)return s;if(!o||!o.touched)return[];const c=[];return s.forEach(m=>{(0,Et.Z)(m.path).forEach(M=>{M.fieldId&&o.touched[M.fieldId]&&c.push(m)})}),c}const Dt=[(()=>{class o{constructor(t,r,c,m,I,M,X,te){this.actions$=t,this.notificationsService=r,this.operationsService=c,this.sectionService=m,this.store$=I,this.submissionService=M,this.submissionObjectService=X,this.translate=te,this.loadForm$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.INIT_SUBMISSION_FORM),(0,b.U)(S=>{const G=S.payload.submissionDefinition,le=[];return G.sections.page.forEach(Q=>{const ie=Q._links.self.href||Q._links.self,pe=ie.substr(ie.lastIndexOf("/")+1),me=Q._links.config?Q._links.config.href||Q._links.config:"",de=Q.mandatory||(0,f.UE)(S.payload.sections)&&S.payload.sections.hasOwnProperty(pe);let re;re=Q.sectionType!==y.i.SubmissionForm?(0,f.pT)(S.payload.sections)&&(0,f.pT)(S.payload.sections[pe])?S.payload.sections[pe]:Object.create(null):S.payload.item.metadata;const Pe=(0,f.UE)(S.payload.errors)&&S.payload.errors[pe]||null;le.push(new Y.qK(S.payload.submissionId,pe,Q.header,me,Q.mandatory,Q.sectionType,Q.visibility,de,re,Pe))}),{action:S,definition:G,mappedActions:le}}),(0,F.z)(S=>(0,ze.D)(S.mappedActions.concat(new Y.p3(S.action.payload.submissionId)))))),this.resetForm$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.RESET_SUBMISSION_FORM),(0,b.U)(S=>new Y.Xq(S.payload.collectionId,S.payload.submissionId,S.payload.selfUrl,S.payload.submissionDefinition,S.payload.sections,S.payload.item,null)))),this.saveSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_SUBMISSION_FORM),(0,ve.w)(S=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections").pipe((0,b.U)(G=>new Y.Uq(S.payload.submissionId,G,S.payload.isManual,S.payload.isManual)),(0,Me.K)(()=>(0,he.of)(new Y.ec(S.payload.submissionId))))))),this.saveForLaterSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_FOR_LATER_SUBMISSION_FORM),(0,ve.w)(S=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections").pipe((0,b.U)(G=>new Y.gA(S.payload.submissionId,G)),(0,Me.K)(()=>(0,he.of)(new Y.ec(S.payload.submissionId))))))),this.saveSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_SUBMISSION_FORM_SUCCESS),(0,Ue.M)(this.store$),(0,b.U)(([S,G])=>this.parseSaveResponse(G.submission.objects[S.payload.submissionId],S.payload.submissionObject,S.payload.submissionId,G.forms,S.payload.showNotifications,S.payload.showErrors)),(0,F.z)(S=>(0,ze.D)(S)))),this.saveSubmissionSectionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_SUBMISSION_SECTION_FORM_SUCCESS),(0,Ue.M)(this.store$),(0,b.U)(([S,G])=>this.parseSaveResponse(G.submission.objects[S.payload.submissionId],S.payload.submissionObject,S.payload.submissionId,G.forms,!1,!1)),(0,F.z)(S=>(0,ze.D)(S)))),this.saveSection$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_SUBMISSION_SECTION_FORM),(0,ve.w)(S=>this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections",S.payload.sectionId).pipe((0,b.U)(G=>new Y.hM(S.payload.submissionId,G)),(0,Me.K)(()=>(0,he.of)(new Y.cT(S.payload.submissionId))))))),this.saveError$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_SUBMISSION_FORM_ERROR,Y.tI.SAVE_SUBMISSION_SECTION_FORM_ERROR),(0,Ue.M)(this.store$),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.save_error_notice")))),{dispatch:!1}),this.saveAndDeposit$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_AND_DEPOSIT_SUBMISSION),(0,Ue.M)(this.submissionService.hasUnsavedModification()),(0,ve.w)(([S,G])=>{let le;return le=G?this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections"):this.submissionObjectService.findById(S.payload.submissionId,!1,!0).pipe((0,D.Gp)(),(0,b.U)(Q=>[Q])),le.pipe((0,b.U)(Q=>this.canDeposit(Q)?new Y.wn(S.payload.submissionId):(this.notificationsService.warning(null,this.translate.instant("submission.sections.general.cannot_deposit"),null,!0),new Y.Uq(S.payload.submissionId,Q,!1,!0))),(0,Me.K)(()=>(0,he.of)(new Y.ec(S.payload.submissionId))))}))),this.depositSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.DEPOSIT_SUBMISSION),(0,Ue.M)(this.store$),(0,ve.w)(([S,G])=>this.submissionService.depositSubmission(G.submission.objects[S.payload.submissionId].selfUrl).pipe((0,b.U)(()=>new Y.e7(S.payload.submissionId)),(0,Me.K)(le=>(0,he.of)(new Y.jn(S.payload.submissionId))))))),this.saveForLaterSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.SAVE_FOR_LATER_SUBMISSION_FORM_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.DEPOSIT_SUBMISSION_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.deposit_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionError$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.DEPOSIT_SUBMISSION_ERROR),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.deposit_error_notice")))),{dispatch:!1}),this.discardSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.DISCARD_SUBMISSION),(0,ve.w)(S=>this.submissionService.discardSubmission(S.payload.submissionId).pipe((0,b.U)(()=>new Y._w(S.payload.submissionId)),(0,Me.K)(()=>(0,he.of)(new Y.kj(S.payload.submissionId))))))),this.addAllMetadataToSectionData=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.UPDATE_SECTION_DATA),(0,ve.w)(S=>this.sectionService.getSectionState(S.payload.submissionId,S.payload.sectionId,y.i.Upload).pipe((0,b.U)(G=>[S,G]),(0,P.q)(1))),(0,C.h)(([S,G])=>G.sectionType===y.i.SubmissionForm),(0,ve.w)(([S,G])=>G.sectionType===y.i.SubmissionForm?this.submissionObjectService.findById(S.payload.submissionId,!0,!1,(0,ce.l)("item")).pipe((0,D.Gp)()).pipe((0,ve.w)(ie=>ie.item.pipe((0,D.Gp)()))).pipe((0,b.U)(ie=>ie.metadata),(0,C.h)(ie=>!(0,K.isEqual)(S.payload.data,ie)),(0,b.U)(ie=>new Y.z6(S.payload.submissionId,S.payload.sectionId,ie,S.payload.errorsToShow,S.payload.serverValidationErrors,S.payload.metadata))):(0,he.of)(new Y.jQ)))),this.discardSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.DISCARD_SUBMISSION_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.discard_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.discardSubmissionError$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(Y.tI.DISCARD_SUBMISSION_ERROR),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.discard_error_notice")))),{dispatch:!1})}canDeposit(t){let r=!0;return(0,f.UE)(t)&&t.forEach(c=>{const{errors:m}=c;m&&!(0,f.xb)(m)&&(r=!1)}),r}parseSaveResponse(t,r,c,m,I=!0,M=!0){const X=[];return(0,f.UE)(r)&&(I&&this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice")),r.forEach(te=>{var S;let G=Object.create({});const{errors:le}=te;le&&!(0,f.xb)(le)&&(G=(0,Ct.Z)(le),I&&this.notificationsService.warning(null,this.translate.get("submission.sections.general.sections_not_valid")));const Q=te.sections&&(0,f.UE)(te.sections)?te.sections:{},ie=(0,K.union)(Object.keys(Q),Object.keys(G));for(const me of ie){const de=G[me]||[],re=Q[me]||{};if(t.sections[me].sectionType===y.i.Upload&&(0,f.xb)(re.files)&&!t.sections[me].enabled)continue;I&&!t.sections[me].enabled&&this.submissionService.notifyNewSection(c,me,t.sections[me].sectionType);const ke=yt(xt(m,t,me),de,t.sections[me].sectionType,M);X.push(new Y.z6(c,me,re,ke,de))}const pe=(0,K.findKey)(t.sections,me=>me.sectionType===y.i.SherpaPolicies);(0,f.pT)(pe)&&(0,f.UE)(null===(S=t.sections[pe])||void 0===S?void 0:S.data)&&(0,f.xb)(Q[pe])&&X.push(new Y.z6(c,pe,null,[],[]))})),X}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(J.eX),e.\u0275\u0275inject(x.T),e.\u0275\u0275inject(Fe.E),e.\u0275\u0275inject(d.J),e.\u0275\u0275inject(Ee.yh),e.\u0275\u0275inject(j.b),e.\u0275\u0275inject(oe.O),e.\u0275\u0275inject(U.sK))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})()];var Ge=i(61135),Re=i(35709);let Be=(()=>{class o{constructor(t){this.store=t}getUploadedFileList(t,r){return this.store.select((0,Re.y8)(t,r)).pipe((0,b.U)(c=>c),(0,w.x)())}getFileData(t,r,c){return this.store.select((0,Re.y8)(t,r)).pipe((0,C.h)(m=>!(0,f.o8)(m)),(0,b.U)(m=>{let I;return Object.keys(m).filter(M=>m[M].uuid===c).forEach(M=>I=m[M]),I}),(0,w.x)())}getDefaultPolicies(t,r,c){return this.store.select((0,Re.G)(t,r,c)).pipe((0,b.U)(m=>m),(0,w.x)())}addUploadedFile(t,r,c,m){this.store.dispatch(new Y.l5(t,r,c,m))}updateFileData(t,r,c,m){this.store.dispatch(new Y.GM(t,r,c,m))}removeUploadedFile(t,r,c){this.store.dispatch(new Y.YU(t,r,c))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(Ee.yh))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})();var je=i(31054),Qe=i(17967),qe=i(58134),et=i(31286),Ae=i(3592),tt=i(43568),nt=i(72670),Ke=i(96530),We=i(40520),we=i(37334);let ge=class extends et.E{constructor(s,t,r,c,m,I,M,X){super(s,t,null,c,m,I,M,X,"submissionuploads"),this.requestService=s,this.rdbService=t,this.store=r,this.objectCache=c,this.halService=m,this.notificationsService=I,this.http=M,this.comparator=X}findByHref(s,t=!0,r=!0,...c){return super.findByHref(s,t,r,...c)}};ge.\u0275fac=function(s){return new(s||ge)(e.\u0275\u0275inject(Z.s),e.\u0275\u0275inject(Ke.Q),e.\u0275\u0275inject(Ee.yh),e.\u0275\u0275inject(se.a),e.\u0275\u0275inject(Ae.q),e.\u0275\u0275inject(x.T),e.\u0275\u0275inject(We.eN),e.\u0275\u0275inject(we.v))},ge.\u0275prov=e.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac}),ge=(0,v.gn)([(0,tt.cQ)(nt.fB),(0,v.w6)("design:paramtypes",[Z.s,Ke.Q,Ee.yh,se.a,Ae.q,x.T,We.eN,we.v])],ge);var Ye=i(60300);function Ot(o,s){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"div",3)(3,"h3",4)(4,"span",5),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()),2&o&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,1,"submission.sections.upload.no-file-uploaded")))}const it=function(o){return{collectionName:o}};function Tt(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.nolist",e.\u0275\u0275pureFunction1(4,it,t.collectionName))," ")}}function Mt(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.withlist",e.\u0275\u0275pureFunction1(4,it,t.collectionName))," ")}}function Pt(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",8)(2,"ds-alert",9),e.\u0275\u0275template(3,Tt,3,6,"ng-container",1),e.\u0275\u0275template(4,Mt,3,6,"ng-container",1),e.\u0275\u0275element(5,"span",10)(6,"ds-submission-section-upload-access-conditions",11),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("type",t.AlertTypeEnum.Warning),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",1===t.collectionPolicyType),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===t.collectionPolicyType),e.\u0275\u0275advance(2),e.\u0275\u0275property("accessConditions",t.collectionDefaultAccessConditions)}}function Ut(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-submission-upload-section-file",12),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",2)(4,"div",3),e.\u0275\u0275element(5,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("availableAccessConditionOptions",r.availableAccessConditionOptions)("collectionId",r.collectionId)("collectionPolicyType",r.collectionPolicyType)("configMetadataForm",e.\u0275\u0275pipeBind1(2,9,r.configMetadataForm$))("fileId",r.fileIndexes[r.fileList.indexOf(t)])("fileIndex",r.fileList.indexOf(t))("fileName",r.fileNames[r.fileList.indexOf(t)])("sectionId",r.sectionData.id)("submissionId",r.submissionId)}}function Ft(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Pt,7,4,"div",6),e.\u0275\u0275template(2,Ut,6,11,"ng-container",7),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.collectionDefaultAccessConditions.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.fileList)}}let Ie=class extends B{constructor(s,t,r,c,m,I,M,X,te,S){super(void 0,te,S),this.bitstreamService=s,this.changeDetectorRef=t,this.collectionDataService=r,this.groupService=c,this.resourcePolicyService=m,this.sectionService=I,this.submissionService=M,this.uploadsConfigService=X,this.injectedSectionData=te,this.injectedSubmissionId=S,this.AlertTypeEnum=Ye.N,this.fileIndexes=[],this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new Ge.X(!0),this.subs=[]}onSectionInit(){const s=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,ce.l)("metadata")).pipe((0,D.xw)(),(0,b.U)(t=>t.payload));this.configMetadataForm$=s.pipe((0,ve.w)(t=>t.metadata.pipe((0,D.xw)(),(0,b.U)(r=>r.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,C.h)(t=>(0,f.pT)(t)&&!t.isLoading),(0,C.h)(t=>(0,f.o8)(this.collectionId)||this.collectionId!==t.collection),(0,a.b)(t=>this.collectionId=t.collection),(0,F.z)(t=>this.collectionDataService.findById(t.collection)),(0,C.h)(t=>(0,f.pT)(t.payload)),(0,a.b)(t=>this.collectionName=t.payload.name),(0,F.z)(()=>s)).subscribe(t=>{this.required$.next(t.required),this.availableAccessConditionOptions=(0,f.UE)(t.accessConditionOptions)?t.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),(0,l.a)(this.configMetadataForm$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id)).pipe((0,C.h)(([t,r])=>(0,f.UE)(t)&&(0,f.pT)(r)),(0,w.x)()).subscribe(([t,r])=>{this.fileList=[],this.fileIndexes=[],this.fileNames=[],this.changeDetectorRef.detectChanges(),(0,f.pT)(r)&&r.length>0&&r.forEach(c=>{this.fileList.push(c),this.fileIndexes.push(c.uuid),this.fileNames.push(this.getFileName(t,c))}),this.changeDetectorRef.detectChanges()}))}getFileName(s,t){const r=s.rows[0].fields[0].selectableMetadata[0].metadata;let c;return c=(0,f.UE)(t.metadata)&&(0,f.UE)(t.metadata[r])?t.metadata[r][0].display:t.uuid,c}getSectionStatus(){return(0,l.a)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(s,t)=>!s||(0,f.pT)(t)&&t.length>0)}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}};Ie.\u0275fac=function(s){return new(s||Ie)(e.\u0275\u0275directiveInject(Be),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(je.W),e.\u0275\u0275directiveInject(Qe.O),e.\u0275\u0275directiveInject(qe.Z),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(ge),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ie.\u0275cmp=e.\u0275\u0275defineComponent({type:Ie,selectors:[["ds-submission-section-upload"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:5,consts:[[3,"content","dismissible","type"],[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"text-center"],[1,"text-muted"],["class","row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]],template:function(s,t){1&s&&(e.\u0275\u0275element(0,"ds-alert",0),e.\u0275\u0275template(1,Ot,7,3,"ng-container",1),e.\u0275\u0275template(2,Ft,3,2,"ng-container",1)),2&s&&(e.\u0275\u0275property("content","submission.sections.upload.info")("dismissible",!0)("type",t.AlertTypeEnum.Info),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0==t.fileList.length),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.fileList.length>0))},styles:[""]}),Ie=(0,v.gn)([(0,O.E)(y.i.Upload),(0,v.w6)("design:paramtypes",[Be,e.ChangeDetectorRef,je.W,Qe.O,qe.Z,d.J,j.b,ge,Object,String])],Ie);i(86042);var be=i(7522);const Lt={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},Rt=[{id:"granted",label:"I confirm the license above",required:!0,value:!1,validators:{required:null},errorMessages:{required:"You must accept the license",notgranted:"You must accept the license"},type:"CHECKBOX"}],jt=["formRef"];function Kt(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",2,3),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("formLayout",t.formLayout)("displaySubmit",t.displaySubmit)("displayCancel",!1)}}let xe=class extends B{constructor(s,t,r,c,m,I,M,X,te,S,G){super(te,S,G),this.changeDetectorRef=s,this.collectionDataService=t,this.formBuilderService=r,this.formOperationsService=c,this.formService=m,this.operationsBuilder=I,this.sectionService=M,this.submissionService=X,this.injectedCollectionId=te,this.injectedSectionData=S,this.injectedSubmissionId=G,this.formLayout=Lt,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(Rt);const s=this.formBuilderService.findById("granted",this.formModel);s.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,ce.l)("license")).pipe((0,C.h)(t=>(0,f.pT)(t.payload)),(0,F.z)(t=>t.payload.license),(0,z.s)(t=>(0,f.pT)(t.payload)),(0,b.U)(t=>t.payload.text),(0,$.O)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,P.q)(1),(0,C.h)(t=>t)).subscribe(()=>{s.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,C.h)(t=>(0,f.UE)(t)),(0,w.x)()).subscribe(t=>{const r=t.map(c=>"/sections/license"===c.path?s.checked?null:Object.assign({},c,{path:"/sections/license/granted"}):c).filter(c=>(0,f.K0)(c));(0,f.UE)(r)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,r),this.sectionData.errors=t):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.changeDetectorRef.detectChanges()}))}getSectionStatus(){const s=this.formBuilderService.findById("granted",this.formModel);return s.valueChanges.pipe((0,b.U)(t=>!0===t),(0,$.O)(s.value))}onChange(s){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);r?(this.operationsBuilder.add(this.pathCombiner.getPath(t),r.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(t))}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}};xe.\u0275fac=function(s){return new(s||xe)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(je.W),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(p.m),e.\u0275\u0275directiveInject(L.o),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},xe.\u0275cmp=e.\u0275\u0275defineComponent({type:xe,selectors:[["ds-submission-section-license"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(jt,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[1,"mb-5",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange"],["formRef","formComponent"]],template:function(s,t){1&s&&(e.\u0275\u0275element(0,"span",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"br")(3,"br"),e.\u0275\u0275template(4,Kt,2,5,"ds-form",1)),2&s&&(e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind1(1,2,t.licenseText$),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.formModel))},directives:[V.O5,A.U],pipes:[V.Ov],styles:[""]}),xe=(0,v.gn)([(0,O.E)(y.i.License),(0,v.w6)("design:paramtypes",[e.ChangeDetectorRef,je.W,_.c,p.m,L.o,be.w,d.J,j.b,String,Object,String])],xe);i(31423);var ee=(i(70690),i(8108));const wt={id:"metadata",group:[]},Vt={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},$t={id:"accessConditionGroup",group:[]},Nt={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},zt={id:"accessConditions",groupFactory:null},Gt={grid:{group:"form-row pt-4"}},Qt={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},Yt={element:{host:"col-12",label:"col-form-label name-label"}},Xt={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:ee.O6Y,operator:ee.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},Ht={element:{label:"col-form-label"},grid:{host:"col-6"}},Jt={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:ee.O6Y,operator:ee.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},Zt={element:{label:"col-form-label"},grid:{host:"col-6"}};var Ve=i(88155),Ce=i(17656);const kt=["formRef"];function qt(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",6,7),e.\u0275\u0275listener("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onSubmit()})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onModalClose()})("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!t.isSaving)("displayCancel",!t.isSaving)}}let Xe=(()=>{class o{constructor(t,r,c,m,I,M,X,te){this.activeModal=t,this.cdr=r,this.formBuilderService=c,this.formService=m,this.submissionService=I,this.operationsBuilder=M,this.operationsService=X,this.uploadService=te,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(t){this.fileData.accessConditions.forEach((r,c)=>{Array.of("name","startDate","endDate").filter(m=>r.hasOwnProperty(m)&&(0,f.UE)(r[m])).forEach(m=>{const I=this.formBuilderService.findById(m,t,c);if(I)if(I.type===ee.VId){const M=new Date(r[m]);I.value={year:M.getUTCFullYear(),month:M.getUTCMonth()+1,day:M.getUTCDate()}}else I.value=r[m]})})}onChange(t){"name"===t.model.id&&this.setOptions(t.model,t.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(t,r){let c=null;if(this.availableAccessConditionOptions.filter(m=>m.name===r.value).forEach(m=>c=m),(0,f.UE)(c)){const m=r.parent.get("startDate"),I=r.parent.get("endDate");null==m||m.markAsUntouched(),null==I||I.markAsUntouched(),null==m||m.setValue(null),r.parent.markAsDirty(),null==I||I.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(t){const r=Array.isArray(t)?t[0]:t;return r?r.value:void 0}buildFileEditForm(){const t=Object.assign({},this.configMetadataForm.rows[0].fields[0]);t.repeatable=!1;const r=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],t])}),c=[],m=Object.assign({},wt);m.group=this.formBuilderService.modelFromConfiguration(this.submissionId,r,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),c.push(new ee.S_O(m,Vt));const I=Object.assign({},Qt),M=Object.assign({},zt),X=[];if(2===this.collectionPolicyType){for(const de of this.availableAccessConditionOptions)X.push({label:de.name,value:de.name});I.options=X;const te=[],S=[];let G,le;this.availableAccessConditionOptions.forEach(de=>{if(de.hasStartDate&&(te.push({id:"name",value:de.name}),de.maxStartDate)){const re=new Date(de.maxStartDate);G={year:re.getUTCFullYear(),month:re.getUTCMonth()+1,day:re.getUTCDate()}}if(de.hasEndDate&&(S.push({id:"name",value:de.name}),de.maxEndDate)){const re=new Date(de.maxEndDate);le={year:re.getUTCFullYear(),month:re.getUTCMonth()+1,day:re.getUTCDate()}}});const Q={relations:[{match:ee.O6Y,operator:ee.F8e,when:te}]},ie={relations:[{match:ee.O6Y,operator:ee.F8e,when:S}]},pe=te.length>0,me=S.length>0;M.groupFactory=()=>{const de=new ee.nMt(I,Yt),re=Object.assign({},Xt,Q);G&&(re.max=G);const Pe=Object.assign({},Jt,ie);le&&(Pe.max=le);const ke=new ee.oqv(re,Ht),_o=new ee.oqv(Pe,Zt),$e=Object.assign({},$t);return $e.group=[de],pe&&$e.group.push(ke),me&&$e.group.push(_o),[new ee.S_O($e,Nt)]},M.initialCount=(0,f.UE)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,c.push(new ee.RRz(M,Gt))}return this.initModelData(c),c}saveBitstreamData(){this.formService.validateAllFormFields(this.formRef.formGroup);const t=this.formService.isValid(this.formId).pipe((0,P.q)(1),(0,C.h)(r=>r),(0,F.z)(()=>this.formService.getFormData(this.formId)),(0,P.q)(1),(0,F.z)(r=>{Object.keys(r.metadata).filter(m=>(0,f.UE)(r.metadata[m])).forEach(m=>{const M=`metadata/${m.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath(M),r.metadata[m],!0)}),Object.keys(this.fileData.metadata).filter(m=>(0,f.UE)(this.fileData.metadata[m])).filter(m=>(0,f.xI)(r.metadata[m])).filter(m=>this.formMetadata.includes(m)).forEach(m=>{const M=`metadata/${m.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath(M))});const c=[];return r.accessConditions.map(m=>m.accessConditionGroup).filter(m=>(0,f.UE)(m)).forEach(m=>{let I;if(this.availableAccessConditionOptions.filter(M=>(0,f.K0)(m.name)&&M.name===m.name[0].value).forEach(M=>I=M),I){const M=Object.assign({},m);if(M.name=this.retrieveValueFromField(m.name),I.hasStartDate){if(m.startDate){const X=this.retrieveValueFromField(m.startDate);M.startDate=(0,Ve.iV)(X)}}else delete M.startDate;if(I.hasEndDate){if(m.endDate){const X=this.retrieveValueFromField(m.endDate);M.endDate=(0,Ve.iV)(X)}}else delete M.endDate;c.push(M)}}),(0,f.UE)(c)&&this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),c,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(r=>{if(r[0].sections[this.sectionId]){const c=r[0].sections[this.sectionId];Object.keys(c.files).filter(m=>c.files[m].uuid===this.fileId).forEach(m=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,c.files[m]))}this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(t)}unsubscribeAll(){this.subscriptions.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(Ce.Kz),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(L.o),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(Fe.E),e.\u0275\u0275directiveInject(Be))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(t,r){if(1&t&&e.\u0275\u0275viewQuery(kt,5),2&t){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(r.formRef=c.first)}},decls:10,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"disabled","click"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange"],["formRef","formComponent"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"h4",1),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",2),e.\u0275\u0275listener("click",function(){return r.onModalClose()}),e.\u0275\u0275elementStart(6,"span",3),e.\u0275\u0275text(7,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",4),e.\u0275\u0275template(9,qt,2,4,"ds-form",5),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.upload.edit.title")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",r.isSaving),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",r.formModel))},directives:[V.O5,A.U],pipes:[U.X$],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),o})();var en=i(65742),tn=i(54018),nn=i(19503),He=i(98634);function on(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",3),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate3(" ",t.name," ",t.startDate," ",t.endDate," ")}}function sn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",3),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.name," from ",t.endDate,"")}}function an(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.name," until ",t.startDate,"")}}function rn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,on,2,3,"span",1),e.\u0275\u0275template(2,sn,2,2,"span",1),e.\u0275\u0275template(3,an,2,2,"span",2),e.\u0275\u0275element(4,"br"),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","DEFAULT_BITSTREAM_READ"==t.action),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","lease"==t.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","embargo"==t.name)}}let Je=(()=>{class o{constructor(t){this.groupService=t,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(t=>{(0,f.xb)(t.name)?this.groupService.findByHref(t._links.group.href).pipe((0,z.s)(r=>!r.isResponsePending&&r.hasSucceeded)).subscribe(r=>{const c=r.payload,m=Object.assign({},t);m.name=c.name,this.accessConditionsList.push(m)}):this.accessConditionsList.push(t)})}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(Qe.O))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(t,r){1&t&&e.\u0275\u0275template(0,rn,5,3,"ng-container",0),2&t&&e.\u0275\u0275property("ngForOf",r.accessConditionsList)},directives:[V.sg,V.O5],encapsulation:2}),o})();var cn=i(28917);function ln(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.value," ")}}function dn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"h5")(1,"span",4),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(3,2,"submission.sections.upload.no-entry")," ",t.fileTitleKey,"")}}function pn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,dn,4,4,"h5",0),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===r.metadata[r.fileTitleKey].indexOf(t))}}function mn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ln,3,1,"ng-container",0),e.\u0275\u0275template(2,pn,2,1,"ng-container",0),e.\u0275\u0275element(3,"span",1),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""!==t.value),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""===t.value)}}const un=function(){return["150"]};function _n(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dsTruncate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,t.value,e.\u0275\u0275pureFunction0(4,un))," ")}}function fn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",4),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(2,2,"submission.sections.upload.no-entry")," ",t.fileDescrKey,"")}}function hn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,fn,3,4,"span",5),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===r.metadata[r.fileDescrKey].indexOf(t))}}function vn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,_n,3,5,"ng-container",0),e.\u0275\u0275template(2,hn,2,1,"ng-container",0),e.\u0275\u0275element(3,"span",1),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""!==t.value),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""===t.value)}}function gn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,mn,4,2,"ng-container",3),e.\u0275\u0275template(2,vn,4,2,"ng-container",3),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getAllMetadataValue(t.fileTitleKey)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getAllMetadataValue(t.fileDescrKey))}}let st=(()=>{class o{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,f.UE)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=He.S.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=He.S.all(this.fileData.metadata,"dc.description"))}getAllMetadataValue(t){return He.S.all(this.metadata,t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},decls:4,vars:2,consts:[[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,gn,3,2,"ng-container",0),e.\u0275\u0275element(2,"span",1)(3,"ds-submission-section-upload-access-conditions",2),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.metadata),e.\u0275\u0275advance(2),e.\u0275\u0275property("accessConditions",r.fileData.accessConditions))},directives:[V.O5,V.sg,Je],pipes:[U.X$,cn.W],encapsulation:2}),o})();var bn=i(95765);function Sn(o,s){1&o&&e.\u0275\u0275element(0,"i",18)}function Cn(o,s){1&o&&e.\u0275\u0275element(0,"i",19)}function En(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"div",3),e.\u0275\u0275element(3,"ds-thumbnail",4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5)(5,"div",6)(6,"h3"),e.\u0275\u0275text(7),e.\u0275\u0275elementStart(8,"span",7),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"dsFileSize"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(11,"div",8),e.\u0275\u0275elementContainerStart(12),e.\u0275\u0275elementStart(13,"ds-file-download-link",9),e.\u0275\u0275element(14,"i",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",11),e.\u0275\u0275listener("click",function(c){e.\u0275\u0275restoreView(t);const m=e.\u0275\u0275nextContext();return c.preventDefault(),m.editBitstreamData()}),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275element(18,"i",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"button",13),e.\u0275\u0275listener("click",function(c){e.\u0275\u0275restoreView(t);const m=e.\u0275\u0275nextContext(),I=e.\u0275\u0275reference(2);return c.preventDefault(),m.confirmDelete(I)}),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275template(23,Sn,1,0,"i",14),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275template(25,Cn,1,0,"i",15),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(27,"div",16)(28,"ds-submission-section-upload-file-view",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("thumbnail",null==t.fileData?null:t.fileData.thumbnail),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",t.fileName," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("(",e.\u0275\u0275pipeBind1(10,15,null==t.fileData?null:t.fileData.sizeBytes),")"),e.\u0275\u0275advance(4),e.\u0275\u0275property("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",t.getBitstream())("enableRequestACopy",!1),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(17,19,"submission.sections.upload.edit.title")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(16,17,"submission.sections.upload.edit.title")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(21,23,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,25,t.processingDelete$)),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(20,21,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(24,27,t.processingDelete$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(26,29,t.processingDelete$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("fileData",t.fileData)}}function In(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",20)(1,"h4",21),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).dismiss("cancel")}),e.\u0275\u0275elementStart(5,"span",23),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",24)(8,"p"),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",25)(12,"button",26),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).close("cancel")}),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",27),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).close("ok")}),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()()}2&o&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(10,6,"submission.sections.upload.delete.confirm.info")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,8,"submission.sections.upload.delete.confirm.cancel")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,10,"submission.sections.upload.delete.confirm.submit")))}let at=(()=>{class o{constructor(t,r,c,m,I,M,X,te){this.cdr=t,this.formService=r,this.halService=c,this.modalService=m,this.operationsBuilder=I,this.operationsService=M,this.submissionService=X,this.uploadService=te,this.processingDelete$=new Ge.X(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,C.h)(t=>(0,f.pT)(t))).subscribe(t=>{this.fileData=t}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.pathCombiner=new T.K("sections",this.sectionId,"files",this.fileIndex),this.loadFormMetadata()}confirmDelete(t){this.modalService.open(t).result.then(r=>{"ok"===r&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new en.Z,{uuid:this.fileData.uuid})}editBitstreamData(){const r=this.modalService.open(Xe,{size:"xl",backdrop:"static"});r.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,r.componentInstance.collectionId=this.collectionId,r.componentInstance.collectionPolicyType=this.collectionPolicyType,r.componentInstance.configMetadataForm=this.configMetadataForm,r.componentInstance.fileData=this.fileData,r.componentInstance.fileId=this.fileId,r.componentInstance.fileIndex=this.fileIndex,r.componentInstance.formId=this.formId,r.componentInstance.sectionId=this.sectionId,r.componentInstance.formMetadata=this.formMetadata,r.componentInstance.pathCombiner=this.pathCombiner,r.componentInstance.submissionId=this.submissionId}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(t=>{t.fields.forEach(r=>{r.selectableMetadata.forEach(c=>{this.formMetadata.push(c.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath()),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(L.o),e.\u0275\u0275directiveInject(Ae.q),e.\u0275\u0275directiveInject(Ce.FF),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(Fe.E),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(Be))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-upload-section-file"]],viewQuery:function(t,r){if(1&t&&e.\u0275\u0275viewQuery(Xe,5),2&t){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(r.fileEditComp=c.first)}},inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[e.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[[4,"ngIf"],["content",""],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","click"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","disabled","click"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(t,r){1&t&&(e.\u0275\u0275template(0,En,29,31,"ng-container",0),e.\u0275\u0275template(1,In,18,12,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&t&&e.\u0275\u0275property("ngIf",r.fileData)},directives:[V.O5,tn.Z,nn.q,st],pipes:[bn.p,U.X$,V.Ov],styles:[""]}),o})();i(87335);var yn=i(89277),rt=(i(79657),i(76275),i(80133),i(32215),i(72988)),ct=i(43864),Pn=i(16424),lt=i(41989);function Un(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"ds-loading"),e.\u0275\u0275elementEnd())}function Fn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.getSelectedCcLicense().name," ")}}function Bn(o,s){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.change")," "))}function An(o,s){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.select")," "))}function Ln(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275template(1,Bn,3,3,"ng-container",3),e.\u0275\u0275template(2,An,3,3,"ng-container",3),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.storedCcLicenseLink),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.storedCcLicenseLink)}}function Rn(o,s){1&o&&(e.\u0275\u0275elementStart(0,"button",7),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.none")," "))}function jn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const m=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext().selectCcLicense(m)}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Kn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",10)(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"div",20),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",t.description,e.\u0275\u0275sanitizeHtml)}}function Wn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",15)(2,"div")(3,"h4"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).closeInfoModal()}),e.\u0275\u0275elementStart(7,"span",18),e.\u0275\u0275text(8,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",19),e.\u0275\u0275template(10,Kn,4,2,"div",9),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",t.description,e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.enums)}}function wn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," ")}}function Vn(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.option.select")," "))}function $n(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0,2),e.\u0275\u0275template(1,wn,2,1,"span",3),e.\u0275\u0275template(2,Vn,3,3,"span",3),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}function Nn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const m=e.\u0275\u0275restoreView(t).$implicit,I=e.\u0275\u0275nextContext(2).$implicit,M=e.\u0275\u0275nextContext(2);return M.selectOption(M.getSelectedCcLicense(),I,m)}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," ")}}function zn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"ds-select"),e.\u0275\u0275template(1,$n,3,2,"ng-container",21),e.\u0275\u0275elementContainerStart(2,4),e.\u0275\u0275elementStart(3,"div",22),e.\u0275\u0275template(4,Nn,2,1,"button",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",r.getSelectedOption(r.getSelectedCcLicense(),t)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.enums)}}function Gn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",24)(1,"div",25),e.\u0275\u0275listener("click",function(){const m=e.\u0275\u0275restoreView(t).$implicit,I=e.\u0275\u0275nextContext(2).$implicit,M=e.\u0275\u0275nextContext(2);return M.selectOption(M.getSelectedCcLicense(),I,m)}),e.\u0275\u0275element(2,"input",26),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()()}if(2&o){const t=s.$implicit,r=e.\u0275\u0275nextContext(2).$implicit,c=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",t.label),e.\u0275\u0275property("checked",c.isSelectedOption(c.getSelectedCcLicense(),r,t)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.label)}}function Qn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Gn,5,3,"div",23),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.enums)}}function Yn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11)(2,"div"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const c=e.\u0275\u0275reference(7);return e.\u0275\u0275nextContext(2).openInfoModal(c)}),e.\u0275\u0275element(5,"i",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,Wn,11,3,"ng-template",null,14,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(8,zn,5,2,"ds-select",3),e.\u0275\u0275template(9,Qn,2,1,"ng-container",3),e.\u0275\u0275elementEnd()}if(2&o){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("font-weight-bold ",t.id,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",(null==t.enums?null:t.enums.length)>5),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==t.enums?null:t.enums.length)<=5)}}function Xn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Yn,10,6,"div",9),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getSelectedCcLicense().fields)}}function Hn(o,s){1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"ds-loading"),e.\u0275\u0275elementEnd())}function Jn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",29)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",30),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",31)(7,"div",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const c=e.\u0275\u0275nextContext(3);return c.setAccepted(!c.accepted)}),e.\u0275\u0275element(8,"input",32),e.\u0275\u0275elementStart(9,"span"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()()()}if(2&o){const t=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,5,"submission.sections.ccLicense.link")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",t,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",r.accepted),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,7,"submission.sections.ccLicense.confirmation"))}}function Zn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Hn,2,0,"div",3),e.\u0275\u0275template(2,Jn,12,9,"div",28),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}function kn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Zn,3,2,"ng-container",27),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t.getCcLicenseLink$()))}}let ye=class extends B{constructor(s,t,r,c,m,I,M,X){super(I,M,X),this.modalService=s,this.sectionService=t,this.submissionCcLicensesDataService=r,this.submissionCcLicenseUrlDataService=c,this.operationsBuilder=m,this.injectedCollectionId=I,this.injectedSectionData=M,this.injectedSubmissionId=X,this.isLoading=!0,this.subscriptions=[]}get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}get data(){return this.sectionData.data}selectCcLicense(s){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===s.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:s.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(s=>s.id===this.data.ccLicense.id)[0]:null}selectOption(s,t,r){this.isSelectedOption(s,t,r)||this.updateSectionData({ccLicense:{id:s.id,fields:Object.assign({},this.data.ccLicense.fields,{[t.id]:r})},accepted:!1})}getSelectedOption(s,t){return this.data.ccLicense.fields[t.id]}isSelectedOption(s,t,r){return this.getSelectedOption(s,t)&&this.getSelectedOption(s,t).id===r.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,he.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(t=>!this.getSelectedOption(this.getSelectedCcLicense(),t)))return;const s=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(s,new Map(s.fields.map(t=>[t,this.getSelectedOption(s,t)])))}openInfoModal(s){this.modalRef=this.modalService.open(s)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,he.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,y.i.CcLicense).pipe((0,C.h)(s=>(0,f.UE)(s)&&((0,f.UE)(s.data)||(0,f.UE)(s.errorsToShow))),(0,w.x)(),(0,b.U)(s=>s.data)).subscribe(s=>{if(this.data.accepted!==s.accepted){const t=this.pathCombiner.getPath("uri");s.accepted?this.getCcLicenseLink$().pipe((0,P.q)(1)).subscribe(r=>{this.operationsBuilder.add(t,r.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(t)}this.sectionData.data=s}),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe((0,D.xw)(),(0,D.xe)(),(0,b.U)(s=>s.page)).subscribe(s=>this.submissionCcLicenses=s))}setAccepted(s){this.updateSectionData({accepted:s}),this.updateSectionStatus()}updateSectionData(s){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,s))}};ye.\u0275fac=function(s){return new(s||ye)(e.\u0275\u0275directiveInject(Ce.FF),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(rt.I),e.\u0275\u0275directiveInject(ct.K),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},ye.\u0275cmp=e.\u0275\u0275defineComponent({type:ye,selectors:[["ds-submission-section-cc-licenses"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:11,vars:8,consts:[[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],["infoModal",""],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",3,"checked"]],template:function(s,t){1&s&&(e.\u0275\u0275elementStart(0,"div",0)(1,"ds-select",1),e.\u0275\u0275elementContainerStart(2,2),e.\u0275\u0275template(3,Un,2,0,"span",3),e.\u0275\u0275template(4,Fn,2,1,"span",3),e.\u0275\u0275template(5,Ln,3,2,"span",3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(6,4),e.\u0275\u0275template(7,Rn,3,3,"button",5),e.\u0275\u0275template(8,jn,2,1,"button",6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,Xn,2,1,"ng-container",3),e.\u0275\u0275template(10,kn,3,3,"ng-container",3)),2&s&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!t.submissionCcLicenses),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!t.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.submissionCcLicenses&&!t.getSelectedCcLicense()),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==t.submissionCcLicenses?null:t.submissionCcLicenses.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getCcLicenseLink$()))},directives:[Pn.N,V.O5,Le.N,V.sg,lt.g],pipes:[U.X$,V.Ov],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]}),ye=(0,v.gn)([(0,O.E)(y.i.CcLicense),(0,v.w6)("design:paramtypes",[Ce.FF,d.J,rt.I,ct.K,be.w,String,Object,String])],ye);var qn=i(98451),ei=i(98815),oi=(i(11503),i(97726),i(59161),i(83429));let Ze=(()=>{class o{constructor(t){this.store=t}getAccessesData(t,r){return this.store.select((0,Re.y5)(t,r)).pipe((0,C.h)(c=>(0,f.pT)(c)),(0,w.x)())}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(Ee.yh))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})();const si={id:"discoverable",name:"discoverable"},ai={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},ri={id:"accessConditionGroup",group:[]},ci={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},li={id:"accessCondition",groupFactory:null},di={grid:{group:"form-row pt-4"}},dt={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},pi={element:{host:"col-12",label:"col-form-label name-label"}},mi={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:ee.O6Y,operator:ee.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},ui={element:{label:"col-form-label"},grid:{host:"col-6"}},_i={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:ee.O6Y,operator:ee.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},fi={element:{label:"col-form-label"},grid:{host:"col-6"}};let Se=class extends et.E{constructor(s,t,r,c,m,I,M,X){super(s,t,null,c,m,I,M,X,"submissionaccessoptions"),this.requestService=s,this.rdbService=t,this.store=r,this.objectCache=c,this.halService=m,this.notificationsService=I,this.http=M,this.comparator=X}findByHref(s,t=!0,r=!0,...c){return super.findByHref(s,t,r,...c)}};Se.\u0275fac=function(s){return new(s||Se)(e.\u0275\u0275inject(Z.s),e.\u0275\u0275inject(Ke.Q),e.\u0275\u0275inject(Ee.yh),e.\u0275\u0275inject(se.a),e.\u0275\u0275inject(Ae.q),e.\u0275\u0275inject(x.T),e.\u0275\u0275inject(We.eN),e.\u0275\u0275inject(we.v))},Se.\u0275prov=e.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac}),Se=(0,v.gn)([(0,tt.cQ)(nt.MX),(0,v.w6)("design:paramtypes",[Z.s,Ke.Q,Ee.yh,se.a,Ae.q,x.T,We.eN,we.v])],Se);const hi=["formRef"];function vi(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",1,2),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)})("removeArrayItem",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!1)("displayCancel",!1)}}let De=class extends B{constructor(s,t,r,c,m,I,M,X,te,S,G){super(void 0,S,G),this.sectionService=s,this.formBuilderService=t,this.accessesConfigService=r,this.accessesService=c,this.formOperationsService=m,this.operationsBuilder=I,this.formService=M,this.translate=X,this.operationsService=te,this.injectedSectionData=S,this.injectedSubmissionId=G,this.subs=[]}initModelData(s){this.accessesData.accessConditions.forEach((t,r)=>{Array.of("name","startDate","endDate").filter(c=>t.hasOwnProperty(c)&&(0,f.UE)(t[c])).forEach(c=>{const m=this.formBuilderService.findById(c,s,r);if(m)if(m.type===ee.VId){const I=new Date(t[c]);m.value={year:I.getUTCFullYear(),month:I.getUTCMonth()+1,day:I.getUTCDate()}}else m.value=t[c]})})}onChange(s){if(s.model.type===ee.fSU){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);this.operationsBuilder.replace(this.pathCombiner.getPath(t),r.value,!0)}else{if(s.model.id===dt.id){const t=s.control.parent.get("startDate"),r=s.control.parent.get("endDate");null==t||t.markAsUntouched(),null==r||r.markAsUntouched(),null==t||t.setValue(null),null==r||r.setValue(null),s.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,P.q)(1),(0,C.h)(t=>t),(0,F.z)(()=>this.formService.getFormData(this.formId)),(0,P.q)(1)).subscribe(t=>{const r=[];t.accessCondition.map(c=>c.accessConditionGroup).filter(c=>(0,f.UE)(c)).forEach(c=>{let m;if(this.availableAccessConditionOptions.filter(I=>(0,f.K0)(c.name)&&I.name===c.name[0].value).forEach(I=>m=I),m){const I=Object.assign({},c);if(I.name=this.retrieveValueFromField(c.name),m.hasStartDate){if(c.startDate){const M=this.retrieveValueFromField(c.startDate);I.startDate=(0,Ve.iV)(M)}}else delete I.startDate;if(m.hasEndDate){if(c.endDate){const M=this.retrieveValueFromField(c.endDate);I.endDate=(0,Ve.iV)(M)}}else delete I.endDate;r.push(I)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),r,!0)})}}onRemove(s){const t=this.formOperationsService.getArrayIndexFromEvent(s);this.operationsBuilder.remove(this.pathCombiner.getPath("accessConditions/"+t))}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const s=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,D.xw)(),(0,b.U)(r=>r.payload)),t=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,l.a)([s,t]).subscribe(([r,c])=>{this.availableAccessConditionOptions=(0,f.UE)(r.accessConditionOptions)?r.accessConditionOptions:[],this.canChangeDiscoverable=!!r.canChangeDiscoverable,this.accessesData=c,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,he.of)(!0)}buildFileEditForm(){const s=[];if(this.canChangeDiscoverable){const Q=Object.assign({},si,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});s.push(new ee.dwp(Q,ai))}const t=Object.assign({},dt),r=Object.assign({},li),c=[];for(const Q of this.availableAccessConditionOptions)c.push({label:Q.name,value:Q.name});t.options=c;const m=[],I=[];let M,X;this.availableAccessConditionOptions.forEach(Q=>{if(Q.hasStartDate&&(m.push({id:"name",value:Q.name}),Q.maxStartDate)){const ie=new Date(Q.maxStartDate);M={year:ie.getUTCFullYear(),month:ie.getUTCMonth()+1,day:ie.getUTCDate()}}if(Q.hasEndDate&&(I.push({id:"name",value:Q.name}),Q.maxEndDate)){const ie=new Date(Q.maxEndDate);X={year:ie.getUTCFullYear(),month:ie.getUTCMonth()+1,day:ie.getUTCDate()}}});const te={relations:[{match:ee.O6Y,operator:ee.F8e,when:m}]},S={relations:[{match:ee.O6Y,operator:ee.F8e,when:I}]},G=m.length>0,le=I.length>0;return r.groupFactory=()=>{const Q=new ee.nMt(t,pi),ie=Object.assign({},mi,te);M&&(ie.max=M);const pe=Object.assign({},_i,S);X&&(pe.max=X);const me=new ee.oqv(ie,ui),de=new ee.oqv(pe,fi),re=Object.assign({},ri);return re.group=[Q],G&&re.group.push(me),le&&re.group.push(de),[new ee.S_O(re,ci)]},r.initialCount=(0,f.UE)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,s.push(new ee.RRz(r,di)),this.initModelData(s),s}retrieveValueFromField(s){const t=Array.isArray(s)?s[0]:s;return t?t.value:void 0}};De.\u0275fac=function(s){return new(s||De)(e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(Se),e.\u0275\u0275directiveInject(Ze),e.\u0275\u0275directiveInject(p.m),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(L.o),e.\u0275\u0275directiveInject(U.sK),e.\u0275\u0275directiveInject(Fe.E),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},De.\u0275cmp=e.\u0275\u0275defineComponent({type:De,selectors:[["ds-section-accesses"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(hi,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem"],["formRef","formComponent"]],template:function(s,t){1&s&&e.\u0275\u0275template(0,vi,2,4,"ds-form",0),2&s&&e.\u0275\u0275property("ngIf",!!t.formModel)},directives:[V.O5,A.U],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),De=(0,v.gn)([(0,O.E)(y.i.AccessesCondition),(0,v.w6)("design:paramtypes",[d.J,_.c,Se,Ze,p.m,be.w,L.o,U.sK,Fe.E,Object,String])],De);var pt=i(84561);function gi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," ")}}function bi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,gi,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.title")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.journal.titles)}}function Si(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," ")}}function Ci(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,Si,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.issns")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.journal.issns)}}function Ei(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.publication.information.url")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("href",t.journal.url,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.journal.url," ")}}function Ii(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",3)(1,"p",4)(2,"a",6),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()()()),2&o){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",t.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function xi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,Ii,4,2,"div",7),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.publishers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.journal.publishers)}}function yi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.romeoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.journal.romeoPub," ")}}function Di(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.zetoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.journal.zetoPub," ")}}let mt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},decls:7,vars:6,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],["class","m-1",4,"ngFor","ngForOf"],["target","_blank",3,"href"],["class","col-4",4,"ngFor","ngForOf"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,bi,7,4,"div",1),e.\u0275\u0275template(2,Ci,7,4,"div",1),e.\u0275\u0275template(3,Ei,9,5,"div",1),e.\u0275\u0275template(4,xi,6,4,"div",1),e.\u0275\u0275template(5,yi,8,4,"div",1),e.\u0275\u0275template(6,Di,8,4,"div",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.titles)&&r.journal.titles.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.issns)&&r.journal.issns.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.url)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.publishers)&&r.journal.publishers.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.romeoPub)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.zetoPub)))},directives:[V.O5,V.sg],pipes:[U.X$],styles:[""]}),o})();function Oi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",t.version.embargo.amount," ",null==t.version.embargo?null:t.version.embargo.units[0],"")}}function Ti(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function Mi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("+",t.version.locations.length-1,"")}}function Pi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,Mi,2,1,"span",16),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.version.locations[0]," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.version.locations.length>1)}}function Ui(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function Fi(o,s){1&o&&e.\u0275\u0275element(0,"span",17)}function Bi(o,s){1&o&&e.\u0275\u0275element(0,"span",18)}function Ai(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.version.embargo.amount," ",t.version.embargo.units,"")}}function Li(o,s){1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function Ri(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",15),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Ai,2,2,"p",25),e.\u0275\u0275template(8,Li,3,3,"ng-template",null,26,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275reference(9),r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,3,"submission.sections.sherpa.publisher.policy.embargo"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!!r.version.embargo)("ngIfElse",t)}}function ji(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function Ki(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",27),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,ji,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.license"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.licenses)}}function Wi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function wi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",29),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Wi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.prerequisites"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.prerequisites)}}function Vi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function $i(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",7),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Vi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.location"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.locations)}}function Ni(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function zi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",30),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Ni,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.conditions"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.conditions)}}function Gi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",19),e.\u0275\u0275template(1,Ri,10,5,"div",20),e.\u0275\u0275template(2,Ki,8,4,"div",20),e.\u0275\u0275template(3,wi,8,4,"div",20),e.\u0275\u0275template(4,$i,8,4,"div",20),e.\u0275\u0275template(5,zi,8,4,"div",20),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.embargo||null==t.version||!t.version.embargo.amount)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.licenses)&&t.version.licenses.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.prerequisites)&&t.version.prerequisites.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.locations)&&t.version.locations.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.conditions)&&t.version.conditions.length>0)}}let ut=(()=>{class o{constructor(){this.isCollapsed=!0}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-content-accordion"]],inputs:{version:"version"},decls:22,vars:15,consts:[["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","mr-4",3,"click"],[4,"ngIf","ngIfElse"],["noEmbargoTitle",""],[1,"m-1","ml-4"],[1,"far","fa-folder-open"],["noLocations",""],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],["class","ml-4",4,"ngIf"],[1,"fas","fa-hourglass-half"],[4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],["class","m-1",4,"ngIf","ngIfElse"],["noEmbargo",""],[1,"fas","fa-certificate"],["class","m-1",4,"ngFor","ngForOf"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(t,r){if(1&t){const c=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(c),e.\u0275\u0275reference(20).toggle()}),e.\u0275\u0275elementStart(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(I){return I.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"titlecase"),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div"),e.\u0275\u0275template(8,Oi,3,2,"span",4),e.\u0275\u0275template(9,Ti,4,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(11,"span",6),e.\u0275\u0275element(12,"i",7),e.\u0275\u0275template(13,Pi,3,2,"span",4),e.\u0275\u0275template(14,Ui,3,3,"ng-template",null,8,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",9),e.\u0275\u0275template(17,Fi,1,0,"span",10),e.\u0275\u0275template(18,Bi,1,0,"span",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",12,13),e.\u0275\u0275template(21,Gi,6,5,"div",14),e.\u0275\u0275elementEnd()()}if(2&t){const c=e.\u0275\u0275reference(10),m=e.\u0275\u0275reference(15),I=e.\u0275\u0275reference(20);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!I.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,11,r.version.articleVersion)," ",e.\u0275\u0275pipeBind1(6,13,"submission.sections.sherpa.publisher.policy.version")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.embargo||null==r.version||!r.version.embargo.amount))("ngIfElse",c),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.locations)&&r.version.locations.length>0)("ngIfElse",m),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",I.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!I.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",r.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!!r.version)}},directives:[V.O5,Ce._D,V.sg],pipes:[V.rS,U.X$],styles:[""]}),o})();function Qi(o,s){1&o&&e.\u0275\u0275element(0,"ds-content-accordion",3),2&o&&e.\u0275\u0275property("version",s.$implicit)}function Yi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"li")(1,"a",8),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("href",t.key,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.value)}}function Xi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",4)(1,"div",5)(2,"p",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"ul"),e.\u0275\u0275template(6,Yi,3,2,"li",7),e.\u0275\u0275pipe(7,"keyvalue"),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publisher.policy.more.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(7,4,t.policy.urls))}}let _t=(()=>{class o{constructor(){this.AlertTypeEnum=Ye.N}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},decls:3,vars:2,consts:[[1,"ml-4"],[3,"version",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],[4,"ngFor","ngForOf"],["target","_blank",3,"href"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Qi,1,1,"ds-content-accordion",1),e.\u0275\u0275template(2,Xi,8,6,"div",2),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.policy.permittedVersions),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.policy||!r.policy.urls)))},directives:[V.sg,ut,V.O5],pipes:[U.X$,V.Nd],styles:[""]}),o})();function Hi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.id")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",t.metadata.id," ")}}function Ji(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.created")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,t.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function Zi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.modified")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,t.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function ki(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.record.information.uri")),e.\u0275\u0275advance(4),e.\u0275\u0275property("href",t.metadata.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.metadata.uri)}}let ft=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},decls:5,vars:4,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Hi,8,4,"div",1),e.\u0275\u0275template(2,Ji,9,7,"div",1),e.\u0275\u0275template(3,Zi,9,7,"div",1),e.\u0275\u0275template(4,ki,9,5,"div",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.id)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateCreated)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateModified)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.uri)))},directives:[V.O5],pipes:[U.X$,V.uU],styles:[""]}),o})();function qi(o,s){1&o&&e.\u0275\u0275element(0,"ds-alert",3),2&o&&e.\u0275\u0275property("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function eo(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",4)(1,"ds-alert",5),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().refresh()}),e.\u0275\u0275elementStart(6,"span"),e.\u0275\u0275element(7,"i",7),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()()}2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"submission.sections.sherpa.publisher.policy.description")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function to(o,s){1&o&&e.\u0275\u0275element(0,"span",21)}function no(o,s){1&o&&e.\u0275\u0275element(0,"span",22)}function io(o,s){1&o&&e.\u0275\u0275element(0,"span",21)}function oo(o,s){1&o&&e.\u0275\u0275element(0,"span",22)}function so(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(9).toggle()}),e.\u0275\u0275elementStart(2,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",13),e.\u0275\u0275template(6,io,1,0,"span",14),e.\u0275\u0275template(7,oo,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",16,17),e.\u0275\u0275element(10,"ds-publisher-policy",23),e.\u0275\u0275elementEnd()()}if(2&o){const t=s.$implicit,r=e.\u0275\u0275reference(9),c=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,6,"submission.sections.sherpa.publisher.policy")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("policy",t)}}function ao(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",10)(2,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(10).toggle()}),e.\u0275\u0275elementStart(3,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",13),e.\u0275\u0275template(7,to,1,0,"span",14),e.\u0275\u0275template(8,no,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",16,17),e.\u0275\u0275element(11,"ds-publication-information",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(12,so,11,8,"div",20),e.\u0275\u0275elementContainerEnd()}if(2&o){const t=s.$implicit,r=e.\u0275\u0275reference(10),c=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,7,"submission.sections.sherpa.publication.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("journal",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.policies)}}function ro(o,s){1&o&&e.\u0275\u0275element(0,"span",21)}function co(o,s){1&o&&e.\u0275\u0275element(0,"span",22)}function lo(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ao,13,9,"ng-container",9),e.\u0275\u0275elementStart(2,"div",10)(3,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(11).toggle()}),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",13),e.\u0275\u0275template(8,ro,1,0,"span",14),e.\u0275\u0275template(9,co,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",16,17),e.\u0275\u0275element(12,"ds-metadata-information",18),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&o){const t=e.\u0275\u0275reference(11),r=e.\u0275\u0275nextContext().ngVar,c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.journals),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,"submission.sections.sherpa.record.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("metadata",r.metadata)}}function po(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-alert",3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("type",r.AlertTypeEnum.Error)("content",t.message?t.message:e.\u0275\u0275pipeBind1(2,2,"submission.sections.sherpa.error.message"))}}function mo(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,lo,13,9,"ng-container",8),e.\u0275\u0275template(2,po,3,4,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.hasNoData()&&!!t&&!t.error),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!t&&t.error)}}let Oe=class extends B{constructor(s,t,r,c,m){super(void 0,c,m),this.sectionService=s,this.operationsBuilder=t,this.submissionService=r,this.injectedSectionData=c,this.injectedSubmissionId=m,this.sherpaPoliciesData$=new Ge.X(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=Ye.N}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(s=>{this.sherpaPoliciesData$.next(s)}))}getSectionStatus(){return(0,he.of)(!0)}hasNoData(){return(0,f.xb)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}};Oe.\u0275fac=function(s){return new(s||Oe)(e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Oe.\u0275cmp=e.\u0275\u0275defineComponent({type:Oe,selectors:[["ds-section-sherpa-policies"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[[3,"type","content",4,"ngIf"],["class","d-flex flex-column flex-nowrap mt-2 mb-4",4,"ngIf"],[4,"ngVar"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-right",3,"click"],[1,"fas","fa-sync"],[4,"ngIf"],[4,"ngFor","ngForOf"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],[3,"metadata"],[3,"journal"],["class","mb-3 border-bottom","data-test","collapse",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"policy"]],template:function(s,t){if(1&s&&(e.\u0275\u0275template(0,qi,1,2,"ds-alert",0),e.\u0275\u0275template(1,eo,10,7,"div",1),e.\u0275\u0275template(2,mo,3,2,"ng-container",2),e.\u0275\u0275pipe(3,"async")),2&s){let r;e.\u0275\u0275property("ngIf",t.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",null==(r=e.\u0275\u0275pipeBind1(3,3,t.sherpaPoliciesData$))?null:r.sherpaResponse)}},directives:[V.O5,pt.w,lt.g,V.sg,Ce._D,mt,_t,ft],pipes:[U.X$,V.Ov],styles:[""]}),Oe=(0,v.gn)([(0,O.E)(y.i.SherpaPolicies),(0,v.w6)("design:paramtypes",[d.J,be.w,j.b,Object,String])],Oe);const ht=[Ie,q,xe,ye,De,Oe];let uo=(()=>{class o{static withEntryComponents(){return{ngModule:o,providers:ht.map(t=>({provide:t}))}}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({providers:[Be,d.J,ge,Se,Ze],imports:[[V.ez,n.IR.forRoot(),E.m,Ee.Aw.forFeature("submission",St.L,yn.z7),J.sQ.forFeature(Dt),qn.x.withEntryComponents(),ei.a.withEntryComponents(),oi.e,Ce.bz,Ce.lQ,Ce.Gs]]}),o})();e.\u0275\u0275setComponentScope(Ie,[pt.w,V.O5,Je,V.sg,at],[U.X$,V.Ov])},87335:(ne,W,i)=>{"use strict";i.r(W),i.d(W,{SubmissionSubmitComponent:()=>C});var n=i(61135),E=i(63900),v=i(78372),e=i(38475),l=i(55489),b=i(20445),a=i(46283),F=i(58187),P=i(5e3),z=i(74202),w=i(86956);let C=(()=>{class U{constructor(_,A,L,$,f,B,u,T){this.changeDetectorRef=_,this.notificationsService=A,this.router=L,this.itemDataService=$,this.submissionService=f,this.translate=B,this.viewContainerRef=u,this.route=T,this.itemLink$=new n.X(void 0),this.subs=[],this.route.queryParams.subscribe(H=>{this.collectionParam=H.collection})}ngOnInit(){this.subs.push(this.submissionService.createSubmission(this.collectionParam).subscribe(_=>{(0,e.K0)(_)&&((0,e.xb)(_)?(this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"])):this.router.navigate(["/workspaceitems",_.id,"edit"],{replaceUrl:!0}))}),this.itemLink$.pipe((0,e.iy)(),(0,E.w)(_=>this.itemDataService.findByHref(_)),(0,a.g1)(),(0,v.b)(300)).subscribe(_=>{this.item=_.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(_=>(0,e.Uh)(_)).forEach(_=>_.unsubscribe()),this.viewContainerRef.clear(),this.changeDetectorRef.markForCheck()}}return U.\u0275fac=function(_){return new(_||U)(P.\u0275\u0275directiveInject(P.ChangeDetectorRef),P.\u0275\u0275directiveInject(l.T),P.\u0275\u0275directiveInject(z.F0),P.\u0275\u0275directiveInject(F.S),P.\u0275\u0275directiveInject(b.b),P.\u0275\u0275directiveInject(w.sK),P.\u0275\u0275directiveInject(P.ViewContainerRef),P.\u0275\u0275directiveInject(z.gz))},U.\u0275cmp=P.\u0275\u0275defineComponent({type:U,selectors:[["ds-submission-submit"]],decls:0,vars:0,template:function(_,A){},styles:[""]}),U})()},97726:(ne,W,i)=>{"use strict";i.d(W,{Y:()=>e});var n=i(79094),E=i(5e3);function v(l,b){}let e=(()=>{class l extends n.F{getComponentName(){return"SubmissionSubmitComponent"}importThemedComponent(a){return i(39881)(`./${a}/app/submission/submit/submission-submit.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,87335))}}return l.\u0275fac=function(){let b;return function(F){return(b||(b=E.\u0275\u0275getInheritedFactory(l)))(F||l)}}(),l.\u0275cmp=E.\u0275\u0275defineComponent({type:l,selectors:[["ds-themed-submission-submit"]],features:[E.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,F){1&a&&E.\u0275\u0275template(0,v,0,0,"ng-template",null,0,E.\u0275\u0275templateRefExtractor)},encapsulation:2}),l})()},55457:(ne,W,i)=>{"use strict";i.d(W,{Z:()=>l});var n=i(38475);const E=/([^\/]+)/g,v=/\/sections\/(.*)/,l=b=>("string"==typeof b?[b]:b).map(F=>F.match(E)&&F.match(E).length>2?{sectionId:F.match(E)[1],fieldId:F.match(E)[2],fieldIndex:(0,n.Uh)(F.match(E)[3])?+F.match(E)[3]:0,originalPath:F}:{sectionId:F.match(v)[1],originalPath:F})},35473:(ne,W,i)=>{"use strict";i.d(W,{Z:()=>v});var n=i(55457);const v=(e=[])=>{const l=Object.create({});return e.forEach(b=>{(0,n.Z)(b.paths).forEach(F=>{const P={path:F.originalPath,message:b.message};l[F.sectionId]||(l[F.sectionId]=[]),l[F.sectionId].push(P)})}),l}},8377:(ne,W,i)=>{var n={"./custom/app/submission/edit/submission-edit.component":[96893,6893]};function E(v){if(!i.o(n,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var e=n[v],l=e[0];return i.e(e[1]).then(()=>i(l))}E.keys=()=>Object.keys(n),E.id=8377,ne.exports=E},49252:(ne,W,i)=>{var n={"./custom/app/submission/import-external/submission-import-external.component":[39835,9835]};function E(v){if(!i.o(n,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var e=n[v],l=e[0];return i.e(e[1]).then(()=>i(l))}E.keys=()=>Object.keys(n),E.id=49252,ne.exports=E},39881:(ne,W,i)=>{var n={"./custom/app/submission/submit/submission-submit.component":[62208,2208]};function E(v){if(!i.o(n,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var e=n[v],l=e[0];return i.e(e[1]).then(()=>i(l))}E.keys=()=>Object.keys(n),E.id=39881,ne.exports=E}}]);