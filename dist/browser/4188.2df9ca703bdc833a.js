(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[4188],{71725:(W,P,o)=>{"use strict";o.d(P,{CH:()=>E,EV:()=>S});var _=o(69972),C=o(63352);const E="groups";function S(y){return new _.R((0,C.sr)(),E,y).toString()}},53982:(W,P,o)=>{"use strict";o.d(P,{a:()=>_});class _{constructor(E,h){this.text=E,this.url=h}}},63626:(W,P,o)=>{"use strict";o.d(P,{t:()=>I});var _=o(18270),C=o(15811),E=o(46283),h=o(54004),S=o(38475),y=o(5e3);let I=(()=>{class p{constructor(x,e){this.breadcrumbService=x,this.dataService=e}resolve(x,e){const b=x.params.id;return this.dataService.findById(b,!0,!1,...this.followLinks).pipe((0,E.hC)(),(0,E.xe)(),(0,h.U)(R=>{if((0,S.Uh)(R)){const D=e.url,U=D.substr(0,D.indexOf(b))+b;return{provider:this.breadcrumbService,key:R,url:U}}}))}}return p.\u0275fac=function(x){return new(x||p)(y.\u0275\u0275inject(_.B),y.\u0275\u0275inject(C.D))},p.\u0275prov=y.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},18270:(W,P,o)=>{"use strict";o.d(P,{B:()=>b});var _=o(53982),C=o(39646),E=o(74229),h=o(18838),S=o(40367),y=o(63900),I=o(54004),p=o(38475),v=o(63352),x=o(5e3),e=o(63782);let b=(()=>{class R{constructor(U,F){this.linkService=U,this.dsoNameService=F}getBreadcrumbs(U,F){const a=this.dsoNameService.getName(U),L=new _.a(a,F),j=U.getParentLinkKey();return this.linkService.resolveLink(U,(0,h.l)(j))[j].pipe((0,S.s)(T=>T.hasSucceeded||204===T.statusCode),(0,y.w)(T=>{if((0,p.Uh)(T.payload)){const m=T.payload;return this.getBreadcrumbs(m,(0,v.Y4)(m))}return(0,C.of)([])}),(0,I.U)(T=>[...T,L]))}}return R.\u0275fac=function(U){return new(U||R)(x.\u0275\u0275inject(E.M),x.\u0275\u0275inject(e._))},R.\u0275prov=x.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"}),R})()},25071:(W,P,o)=>{"use strict";o.d(P,{h:()=>E});var _=o(40767),C=o(54004);class E extends _.q{getFeatureIDs(S,y){return this.getFeatureID(S,y).pipe((0,C.U)(I=>[I]))}}},40767:(W,P,o)=>{"use strict";o.d(P,{q:()=>S});var _=o(46283),C=o(54004),E=o(38475),h=o(29616);class S extends h.I{constructor(I,p,v,x){super(p,v,x),this.resolver=I,this.authorizationService=p,this.router=v,this.authService=x}getObjectUrl(I,p){const v=this.getRouteWithDSOId(I);return this.resolver.resolve(v,p).pipe((0,_.mc)(),(0,C.U)(x=>x.self))}getRouteWithDSOId(I){let p=I;for(;(0,E.xI)(p.params.id)&&(0,E.Uh)(p.parent);)p=p.parent;return p}}},32527:(W,P,o)=>{"use strict";o.d(P,{K:()=>E});const C={RESOLVED:(0,o(6845).d)("dspace/resolver/RESOLVED")};class E{constructor(S,y){this.type=C.RESOLVED,this.payload={url:S,dso:y}}}},33881:(W,P,o)=>{"use strict";o.d(P,{a:()=>j});var _=o(39841),E=(o(44542),o(58187)),h=o(62989),S=o(55489),y=o(54004),I=o(18505),p=o(63900),v=o(50590),x=o(2956),e=o(41298),b=o(96140),R=o(46283),D=o(38475),U=o(40642),F=o(5e3),a=o(74202),L=o(86956);let j=(()=>{class T extends x._{constructor(w,K,Q,oe,pe,Z){super(K,oe,pe),this.itemService=w,this.objectUpdatesService=K,this.router=Q,this.notificationsService=oe,this.translateService=pe,this.route=Z}ngOnInit(){(0,D.Uh)(this.item)?this.setItem(this.item):this.itemUpdateSubscription=(0,_.a)([this.route.data,this.route.parent.data]).pipe((0,y.U)(([w,K])=>Object.assign({},w,K)),(0,y.U)(w=>w.dso),(0,I.b)(w=>{this.item=w.payload}),(0,p.w)(w=>this.itemService.findByHref(w.payload._links.self.href,!0,!0,...U.H)),(0,R.g1)()).subscribe(w=>{this.setItem(w.payload)}),this.discardTimeOut=e.N.item.edit.undoTimeout,this.url=this.router.url,this.url.indexOf("?")>0&&(this.url=this.url.substr(0,this.url.indexOf("?"))),this.hasChanges().pipe((0,v.P)()).subscribe(w=>{w?this.checkLastModified():this.initializeOriginalFields()}),this.initializeNotificationsPrefix(),this.initializeUpdates()}setItem(w){this.item=w,this.itemPageRoute=(0,b.Tt)(this.item),this.postItemInit(),this.initializeUpdates()}ngOnDestroy(){(0,D.Uh)(this.itemUpdateSubscription)&&this.itemUpdateSubscription.unsubscribe()}postItemInit(){}initializeUpdates(){}initializeNotificationsPrefix(){}initializeOriginalFields(){}submit(){}trackUpdate(w,K){return K&&K.field?K.field.uuid:void 0}isValid(){return this.objectUpdatesService.isValidPage(this.url)}checkLastModified(){const w=this.item.lastModified;this.objectUpdatesService.getLastModified(this.url).pipe((0,v.P)()).subscribe(K=>{K.getDate()!==w.getDate()&&(this.notificationsService.warning(this.getNotificationTitle("outdated"),this.getNotificationContent("outdated")),this.initializeOriginalFields())})}}return T.\u0275fac=function(w){return new(w||T)(F.\u0275\u0275directiveInject(E.S),F.\u0275\u0275directiveInject(h.d),F.\u0275\u0275directiveInject(a.F0),F.\u0275\u0275directiveInject(S.T),F.\u0275\u0275directiveInject(L.sK),F.\u0275\u0275directiveInject(a.gz))},T.\u0275cmp=F.\u0275\u0275defineComponent({type:T,selectors:[["ds-abstract-item-update"]],inputs:{item:"item"},features:[F.\u0275\u0275InheritDefinitionFeature],decls:0,vars:0,template:function(w,K){},encapsulation:2}),T})()},87743:(W,P,o)=>{"use strict";o.r(P),o.d(P,{EditItemPageModule:()=>$i});var _=o(69808),C=o(17656),E=o(42501),h=o(74202),S=o(72031),y=o(39646),I=o(39841),p=o(54004),v=o(38475),x=o(96140),e=o(5e3),b=o(86956);const R=function(i){return{active:i}},D=function(i){return[i]};function U(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"a",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,R,t.page===n.currentPage))("routerLink",e.\u0275\u0275pureFunction1(7,D,"./"+t.page)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,3,"item.edit.tabs."+t.page+".head")," ")}}function F(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"button",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.tabs."+t.page+".head")," ")}}function a(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"li",13),e.\u0275\u0275template(1,U,3,9,"a",14),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"span",15),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275template(5,F,3,3,"button",16),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,3,t.enabled)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbTooltip",e.\u0275\u0275pipeBind1(4,5,"item.edit.tabs.disabled.tooltip")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(6,7,t.enabled))}}let L=(()=>{class i{constructor(t,n,r){this.route=t,this.router=n,this.injector=r,this.router.events.subscribe(()=>this.initPageParamsByRoute())}ngOnInit(){this.initPageParamsByRoute(),this.pages=this.route.routeConfig.children.filter(t=>(0,v.UE)(t.path)).map(t=>{let n=(0,y.of)(!0);return(0,v.UE)(t.canActivate)&&(n=(0,I.a)(t.canActivate.map(r=>this.injector.get(r).canActivate(this.route.snapshot,this.router.routerState.snapshot))).pipe((0,p.U)(r=>r.every(l=>!0===l)))),{page:t.path,enabled:n}}),this.itemRD$=this.route.data.pipe((0,p.U)(t=>t.dso))}getItemPage(t){return(0,x.Tt)(t)}initPageParamsByRoute(){this.currentPage=this.route.snapshot.firstChild.routeConfig.path}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(e.Injector))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-item-page"]],decls:19,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"border-bottom"],[1,"pt-2"],[1,"nav","nav-tabs","justify-content-start"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"nav-item"],["class","nav-link",3,"ngClass","routerLink",4,"ngIf"],[3,"ngbTooltip"],["class","nav-link disabled",4,"ngIf"],[1,"nav-link",3,"ngClass","routerLink"],[1,"nav-link","disabled"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",4)(7,"ul",5),e.\u0275\u0275template(8,a,7,9,"li",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",7)(10,"div",8),e.\u0275\u0275element(11,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",9)(13,"div",10)(14,"a",11),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275element(16,"i",12),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()()()()),2&t){let r;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,4,"item.edit.head")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.pages),e.\u0275\u0275advance(6),e.\u0275\u0275property("routerLink",n.getItemPage(null==(r=e.\u0275\u0275pipeBind1(15,6,n.itemRD$))?null:r.payload)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,8,"item.edit.return"),"")}},directives:[_.sg,_.O5,h.yS,_.mk,C._L,h.lC],pipes:[b.X$,_.Ov],encapsulation:2,data:{animation:[S.Ji,S.Ic]},changeDetection:0}),i})();var j=o(55489),T=o(58187),m=o(46283),w=o(50590),Q=o(42388);const oe=function(i){return{id:i}},pe=function(i){return[i,"edit"]};let Z=(()=>{class i{constructor(t,n,r,l,c){this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.translateService=c}ngOnInit(){this.itemRD$=this.route.data.pipe((0,p.U)(t=>t.dso),(0,m.xw)()),this.itemRD$.pipe((0,w.P)()).subscribe(t=>{this.item=t.payload,this.itemPageRoute=(0,x.Tt)(this.item)}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){}processRestResponse(t){t.hasSucceeded?this.itemDataService.findById(this.item.id).pipe((i=>s=>s.pipe((0,m.g1)(),(0,w.P)(i)))(this.predicate)).subscribe(()=>{this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([(0,x.tn)(this.item)])}):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,x.tn)(this.item)]))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-simple-action"]],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,oe,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,pe,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[Q.E,h.rH],pipes:[b.X$],encapsulation:2}),i})();const Me=function(i){return{id:i}},_e=function(i){return[i,"edit"]};let Pe=(()=>{class i extends Z{constructor(t,n,r,l,c){super(t,n,r,l,c),this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.translateService=c,this.messageKey="withdraw",this.predicate=f=>f.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!0).pipe((0,m.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-withdraw"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,Me,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,_e,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[Q.E,h.rH],pipes:[b.X$],encapsulation:2}),i})();const Te=function(i){return{id:i}},Be=function(i){return[i,"edit"]};let De=(()=>{class i extends Z{constructor(t,n,r,l,c){super(t,n,r,l,c),this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.translateService=c,this.messageKey="reinstate",this.predicate=f=>!f.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!1).pipe((0,m.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-reinstate"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,Te,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,Be,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[Q.E,h.rH],pipes:[b.X$],encapsulation:2}),i})();const Ue=function(i){return{id:i}},Re=function(i){return[i,"edit"]};let we=(()=>{class i extends Z{constructor(t,n,r,l,c){super(t,n,r,l,c),this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.translateService=c,this.messageKey="private",this.predicate=f=>!f.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!1).pipe((0,m.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-private"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,Ue,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,Re,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[Q.E,h.rH],pipes:[b.X$],encapsulation:2}),i})();const je=function(i){return{id:i}},Fe=function(i){return[i,"edit"]};let $e=(()=>{class i extends Z{constructor(t,n,r,l,c){super(t,n,r,l,c),this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.translateService=c,this.messageKey="public",this.predicate=f=>f.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!0).pipe((0,m.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-public"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,je,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,Fe,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[Q.E,h.rH],pipes:[b.X$],encapsulation:2}),i})();var B=o(63900),z=o(95698),me=o(46590),Y=o(39300),G=o(61135),xe=o(60347),X=o(62989),ge=o(54444),ye=o(72683),ve=o(74229),H=o(18838),q=o(41989),fe=o(66541);function Ae(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-listable-object-component-loader",24),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("object",t)("viewMode",n.viewMode)}}function Ve(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-listable-object-component-loader",24),2&i){const t=e.\u0275\u0275nextContext(2).ngVar,n=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("object",t)("viewMode",n.viewMode)}}function Le(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"div")(2,"div",30),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.metadataField," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataValue.value," ")}}function u(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",25),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",26),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(7).closeVirtualMetadataModal()}),e.\u0275\u0275elementStart(5,"span",27),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",28),e.\u0275\u0275template(8,Ve,1,2,"ds-listable-object-component-loader",18),e.\u0275\u0275template(9,Le,6,2,"div",29),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"virtual-metadata.delete-item.modal-head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,5,r.getVirtualMetadata(n)))}}function $(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ae,1,2,"ds-listable-object-component-loader",18),e.\u0275\u0275elementStart(2,"div",19)(3,"div",20)(4,"button",21),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275reference(7);return e.\u0275\u0275nextContext(6).openVirtualMetadataModal(r)}),e.\u0275\u0275element(5,"i",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(6,u,11,7,"ng-template",null,23,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}function d(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275template(1,$,8,1,"ng-container",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.getRelatedItem(t)))}}function g(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).ngVar,c=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(3).setSelected(c,!l)}),e.\u0275\u0275elementStart(2,"label"),e.\u0275\u0275element(3,"input",14),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",15)(5,"h5",16),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).ngVar,c=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(3).setSelected(c,!l)}),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,d,3,3,"div",17),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(7,3,r.getRelationshipMessageKey(e.\u0275\u0275pipeBind1(8,5,r.getLabel(n))))," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,7,r.getRelationships(n)))}}function O(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275template(1,g,11,9,"div",11),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.isSelected(t)))}}function k(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275template(3,O,3,3,"div",10),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,"virtual-metadata.delete-item.info")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t)}}function A(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,k,4,4,"div",8),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t&&t.length>0)}}const ee=function(i){return{id:i}},ue=function(i){return[i,"edit"]};let It=(()=>{class i extends Z{constructor(t,n,r,l,c,f,M,N,J,re){super(t,n,r,l,c),this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.translateService=c,this.modalService=f,this.objectUpdatesService=M,this.relationshipService=N,this.entityTypeService=J,this.linkService=re,this.messageKey="delete",this.viewMode=xe.w.ListElement,this.types$=new G.X([]),this.relationships$=new Map,this.relatedItems$=new Map,this.virtualMetadata$=new Map,this.subs=[]}ngOnInit(){super.ngOnInit(),this.url=this.router.url;const t=this.item.firstMetadataValue("dspace.entity.type");(0,v.UE)(t)&&this.subs.push(this.entityTypeService.getEntityTypeByLabel(t).pipe((0,m.xw)(),(0,m.xe)(),(0,B.w)(n=>this.entityTypeService.getEntityTypeRelationships(n.id)),(0,m.xw)(),(0,m.xe)(),(0,p.U)(n=>n.page),(0,B.w)(n=>0===n.length?(0,y.of)(n):(0,I.a)(n.map(r=>this.getRelationships(r))).pipe((0,p.U)(r=>n.reduce((l,c,f)=>l.some(M=>M.id===c.id)||0===r[f].length?l:[...l,c],[]))))).subscribe(n=>this.types$.next(n))),this.subs.push(this.types$.pipe((0,z.q)(1)).subscribe(n=>this.objectUpdatesService.initialize(this.url,n,this.item.lastModified)))}openVirtualMetadataModal(t){this.modalRef=this.modalService.open(t)}closeVirtualMetadataModal(){this.modalRef.close()}getRelationshipMessageKey(t){return(0,v.Uh)(t)&&t.indexOf("Of")>-1?`relationships.${t.substring(0,t.indexOf("Of")+2)}`:t}getLabel(t){return this.getRelationships(t).pipe((0,B.w)(n=>this.isLeftItem(n[0]).pipe((0,p.U)(r=>r?t.leftwardType:t.rightwardType))))}getRelationships(t){return this.relationships$.has(t)||this.relationships$.set(t,this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,B.w)(n=>(0,I.a)(n.map(r=>this.getRelationshipType(r))).pipe((0,me.d)([]),(0,p.U)(r=>n.filter((l,c)=>t.id===r[c].id)))))),this.relationships$.get(t)}getRelationshipType(t){return this.linkService.resolveLinks(t,(0,H.l)("relationshipType"),(0,H.l)("leftItem"),(0,H.l)("rightItem")),t.relationshipType.pipe((0,m.xw)(),(0,m.xe)(),(0,Y.h)(n=>(0,v.Uh)(n)&&(0,v.UE)(n.uuid)))}getRelatedItem(t){return this.relatedItems$.has(t)||this.relatedItems$.set(t,this.isLeftItem(t).pipe((0,B.w)(n=>n?t.rightItem:t.leftItem),(0,m.xw)(),(0,m.xe)())),this.relatedItems$.get(t)}getVirtualMetadata(t){return this.virtualMetadata$.has(t)||this.virtualMetadata$.set(t,this.getRelatedItem(t).pipe((0,p.U)(n=>Object.entries(n.metadata).map(([r,l])=>l.filter(c=>c.authority&&c.authority.endsWith(t.id)).map(c=>({metadataField:r,metadataValue:c}))).reduce((r,l)=>r.concat(l))))),this.virtualMetadata$.get(t)}isLeftItem(t){return t.leftItem.pipe((0,m.xw)(),(0,m.xe)(),(0,Y.h)(n=>(0,v.Uh)(n)&&(0,v.UE)(n.uuid)),(0,p.U)(n=>n.uuid===this.item.uuid))}isSelected(t){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.item.uuid,t.uuid)}setSelected(t,n){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.item.uuid,t.uuid,n)}performAction(){this.subs.push(this.types$.pipe((0,B.w)(t=>(0,I.a)(t.map(n=>this.isSelected(n))).pipe((0,me.d)([]),(0,p.U)(n=>t.filter((r,l)=>n[l])),(0,p.U)(n=>n.map(r=>r.id)))),(0,B.w)(t=>this.itemDataService.delete(this.item.id,t).pipe((0,m.hC)()))).subscribe(t=>{this.notify(t.hasSucceeded)}))}notify(t){t?(this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([""])):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,x.tn)(this.item)]))}ngOnDestroy(){this.subs.filter(t=>(0,v.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(C.FF),e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(ge.U),e.\u0275\u0275directiveInject(ye.v),e.\u0275\u0275directiveInject(ve.M))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-delete"]],inputs:{url:"url"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:19,vars:22,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[4,"ngVar"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"],["class","mb-4",4,"ngIf"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf"],["class","d-flex flex-row",4,"ngVar"],[1,"d-flex","flex-row"],[1,"m-2",3,"click"],["type","checkbox",3,"checked"],[1,"flex-column","flex-grow-1"],[3,"click"],["class","d-flex flex-row",4,"ngFor","ngForOf"],[3,"object","viewMode",4,"ngIf"],[1,"ml-auto"],[1,"btn-group"],[1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"fas","fa-info","fa-fw"],["virtualMetadataModal",""],[3,"object","viewMode"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275template(10,A,2,1,"ng-container",4),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",5)(13,"button",6),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"button",7),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,7,n.headerMessage,e.\u0275\u0275pureFunction1(18,ee,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,10,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(11,12,n.types$)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(15,14,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(20,ue,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,16,n.cancelMessage)," "))},directives:[Q.E,q.g,_.O5,_.sg,fe.p,h.rH],pipes:[b.X$,_.Ov],encapsulation:2}),i})();class te{constructor(s,t,n,r=!1,l=!0){this.operationKey=s,this.operationUrl=t,this.featureID=n,this.authorized=l,this.setDisabled(r)}setDisabled(s){this.disabled=s}}var be=o(86099),Ye=o(71884),qe=o(32518),et=o(50457),ne=o(86316),V=o(5587);function Ct(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"button",5),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",t.operation.disabled)("routerLink",t.operation.operationUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"item.edit.tabs.status.buttons."+t.operation.operationKey+".button")," ")}}function xt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span",6),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275elementStart(2,"button",7),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngbTooltip",e.\u0275\u0275pipeBind1(1,3,"item.edit.tabs.status.buttons.unauthorized")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,5,"item.edit.tabs.status.buttons."+t.operation.operationKey+".button")," ")}}let yt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-operation"]],inputs:{operation:"operation"},decls:7,vars:5,consts:[[1,"col-3","float-left","d-flex","h-100","action-label"],[1,"justify-content-center","align-self-center"],[1,"col-9","float-left","action-button"],[4,"ngIf"],[3,"ngbTooltip",4,"ngIf"],[1,"btn","btn-outline-primary",3,"disabled","routerLink"],[3,"ngbTooltip"],[1,"btn","btn-outline-primary",3,"disabled"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"span",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",2),e.\u0275\u0275template(5,Ct,4,5,"span",3),e.\u0275\u0275template(6,xt,5,7,"span",4),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"item.edit.tabs.status.buttons."+n.operation.operationKey+".label")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.operation.authorized),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.operation.authorized))},directives:[_.O5,h.rH,C._L],pipes:[b.X$],encapsulation:2}),i})();function Et(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",7)(1,"div",3),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",8),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"item.edit.tabs.status.labels."+t),": "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate1("id","status-",t,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.statusData[t]," ")}}function St(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-item-operation",11),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("operation",t)}}const Ot=function(i){return{"pt-3":i}};function Mt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275template(1,St,1,1,"ds-item-operation",10),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(2,Ot,t)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}let Pt=(()=>{class i{constructor(t,n){this.route=t,this.authorizationService=n,this.operations$=new G.X([])}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,p.U)(t=>t.dso)),this.itemRD$.pipe((0,w.P)(),(0,p.U)(t=>t.payload)).subscribe(t=>{this.statusData=Object.assign({id:t.id,handle:t.handle,lastModified:t.lastModified}),this.statusDataKeys=Object.keys(this.statusData);const n=[];n.push(new te("authorizations",this.getCurrentUrl(t)+"/authorizations",V.i.CanManagePolicies,!0)),n.push(new te("mappedCollections",this.getCurrentUrl(t)+"/mapper",V.i.CanManageMappings,!0)),n.push(t.isWithdrawn?new te("reinstate",this.getCurrentUrl(t)+"/reinstate",V.i.ReinstateItem,!0):new te("withdraw",this.getCurrentUrl(t)+"/withdraw",V.i.WithdrawItem,!0)),n.push(t.isDiscoverable?new te("private",this.getCurrentUrl(t)+"/private",V.i.CanMakePrivate,!0):new te("public",this.getCurrentUrl(t)+"/public",V.i.CanMakePrivate,!0)),n.push(new te("delete",this.getCurrentUrl(t)+"/delete",V.i.CanDelete,!0)),n.push(new te("move",this.getCurrentUrl(t)+"/move",V.i.CanMove,!0)),this.operations$.next(n),(0,et.D)(n).pipe((0,be.z)(r=>(0,v.Uh)(r.featureID)?this.authorizationService.isAuthorized(r.featureID,t.self).pipe((0,Ye.x)(),(0,p.U)(l=>new te(r.operationKey,r.operationUrl,r.featureID,!l,l))):[r]),(0,qe.q)()).subscribe(r=>this.operations$.next(r))}),this.itemPageRoute$=this.itemRD$.pipe((0,m.mc)(),(0,p.U)(t=>(0,x.Tt)(t)))}getCurrentUrl(t){return(0,x.tn)(t)}trackOperation(t,n){return(0,v.Uh)(n)?n.operationKey:void 0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(ne._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-status"]],decls:15,vars:16,consts:[[1,"mt-2"],[1,"row"],["class","w-100",4,"ngFor","ngForOf"],[1,"col-3","float-left","status-label"],["id","status-itemPage",1,"col-9","float-left","status-data"],[3,"routerLink"],["class","w-100",3,"ngClass",4,"ngFor","ngForOf"],[1,"w-100"],[1,"col-9","float-left","status-data",3,"id"],[1,"w-100",3,"ngClass"],[3,"operation",4,"ngIf"],[3,"operation"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"p",0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",1),e.\u0275\u0275template(4,Et,6,5,"div",2),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",4)(9,"a",5),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(13,Mt,2,4,"div",6),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,6,"item.edit.tabs.status.description")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.statusDataKeys),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(7,8,"item.edit.tabs.status.labels.itemPage"),": "),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pipeBind1(10,10,n.itemPageRoute$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,12,n.itemPageRoute$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(14,14,n.operations$)))},directives:[_.sg,h.yS,_.mk,_.O5,yt],pipes:[b.X$,_.Ov],encapsulation:2,data:{animation:[S.Ji,S.Ic]}}),i})();var Tt=o(92165),tt=o(33881),he=o(62557),Bt=o(82296),nt=o(27139),Ee=o(64025),ze=o(88638),ke=o(21605);class Ie{constructor(s,t,n,r,l){this.xs=s,this.sm=t,this.md=n,this.lg=r,this.xl=l}buildClasses(){return`col-${this.xs} col-sm-${this.sm} col-md-${this.md} col-lg-${this.lg} col-xl-${this.xl}`}}class Dt{constructor(s){this.columns=s}combineColumns(s,t){if(s<t&&(0,v.Uh)(this.columns[s])&&(0,v.Uh)(this.columns[t])){let n=this.columns[s].xs,r=this.columns[s].sm,l=this.columns[s].md,c=this.columns[s].lg,f=this.columns[s].xl;for(let M=s+1;M<t+1;M++)n+=this.columns[M].xs,r+=this.columns[M].sm,l+=this.columns[M].md,c+=this.columns[M].lg,f+=this.columns[M].xl;return new Ie(n,r,l,c,f)}}}var se=o(54818);const Ut=["handleView"];function Rt(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275element(1,"i",2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(2,1,"item.edit.bitstreams.edit.buttons.drag")))}let Ke=(()=>{class i{constructor(t){this.viewContainerRef=t}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.handleView)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream-drag-handle"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Ut,7),2&t){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.handleView=r.first)}},decls:2,vars:0,consts:[["handleView",""],["tabindex","0",1,"drag-handle","text-muted","float-left","p-1","mr-2"],[1,"fas","fa-grip-vertical","fa-fw",3,"title"]],template:function(t,n){1&t&&e.\u0275\u0275template(0,Rt,3,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)},pipes:[b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();o(40117),o(44542);var it=o(74293),Ce=o(21283),We=o(92396),wt=o(84250),Ne=o(94799),Se=o(42988);let Ft=(()=>{class i{constructor(t,n,r,l){this.objectUpdatesService=t,this.elRef=n,this.objectValuesPipe=r,this.paginationService=l,this.dropObject=new e.EventEmitter,this.pageSize=10,this.options=Object.assign(new it.r,{id:"dad",currentPage:1,pageSize:this.pageSize}),this.currentPage$=new G.X(this.options),this.loading$=new G.X(!1),this.subs=[]}ngOnInit(){this.initializeObjectsRD(),this.initializeURL(),this.initializeUpdates(),this.initializePagination()}initializePagination(){this.paginationService.getCurrentPagination(this.options.id,this.options).subscribe(t=>{this.currentPage$.next(t)})}initializeUpdates(){this.objectsRD$.pipe((0,m.xw)(),(0,m.ZU)()).subscribe(t=>{this.objectUpdatesService.initialize(this.url,t,new Date)}),this.updates$=this.objectsRD$.pipe((0,m.g1)(),(0,m.ZU)(),(0,B.w)(t=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,t))),this.subs.push(this.updates$.pipe((0,p.U)(t=>this.objectValuesPipe.transform(t)),(0,Ye.x)((0,wt.Rh)(i=>(0,v.Uh)(i)&&(0,v.Uh)(i.field)?i.field.uuid:void 0))).subscribe(t=>{this.customOrder=t.map(n=>n.field.uuid),this.loading$.next(!1)}),this.loading$.subscribe(t=>this.options.disabled=t))}drop(t){const n=t.previousIndex;let r=t.currentIndex;const l=this.currentPage$.value.currentPage-1;let c=this.currentPage$.value.currentPage-1;const f=this.elRef.nativeElement.querySelector(".page-item:hover");if((0,v.Uh)(f)&&(0,v.Uh)(f.textContent)){const ce=Number(f.textContent);(0,v.Uh)(ce)&&!Number.isNaN(ce)&&(c=ce-1,r=0)}const M=l!==c;!M&&n!==r&&(0,Ce.bA)(this.customOrder,n,r);const N=c+1,J=l*this.pageSize+n,re=c*this.pageSize+r;J!==re&&(M&&this.loading$.next(!0),this.dropObject.emit(Object.assign({fromIndex:J,toIndex:re,finish:()=>{M&&this.paginationComponent.doPageChange(N)}})))}ngOnDestroy(){this.subs.filter(t=>(0,v.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.options.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(Se.g),e.\u0275\u0275directiveInject(Ne.N))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-paginated-drag-drop-abstract"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(We.Q,5),2&t){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.paginationComponent=r.first)}},outputs:{dropObject:"dropObject"},decls:0,vars:0,template:function(t,n){},encapsulation:2}),i})();var Ge=o(17489),$t=o(63352),He=o(63782),At=o(54283);const Vt=["bitstreamView"];function Lt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"a",14),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"dsBrowserOnly"),e.\u0275\u0275element(3,"i",15),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(1,3,"item.edit.bitstreams.edit.buttons.download")),e.\u0275\u0275property("href",t.bitstreamDownloadUrl,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275attribute("data-test",e.\u0275\u0275pipeBind1(2,5,"download-button"))}}const zt=function(i){return["/bitstreams/",i,"edit"]};function kt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275projection(1),e.\u0275\u0275elementStart(2,"div",1)(3,"span",2),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(5,"div")(6,"div",3)(7,"div",4),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div")(10,"div",5)(11,"span",2),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div")(15,"div",5)(16,"div",6),e.\u0275\u0275template(17,Lt,4,7,"a",7),e.\u0275\u0275elementStart(18,"button",8),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275element(20,"i",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",10),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().remove()}),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275element(23,"i",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"button",12),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().undo()}),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275element(26,"i",13),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[0].buildClasses()," row-element d-flex"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.bitstreamName," "),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[1].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(2),e.\u0275\u0275property("tooltipClass","larger-tooltip")("ngbTooltip",null==t.bitstream?null:t.bitstream.firstMetadataValue("dc.description")),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",null==t.bitstream?null:t.bitstream.firstMetadataValue("dc.description")," "),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[2].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",null==(n=e.\u0275\u0275pipeBind1(13,24,t.format$))?null:n.shortDescription," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[3].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",null!=t.bitstreamDownloadUrl),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(19,26,"item.edit.bitstreams.edit.buttons.edit")),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(32,zt,t.bitstream.id)),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(22,28,"item.edit.bitstreams.edit.buttons.remove")),e.\u0275\u0275property("disabled",!t.canRemove()),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(25,30,"item.edit.bitstreams.edit.buttons.undo")),e.\u0275\u0275property("disabled",!t.canUndo())}}const Kt=[[["","slot","drag-handle"]]],Wt=["[slot=drag-handle]"];let Nt=(()=>{class i{constructor(t,n,r){this.objectUpdatesService=t,this.dsoNameService=n,this.viewContainerRef=r}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.bitstreamView)}ngOnChanges(t){this.bitstream=(0,Ge.cloneDeep)(this.fieldUpdate.field),this.bitstreamName=this.dsoNameService.getName(this.bitstream),this.bitstreamDownloadUrl=(0,$t.gs)(this.bitstream),this.format$=this.bitstream.format.pipe((0,m.xw)(),(0,m.xe)())}remove(){this.objectUpdatesService.saveRemoveFieldUpdate(this.bundleUrl,this.bitstream)}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.bundleUrl,this.bitstream.uuid)}canRemove(){return this.fieldUpdate.changeType!==se.m.REMOVE}canUndo(){return this.fieldUpdate.changeType>=0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(He._),e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Vt,7),2&t){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.bitstreamView=r.first)}},inputs:{fieldUpdate:"fieldUpdate",bundleUrl:"bundleUrl",columnSizes:"columnSizes"},features:[e.\u0275\u0275NgOnChangesFeature],ngContentSelectors:Wt,decls:2,vars:0,consts:[["bitstreamView",""],[1,"float-left","d-flex","align-items-center","overflow-hidden"],[1,"text-truncate"],[1,"w-100"],["placement","bottom",1,"text-truncate",3,"tooltipClass","ngbTooltip"],[1,"text-center","w-100"],[1,"btn-group","relationship-action-buttons"],["class","btn btn-outline-primary btn-sm",3,"href","title",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"href","title"],[1,"fas","fa-download","fa-fw"]],template:function(t,n){1&t&&(e.\u0275\u0275projectionDef(Kt),e.\u0275\u0275template(0,kt,27,34,"ng-template",null,0,e.\u0275\u0275templateRefExtractor))},directives:[C._L,_.O5,h.rH],pipes:[_.Ov,b.X$,At.g],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();var Oe=o(27924);const Gt=function(i,s,t,n){return{"table-warning":i,"table-danger":s,"table-success":t,"bg-white":n}};function Ht(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",7)(1,"ds-item-edit-bitstream",8)(2,"div",9),e.\u0275\u0275element(3,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2).ngVar,r=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("id",t)("ngClass",e.\u0275\u0275pureFunction4(5,Gt,0===n[t].changeType,2===n[t].changeType,1===n[t].changeType,void 0===n[t].changeType)),e.\u0275\u0275advance(1),e.\u0275\u0275property("fieldUpdate",n[t])("bundleUrl",r.bundle.self)("columnSizes",r.columnSizes)}}function Xt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ht,4,10,"div",6),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.customOrder)}}const Qt=function(i){return{"mb-3":i}};function Jt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5),e.\u0275\u0275listener("cdkDropListDropped",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).drop(r)}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,Xt,2,1,"ng-container",2),e.\u0275\u0275elementEnd()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext(3);let r;e.\u0275\u0275property("id",n.bundle.id)("ngClass",e.\u0275\u0275pureFunction1(5,Qt,(null==(r=e.\u0275\u0275pipeBind1(1,3,n.objectsRD$))||null==r.payload?null:r.payload.totalElements)>n.pageSize)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t)}}function Zt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Jt,3,7,"div",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t.updates$))}}function Yt(i,s){1&i&&(e.\u0275\u0275element(0,"ds-loading",10),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275property("message",e.\u0275\u0275pipeBind1(1,1,"loading.bitstreams"))}function qt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",1),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Zt,3,3,"ng-container",2),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,Yt,2,3,"ds-loading",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",t.options)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,8,t.objectsRD$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,10,t.objectsRD$))||null==r.payload?null:r.payload.totalElements),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(4,12,t.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,14,t.loading$))}}let en=(()=>{class i extends Ft{constructor(t,n,r,l,c,f){super(t,n,r,c),this.objectUpdatesService=t,this.elRef=n,this.objectValuesPipe=r,this.bundleService=l,this.paginationService=c,this.requestService=f}ngOnInit(){super.ngOnInit()}initializeObjectsRD(){this.objectsRD$=this.currentPage$.pipe((0,B.w)(t=>{const n=new ke.t({pagination:Object.assign({},t)});return this.bundleService.getBitstreamsEndpoint(this.bundle.id,n).pipe((0,B.w)(r=>this.requestService.hasByHref$(r)),(0,B.w)(()=>this.bundleService.getBitstreams(this.bundle.id,n,(0,H.l)("format"))))}))}initializeURL(){this.url=this.bundle.self}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(Se.g),e.\u0275\u0275directiveInject(ze.b),e.\u0275\u0275directiveInject(Ne.N),e.\u0275\u0275directiveInject(Ee.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-paginated-drag-and-drop-bitstream-list"]],inputs:{bundle:"bundle",columnSizes:"columnSizes"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","pageInfoState","collectionSize",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","pageInfoState","collectionSize"],[4,"ngIf"],[3,"message",4,"ngIf"],["class","bundle-bitstreams-list","cdkDropList","",3,"id","ngClass","cdkDropListDropped",4,"ngVar"],["cdkDropList","",1,"bundle-bitstreams-list",3,"id","ngClass","cdkDropListDropped"],["class","row bitstream-row","cdkDrag","",3,"id","ngClass",4,"ngFor","ngForOf"],["cdkDrag","",1,"row","bitstream-row",3,"id","ngClass"],[3,"fieldUpdate","bundleUrl","columnSizes"],["slot","drag-handle","cdkDragHandle","","tabindex","0",1,"d-flex","align-items-center","bitstream-row-drag-handle"],[3,"message"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,qt,7,16,"ds-pagination",0),e.\u0275\u0275pipe(1,"async")),2&t){let r;e.\u0275\u0275property("ngIf",null==(r=e.\u0275\u0275pipeBind1(1,1,n.objectsRD$))?null:r.payload)}},directives:[_.O5,We.Q,q.g,Ce.Wj,_.mk,_.sg,Ce.Zt,Nt,Ce.Bh,Ke,Oe.N],pipes:[_.Ov,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();const tn=["bundleView"],nn=function(i){return{name:i}},an=function(i){return[i,"bitstreams","new"]},rn=function(i){return{bundle:i}};function on(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div"),e.\u0275\u0275element(2,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275elementStart(3,"div",2),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div")(7,"div",3)(8,"button",4),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(11,"ds-paginated-drag-and-drop-bitstream-list",6),e.\u0275\u0275listener("dropObject",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().dropObject.emit(r)}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.bundleNameColumn.buildClasses()," font-weight-bold row-element d-flex"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(5,12,"item.edit.bitstreams.bundle.name",e.\u0275\u0275pureFunction1(17,nn,t.bundle.name))," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[3].buildClasses()," text-center row-element"),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(9,15,"item.edit.bitstreams.bundle.edit.buttons.upload")),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(19,an,t.itemPageRoute))("queryParams",e.\u0275\u0275pureFunction1(21,rn,t.bundle.id)),e.\u0275\u0275advance(3),e.\u0275\u0275property("bundle",t.bundle)("columnSizes",t.columnSizes)}}let sn=(()=>{class i{constructor(t){this.viewContainerRef=t,this.dropObject=new e.EventEmitter}ngOnInit(){this.bundleNameColumn=this.columnSizes.combineColumns(0,2),this.viewContainerRef.createEmbeddedView(this.bundleView),this.itemPageRoute=(0,x.Tt)(this.item)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream-bundle"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(tn,7),2&t){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.bundleView=r.first)}},inputs:{bundle:"bundle",item:"item",columnSizes:"columnSizes"},outputs:{dropObject:"dropObject"},decls:2,vars:0,consts:[["bundleView",""],[1,"row","bundle-row"],[1,"float-left","d-flex","align-items-center"],[1,"btn-group","bundle-action-buttons"],[1,"btn","btn-outline-success","btn-sm",3,"routerLink","queryParams","title"],[1,"fas","fa-upload","fa-fw"],[3,"bundle","columnSizes","dropObject"]],template:function(t,n){1&t&&e.\u0275\u0275template(0,on,12,23,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)},directives:[Ke,h.rH,en],pipes:[b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();function ln(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).reinstate()}),e.\u0275\u0275element(1,"i",16),e.\u0275\u0275elementStart(2,"span",5),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.bitstreams.reinstate-button"),""))}function dn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275elementStart(3,"span",5),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())||t.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.bitstreams.discard-button"),"")}}function cn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-item-edit-bitstream-bundle",22),e.\u0275\u0275listener("dropObject",function(r){const c=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).dropBitstream(c,r)}),e.\u0275\u0275elementEnd()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("bundle",t)("item",n.item)("columnSizes",n.columnSizes)}}function pn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",19)(1,"div",20)(2,"div"),e.\u0275\u0275element(3,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,cn,1,3,"ds-item-edit-bitstream-bundle",21),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[0].buildClasses()," row-element"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,17,"item.edit.bitstreams.headers.name")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[1].buildClasses()," row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,19,"item.edit.bitstreams.headers.description")),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[2].buildClasses()," text-center row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,21,"item.edit.bitstreams.headers.format")),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[3].buildClasses()," text-center row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,23,"item.edit.bitstreams.headers.actions")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t)}}function mn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.bitstreams.empty")," "))}function un(i,s){1&i&&(e.\u0275\u0275element(0,"ds-loading",24),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275propertyInterpolate("message",e.\u0275\u0275pipeBind1(1,1,"loading.bitstreams"))}function hn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).reinstate()}),e.\u0275\u0275element(1,"i",16),e.\u0275\u0275elementStart(2,"span",5),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.bitstreams.reinstate-button"),""))}function _n(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275elementStart(3,"span",5),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())||t.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.bitstreams.discard-button"),"")}}const gn=function(i){return[i,"bitstreams","new"]};function vn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"button",3),e.\u0275\u0275element(3,"i",4),e.\u0275\u0275elementStart(4,"span",5),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,ln,5,3,"button",6),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().submit()}),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275element(11,"i",8),e.\u0275\u0275elementStart(12,"span",5),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,dn,6,6,"button",9),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,pn,16,25,"div",10),e.\u0275\u0275template(18,mn,3,3,"div",11),e.\u0275\u0275template(19,un,2,3,"ds-loading",12),e.\u0275\u0275elementStart(20,"div",13)(21,"div",14),e.\u0275\u0275template(22,hn,5,3,"button",6),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementStart(24,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().submit()}),e.\u0275\u0275pipe(25,"async"),e.\u0275\u0275element(26,"i",8),e.\u0275\u0275elementStart(27,"span",5),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(30,_n,6,6,"button",9),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(31,gn,n.itemPageRoute)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(6,13,"item.edit.bitstreams.upload-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,15,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(10,17,n.hasChanges())||n.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(14,19,"item.edit.bitstreams.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(16,21,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.item&&(null==t?null:t.length)>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===(null==t?null:t.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(23,23,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(25,25,n.hasChanges())||n.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(29,27,"item.edit.bitstreams.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(31,29,n.isReinstatable()))}}let fn=(()=>{class i extends tt.a{constructor(t,n,r,l,c,f,M,N,J,re,ce,Ze){super(t,n,r,l,c,f),this.itemService=t,this.objectUpdatesService=n,this.router=r,this.notificationsService=l,this.translateService=c,this.route=f,this.bitstreamService=M,this.objectCache=N,this.requestService=J,this.cdRef=re,this.bundleService=ce,this.zone=Ze,this.bundlesOptions={id:"bundles-pagination-options",currentPage:1,pageSize:9999},this.columnSizes=new Dt([new Ie(2,2,3,4,4),new Ie(2,3,3,3,3),new Ie(2,2,2,2,2),new Ie(6,5,4,3,3)]),this.submitting=!1}postItemInit(){this.bundles$=this.itemService.getBundles(this.item.id,new ke.t({pagination:this.bundlesOptions})).pipe((0,m.xw)(),(0,m.xe)(),(0,p.U)(t=>t.page))}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.bitstreams.notifications."}submit(){this.submitting=!0,this.bundles$.pipe((0,z.q)(1)).pipe((0,B.w)(l=>(0,he.$)(...l.map(c=>this.objectUpdatesService.getFieldUpdates(c.self,[],!0)))),(0,p.U)(l=>[].concat(...l.map(c=>Object.values(c).filter(f=>f.changeType===se.m.REMOVE)))),(0,p.U)(l=>l.map(c=>c.field))).pipe((0,z.q)(1),(0,B.w)(l=>(0,v.UE)(l)?(0,he.$)(...l.map(c=>this.bitstreamService.delete(c.id))):(0,y.of)(void 0))).pipe((0,z.q)(1)).subscribe(l=>{this.displayNotifications("item.edit.bitstreams.notifications.remove",l),this.submitting=!1})}dropBitstream(t,n){this.zone.runOutsideAngular(()=>{(0,v.Uh)(n)&&(0,v.Uh)(n.fromIndex)&&(0,v.Uh)(n.toIndex)&&(0,v.Uh)(n.finish)&&this.bundleService.patch(t,[{op:"move",from:`/_links/bitstreams/${n.fromIndex}/href`,path:`/_links/bitstreams/${n.toIndex}/href`}]).pipe((0,z.q)(1)).subscribe(l=>{this.zone.run(()=>{this.displayNotifications("item.edit.bitstreams.notifications.move",[l]),this.requestService.removeByHrefSubstring(t.self).pipe((0,Y.h)(c=>c),(0,z.q)(1)).subscribe(()=>n.finish())})})})}displayNotifications(t,n){if((0,v.UE)(n)){const r=n.filter(c=>(0,v.Uh)(c)&&c.hasFailed),l=n.filter(c=>(0,v.Uh)(c)&&c.hasSucceeded);r.forEach(c=>{this.notificationsService.error(this.translateService.instant(`${t}.failed.title`),c.errorMessage)}),l.length>0&&this.notificationsService.success(this.translateService.instant(`${t}.saved.title`),this.translateService.instant(`${t}.saved.content`))}}discard(){const t=this.notificationsService.info(this.getNotificationTitle("discarded"),this.getNotificationContent("discarded"),{timeOut:this.discardTimeOut});this.objectUpdatesService.discardAllFieldUpdates(this.url,t)}reinstate(){this.bundles$.pipe((0,z.q)(1)).subscribe(t=>{t.forEach(n=>{this.objectUpdatesService.reinstateFieldUpdates(n.self)})})}isReinstatable(){return this.bundles$.pipe((0,B.w)(t=>(0,he.$)(...t.map(n=>this.objectUpdatesService.isReinstatable(n.self)))),(0,p.U)(t=>t.includes(!0)))}hasChanges(){return this.bundles$.pipe((0,B.w)(t=>(0,he.$)(...t.map(n=>this.objectUpdatesService.hasUpdates(n.self)))),(0,p.U)(t=>t.includes(!0)))}ngOnDestroy(){this.itemUpdateSubscription&&this.itemUpdateSubscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(Bt.J),e.\u0275\u0275directiveInject(nt.a),e.\u0275\u0275directiveInject(Ee.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(ze.b),e.\u0275\u0275directiveInject(e.NgZone))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-bitstreams"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","item-bitstreams",4,"ngVar"],[1,"item-bitstreams"],[1,"button-row","top","d-flex","mt-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-upload"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","container table-bordered mt-4",4,"ngIf"],["class","alert alert-info w-100 d-inline-block mt-4","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],[1,"button-row","bottom"],[1,"mt-4","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"container","table-bordered","mt-4"],[1,"row","header-row","font-weight-bold"],[3,"bundle","item","columnSizes","dropObject",4,"ngFor","ngForOf"],[3,"bundle","item","columnSizes","dropObject"],["role","alert",1,"alert","alert-info","w-100","d-inline-block","mt-4"],[3,"message"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,vn,32,33,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,n.bundles$))},directives:[q.g,h.rH,_.O5,Ke,_.sg,sn,Oe.N],pipes:[_.Ov,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();var bn=o(31054),Xe=o(68675),Qe=o(14917),In=o(61107),at=o(87890),Cn=o(68154),xn=o(80686);const yn=["tabs"];function En(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"ds-collection-select",11),e.\u0275\u0275listener("confirm",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().removeMappings(r)})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCancel()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","browse")("dsoRD$",t.itemCollectionsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("confirmButton","item.edit.item-mapper.buttons.remove")("cancelButton","item.edit.item-mapper.cancel")("dangerConfirm",!0)}}function Sn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"ds-collection-select",17),e.\u0275\u0275listener("confirm",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).mapCollections(r)})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).onCancel()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n,r;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","map")("dsoRD$",t.mappedCollectionsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("sortOptions",null==(r=e.\u0275\u0275pipeBind1(3,8,t.searchOptions$))?null:r.sort)("confirmButton","item.edit.item-mapper.buttons.add")("cancelButton","item.edit.item-mapper.cancel")}}function On(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.item-mapper.no-search")," "))}function Mn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13)(2,"ds-search-form",14),e.\u0275\u0275listener("submitSearch",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().performedSearch=!0}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(5,Sn,4,10,"div",15),e.\u0275\u0275template(6,On,3,3,"div",16)}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(2),e.\u0275\u0275property("query",null==(n=e.\u0275\u0275pipeBind1(3,6,t.searchOptions$))?null:n.query)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",e.\u0275\u0275pipeBind1(4,8,"item.edit.item-mapper.search-form.placeholder")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.performedSearch),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.performedSearch)}}const Pn=function(i){return{name:i}};let rt=(()=>{class i{constructor(t,n,r,l,c,f,M,N,J){this.route=t,this.router=n,this.searchConfigService=r,this.searchService=l,this.notificationsService=c,this.itemDataService=f,this.collectionDataService=M,this.translateService=N,this.dsoNameService=J,this.performedSearch=!1}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,z.q)(1),(0,p.U)(t=>t.dso)),this.itemName$=this.itemRD$.pipe((0,Y.h)(t=>(0,v.Uh)(t)),(0,p.U)(t=>this.dsoNameService.getName(t.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadCollectionLists()}loadCollectionLists(){console.log("loadCollectionLists"),this.shouldUpdate$=new G.X(!0),this.itemCollectionsRD$=(0,I.a)(this.itemRD$.pipe((0,m.Gp)()),this.shouldUpdate$).pipe((0,B.w)(([r,l])=>(!0===l&&this.shouldUpdate$.next(!1),this.collectionDataService.findAllByHref(this.itemDataService.getMappedCollectionsEndpoint(r.id),void 0,!l,!1).pipe((0,m.g1)()))));const t=this.itemRD$.pipe((0,m.Gp)(),(0,B.w)(r=>this.collectionDataService.findOwningCollectionFor(r)),(0,m.g1)()),n=(0,I.a)(this.itemCollectionsRD$,t,this.searchOptions$);this.mappedCollectionsRD$=n.pipe((0,B.w)(([r,l,c])=>this.searchService.search(Object.assign(new ke.t(c),{query:this.buildQuery([...r.payload.page,l.payload],c.query),dsoTypes:[Qe.h.COLLECTION]}),1e4).pipe((0,m.Ie)(),(0,Xe.O)(void 0))))}mapCollections(t){const r=(0,I.a)([this.itemRD$.pipe((0,m.xw)(),(0,p.U)(l=>l.payload),(0,p.U)(l=>l.id)),this.itemCollectionsRD$.pipe((0,m.xw)(),(0,p.U)(l=>l.payload.page),(0,p.U)(l=>l.map(c=>c.id)))]).pipe((0,B.w)(([l,c])=>(0,I.a)(this.filterIds(t,c).map(f=>this.itemDataService.mapToCollection(l,f).pipe((0,m.hC)())))));this.showNotifications(r,"item.edit.item-mapper.notifications.add")}removeMappings(t){const n=this.itemRD$.pipe((0,m.xw)(),(0,p.U)(r=>r.payload.id),(0,B.w)(r=>(0,I.a)(t.map(l=>this.itemDataService.removeMappingFromCollection(r,l).pipe((0,m.hC)())))));this.showNotifications(n,"item.edit.item-mapper.notifications.remove")}filterIds(t,n){return t.filter(r=>n.indexOf(r)<0)}showNotifications(t,n){t.subscribe(r=>{const l=r.filter(f=>f.hasSucceeded),c=r.filter(f=>f.hasFailed);l.length>0&&((0,I.a)([this.translateService.get(`${n}.success.head`),this.translateService.get(`${n}.success.content`,{amount:l.length})]).subscribe(([M,N])=>{this.notificationsService.success(M,N)}),this.shouldUpdate$.next(!0)),c.length>0&&(0,I.a)([this.translateService.get(`${n}.error.head`),this.translateService.get(`${n}.error.content`,{amount:c.length})]).subscribe(([M,N])=>{this.notificationsService.error(M,N)}),this.switchToFirstTab()})}tabChange(t){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(t,n){let r=n;for(const l of t)r=this.addExcludeCollection(l.id,r);return r}addExcludeCollection(t,n){const r=`-search.resourceid:${t}`;return(0,v.UE)(n)?`${n} AND ${r}`:r}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.itemRD$.pipe((0,m.xw)(),(0,m.xe)(),(0,z.q)(1)).subscribe(t=>{this.router.navigate([(0,x.Tt)(t)])})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(In.U),e.\u0275\u0275directiveInject(at.o),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(bn.W),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(He._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-collection-mapper"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(yn,5),2&t){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(n.tabs=r.first)}},decls:25,vars:24,consts:[[1,"container"],[1,"row"],[1,"col-12"],["id","item-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"destroyOnHide","navChange"],["tabs","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","confirm","cancel"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"query","currentUrl","inPlaceSearch","searchPlaceholder","submitSearch"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","sortOptions","confirmButton","cancelButton","confirm","cancel"],["role","alert",1,"alert","alert-info","w-100"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"p",3),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"p"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"ul",4,5),e.\u0275\u0275listener("navChange",function(l){return n.tabChange(l)}),e.\u0275\u0275elementStart(14,"li",6)(15,"a",7),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,En,3,8,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"li",6)(20,"a",7),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,Mn,7,10,"ng-template",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(24,"div",9),e.\u0275\u0275elementEnd()()()),2&t){const r=e.\u0275\u0275reference(13);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,9,"item.edit.item-mapper.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(7,11,"item.edit.item-mapper.item",e.\u0275\u0275pureFunction1(22,Pn,e.\u0275\u0275pipeBind1(8,14,n.itemName$))),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"item.edit.item-mapper.description")),e.\u0275\u0275advance(2),e.\u0275\u0275property("destroyOnHide",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavItem","browseTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,"item.edit.item-mapper.tabs.browse")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavItem","mapTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,20,"item.edit.item-mapper.tabs.map")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavOutlet",r)}},directives:[C.Pz,C.nv,C.Vx,C.uN,Cn.v,xn.o,_.O5,C.tO],pipes:[b.X$,_.Ov],styles:[""],data:{animation:[S.Ji,S.Ic]},changeDetection:0}),i})();var Tn=o(4310),Je=o(93075);function Bn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"item.edit.move.save-button")," "))}function Dn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",18),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"item.edit.move.processing")," "))}const Un=function(i){return{id:i}},Rn=function(){return{type:"collection"}},wn=function(i){return[i,"edit"]};let jn=(()=>{class i{constructor(t,n,r,l,c,f,M){this.route=t,this.router=n,this.notificationsService=r,this.itemDataService=l,this.searchService=c,this.translateService=f,this.requestService=M,this.selectorType=Qe.h.COLLECTION,this.inheritPolicies=!1,this.canSubmit=!1,this.processing=!1,this.COLLECTIONS=[Qe.h.COLLECTION]}ngOnInit(){this.itemRD$=this.route.data.pipe((0,p.U)(t=>t.dso),(0,m.xw)()),this.itemPageRoute$=this.itemRD$.pipe((0,m.mc)(),(0,p.U)(t=>(0,x.Tt)(t))),this.itemRD$.subscribe(t=>{this.item=t.payload}),this.itemRD$.pipe((0,m.xw)(),(0,m.xe)(),(0,B.w)(t=>t.owningCollection),(0,m.xw)(),(0,m.xe)()).subscribe(t=>{this.originalCollection=t})}selectDso(t){this.selectedCollection=t,this.selectedCollectionName=t.name,this.canSubmit=!0}getCurrentUrl(){return this.router.url}moveToCollection(){this.processing=!0;const t=this.itemDataService.moveToCollection(this.item.id,this.selectedCollection).pipe((0,m.hC)());t.subscribe(n=>{n.hasSucceeded?this.notificationsService.success(this.translateService.get("item.edit.move.success")):this.notificationsService.error(this.translateService.get("item.edit.move.error"))}),t.pipe((0,B.w)(()=>this.requestService.setStaleByHrefSubstring(this.item.id)),(0,B.w)(()=>this.itemDataService.findById(this.item.id,!1,!0,(0,H.l)("owningCollection"))),(0,m.hC)()).subscribe(()=>{this.processing=!1,this.router.navigate([(0,x.tn)(this.item)])})}discard(){this.selectedCollection=null,this.canSubmit=!1}get canMove(){var t;return this.canSubmit&&(null===(t=this.selectedCollection)||void 0===t?void 0:t.id)!==this.originalCollection.id}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(at.o),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(Ee.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-move"]],decls:43,vars:40,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"card","mb-3"],[1,"card-header"],[1,"card-body"],[3,"types","currentDSOId","onSelect"],["type","checkbox","name","tc","id","inheritPoliciesCheckbox",3,"ngModel","ngModelChange"],["for","inheritPoliciesCheckbox"],[1,"button-row","bottom"],[1,"float-right","space-children-mr"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"fas","fa-save"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"p"),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",1)(11,"div",2)(12,"div",3)(13,"div",4),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",5)(17,"ds-authorized-collection-selector",6),e.\u0275\u0275listener("onSelect",function(l){return n.selectDso(l)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(18,"div"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"div",1)(20,"div",2)(21,"p")(22,"input",7),e.\u0275\u0275listener("ngModelChange",function(l){return n.inheritPolicies=l}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"label",8),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(26,"p"),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(29,"div",9)(30,"div",10)(31,"button",11),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275element(33,"i",12),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"button",13),e.\u0275\u0275listener("click",function(){return n.moveToCollection()}),e.\u0275\u0275template(37,Bn,4,3,"span",14),e.\u0275\u0275template(38,Dn,4,3,"span",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"button",15),e.\u0275\u0275listener("click",function(){return n.discard()}),e.\u0275\u0275element(40,"i",16),e.\u0275\u0275text(41),e.\u0275\u0275pipe(42,"translate"),e.\u0275\u0275elementEnd()()()()()()),2&t){let r;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,15,"item.edit.move.head",e.\u0275\u0275pureFunction1(35,Un,null==(r=e.\u0275\u0275pipeBind1(6,18,n.itemRD$))||null==r.payload?null:r.payload.handle))),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,20,"item.edit.move.description")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(15,22,"dso-selector.placeholder",e.\u0275\u0275pureFunction0(37,Rn))),e.\u0275\u0275advance(3),e.\u0275\u0275property("types",n.COLLECTIONS)("currentDSOId",n.selectedCollection?n.selectedCollection.id:n.originalCollection.id),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngModel",n.inheritPolicies),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(25,25,"item.edit.move.inheritpolicies.checkbox")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,27,"item.edit.move.inheritpolicies.description")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(38,wn,e.\u0275\u0275pipeBind1(32,29,n.itemPageRoute$))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(35,31,"item.edit.move.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!n.canMove),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.processing),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.processing),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!n.canSubmit),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(42,33,"item.edit.move.discard-button")," ")}},directives:[Tn.$,Je.Wl,Je.JJ,Je.On,h.rH,_.O5],pipes:[b.X$,_.Ov],encapsulation:2}),i})();var Fn=o(15952),ot=o(50270),$n=o(18505),An=(o(39137),o(19909),o(56804)),Vn=o(64740),Ln=o(23681);function zn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"div",15),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataField," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataValue.value," ")}}function kn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275listener("click",function(){const l=e.\u0275\u0275restoreView(t).ngVar,c=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext().setSelectedVirtualMetadataItem(c,!l)}),e.\u0275\u0275elementStart(1,"div",10)(2,"label"),e.\u0275\u0275element(3,"input",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",12),e.\u0275\u0275element(5,"ds-listable-object-component-loader",13),e.\u0275\u0275template(6,zn,5,2,"div",14),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("object",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.virtualMetadata.get(n.uuid))}}function Kn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,kn,7,3,"div",8),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.isSelectedVirtualMetadataItem(t)))}}let Wn=(()=>{class i{constructor(t){this.objectUpdatesService=t,this.close=new e.EventEmitter,this.save=new e.EventEmitter,this.virtualMetadata=new Map}get items(){return[this.leftItem,this.rightItem]}getVirtualMetadata(t){return Object.entries(t.metadata).map(([n,r])=>r.filter(l=>!n.startsWith("relation")&&l.authority&&l.authority.endsWith(this.relationshipId)).map(l=>({metadataField:n,metadataValue:l}))).reduce((n,r)=>n.concat(r),[])}setSelectedVirtualMetadataItem(t,n){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.relationshipId,t.uuid,n)}isSelectedVirtualMetadataItem(t){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationshipId,t.uuid)}trackItem(t,n){return n&&n.uuid}ngOnInit(){this.items.forEach(t=>{this.virtualMetadata.set(t.uuid,this.getVirtualMetadata(t))})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(X.d))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-virtual-metadata"]],inputs:{url:"url",relationshipId:"relationshipId",leftItem:"leftItem",rightItem:"rightItem"},outputs:{close:"close",save:"save"},decls:14,vars:8,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","flex-row-reverse","m-2"],[1,"btn","btn-primary","save",3,"click"],[1,"fas","fa-save"],["class","item d-flex flex-row",3,"click",4,"ngVar"],[1,"item","d-flex","flex-row",3,"click"],[1,"m-2"],["type","checkbox",1,"select",3,"checked"],[1,"flex-column"],[3,"object"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",1),e.\u0275\u0275listener("click",function(){return n.close.emit()}),e.\u0275\u0275elementStart(5,"span",2),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",3),e.\u0275\u0275template(8,Kn,3,3,"ng-container",4),e.\u0275\u0275elementStart(9,"div",5)(10,"button",6),e.\u0275\u0275listener("click",function(){return n.save.emit()}),e.\u0275\u0275element(11,"i",7),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd()()()()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,4,"virtual-metadata.delete-relationship.modal-head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.items)("ngForTrackBy",n.trackItem),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(13,6,"item.edit.metadata.save-button")," "))},directives:[_.sg,q.g,fe.p],pipes:[b.X$,_.Ov],encapsulation:2}),i})();function Nn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",2)(1,"div",3),e.\u0275\u0275element(2,"ds-listable-object-component-loader",4),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5)(5,"div",6)(6,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(),l=e.\u0275\u0275reference(3);return r.openVirtualMetadataModal(l)}),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275element(8,"i",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",9),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().undo()}),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275element(11,"i",10),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("object",e.\u0275\u0275pipeBind1(3,7,t.relatedItem$))("viewMode",t.viewMode)("value",t.nameVariant),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(7,9,"item.edit.metadata.edit.buttons.remove")),e.\u0275\u0275property("disabled",!t.canRemove()),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(10,11,"item.edit.metadata.edit.buttons.undo")),e.\u0275\u0275property("disabled",!t.canUndo())}}function Gn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-virtual-metadata",11),e.\u0275\u0275listener("close",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().closeVirtualMetadataModal()})("save",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().remove()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("relationshipId",t.relationship.id)("leftItem",e.\u0275\u0275pipeBind1(1,4,t.leftItem$))("rightItem",e.\u0275\u0275pipeBind1(2,6,t.rightItem$))("url",t.url)}}let Hn=(()=>{class i{constructor(t,n){this.objectUpdatesService=t,this.modalService=n,this.viewMode=xe.w.ListElement}get relationship(){return this.update.relationship}get update(){return this.fieldUpdate.field}get nameVariant(){return this.update.nameVariant}ngOnChanges(){this.relationship&&(this.relationship.leftItem||this.relationship.rightItem)?(this.leftItem$=this.relationship.leftItem.pipe((0,m.xw)(),(0,m.xe)(),(0,Y.h)(t=>(0,v.Uh)(t)&&(0,v.UE)(t.uuid))),this.rightItem$=this.relationship.rightItem.pipe((0,m.xw)(),(0,m.xe)(),(0,Y.h)(t=>(0,v.Uh)(t)&&(0,v.UE)(t.uuid))),this.relatedItem$=(0,I.a)(this.leftItem$,this.rightItem$).pipe((0,p.U)(t=>t.find(n=>n.uuid!==this.editItem.uuid)))):this.relatedItem$=(0,y.of)(this.update.relatedItem)}remove(){this.closeVirtualMetadataModal(),(0,I.a)(this.leftItem$,this.rightItem$).pipe((0,p.U)(t=>t.map(n=>this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationship.id,n.uuid))),(0,B.w)(t=>(0,I.a)(t)),(0,p.U)(t=>Object.assign({},this.fieldUpdate.field,{keepLeftVirtualMetadata:!0===t[0],keepRightVirtualMetadata:!0===t[1]})),(0,z.q)(1)).subscribe(t=>this.objectUpdatesService.saveRemoveFieldUpdate(this.url,t))}openVirtualMetadataModal(t){this.modalRef=this.modalService.open(t)}closeVirtualMetadataModal(){this.modalRef.close()}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.fieldUpdate.field.uuid)}canRemove(){return this.fieldUpdate.changeType!==se.m.REMOVE&&this.fieldUpdate.changeType!==se.m.ADD}canUndo(){return this.fieldUpdate.changeType>=0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(C.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-relationship"]],inputs:{fieldUpdate:"fieldUpdate",url:"url",editItem:"editItem"},features:[e.\u0275\u0275NgOnChangesFeature],decls:4,vars:3,consts:[["class","row",4,"ngIf"],["virtualMetadataModal",""],[1,"row"],[1,"col-10","relationship"],[3,"object","viewMode","value"],[1,"col-2"],[1,"btn-group","relationship-action-buttons"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[3,"relationshipId","leftItem","rightItem","url","close","save"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Nn,12,13,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,Gn,3,8,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.relatedItem$))},directives:[_.O5,fe.p,Wn],pipes:[_.Ov,b.X$],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.relationship-action-buttons[_ngcontent-%COMP%]{margin:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}"]}),i})();const Xn=function(){return{}},Qn=function(i,s,t){return{"alert-success":i,"alert-warning":s,"alert-danger":t}};function Jn(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-edit-relationship",8),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(4);e.\u0275\u0275property("fieldUpdate",t||e.\u0275\u0275pureFunction0(4,Xn))("url",n.url)("editItem",n.item)("ngClass",e.\u0275\u0275pureFunction3(5,Qn,1===t.changeType,0===t.changeType,2===t.changeType))}}function Zn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"item.edit.relationships.no-relationships")))}function Yn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"ds-pagination",5),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementStart(5,"div",6),e.\u0275\u0275template(6,Jn,1,9,"ds-edit-relationship",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,Zn,3,3,"div",4),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext(3);let r,l;e.\u0275\u0275advance(1),e.\u0275\u0275property("paginationOptions",n.paginationConfig)("pageInfoState",null==(r=e.\u0275\u0275pipeBind1(2,8,n.relationshipsRd$))||null==r.payload?null:r.payload.pageInfo)("collectionSize",(null==(l=e.\u0275\u0275pipeBind1(3,10,n.relationshipsRd$))||null==l.payload?null:l.payload.totalElements)+e.\u0275\u0275pipeBind1(4,12,n.nbAddedFields$))("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t)("ngForTrackBy",n.trackUpdate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===t.length)}}function qn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Yn,8,14,"ng-container",3),e.\u0275\u0275pipe(2,"dsObjectValues"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t))}}function ei(i,s){1&i&&e.\u0275\u0275element(0,"ds-loading")}function ti(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,qn,3,3,"ng-container",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,ei,1,0,"ds-loading",4),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t&&!e.\u0275\u0275pipeBind1(2,2,n.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,4,n.loading$))}}let ni=(()=>{class i{constructor(t,n,r,l,c,f,M){this.objectUpdatesService=t,this.linkService=n,this.relationshipService=r,this.relationshipTypeService=l,this.modalService=c,this.paginationService=f,this.selectableListService=M,this.submit=new e.EventEmitter,this.updates$=new G.X(void 0),this.relationshipsRd$=new G.X(void 0),this.isLastPage$=new G.X(!0),this.loading$=new G.X(!0),this.nbAddedFields$=new G.X(0),this.subs=[]}getRelationshipMessageKey(){return(0,I.a)(this.getLabel(),this.relatedEntityType$).pipe((0,p.U)(([t,n])=>{if((0,v.Uh)(t)&&t.indexOf("is")>-1&&t.indexOf("Of")>-1){const r=`${t.substring(2,t.indexOf("Of"))}`;return r!==n.label?`relationships.is${r}Of.${n.label}`:`relationships.is${r}Of`}return t}))}getLabel(){return(0,I.a)([this.relationshipType.leftType,this.relationshipType.rightType].map(t=>t.pipe((0,m.xw)(),(0,m.xe)()))).pipe((0,p.U)(t=>[this.relationshipType.leftwardType,this.relationshipType.rightwardType][t.findIndex(n=>n.id===this.itemType.id)]))}trackUpdate(t,n){return n&&n.field?n.field.uuid:void 0}openLookup(){this.modalRef=this.modalService.open(An.i,{size:"lg"});const t=this.modalRef.componentInstance;t.repeatable=!0,t.isEditRelationship=!0,t.listId=this.listId,t.item=this.item,t.relationshipType=this.relationshipType,t.currentItemIsLeftItem$=this.currentItemIsLeftItem$,t.toAdd=[],t.toRemove=[],t.isPending=!1,this.item.owningCollection.pipe((0,m.Gp)()).subscribe(n=>{t.collection=n}),t.select=(...n)=>{n.forEach(r=>{const l=r.indexableObject,c=t.toRemove.findIndex(f=>f.uuid===l.uuid);-1!==c?t.toRemove.splice(c,1):this.getRelationFromId(l).subscribe(f=>{if(f){const M=t.toRemove.findIndex(N=>N.indexableObject.uuid===l.uuid);-1!==M&&t.toRemove.splice(M,1)}else t.toAdd.push(r);this.loading$.next(!0),this.relationshipsRd$.next(this.relationshipsRd$.getValue())})})},t.deselect=(...n)=>{n.forEach(r=>{const l=r.indexableObject,c=t.toAdd.findIndex(f=>f.indexableObject.uuid===l.uuid);-1!==c?t.toAdd.splice(c,1):t.toRemove.push(r)})},t.submitEv=()=>{const n=[];t.toAdd.forEach(r=>{const l=r.indexableObject;n.push(this.relationshipService.getNameVariant(this.listId,l.uuid).pipe((0,p.U)(c=>{const f={uuid:this.relationshipType.id+"-"+r.indexableObject.uuid,nameVariant:c,type:this.relationshipType,relatedItem:l};return this.objectUpdatesService.saveAddFieldUpdate(this.url,f),f})))}),t.toRemove.forEach(r=>{n.push(this.relationshipService.getNameVariant(this.listId,r.indexableObjectuuid).pipe((0,B.w)(l=>this.getRelationFromId(r.indexableObject).pipe((0,p.U)(c=>{const f={uuid:c.id,nameVariant:l,type:this.relationshipType,relationship:c};return this.objectUpdatesService.saveRemoveFieldUpdate(this.url,f),f})))))}),(0,I.a)(n).subscribe(r=>{setTimeout(()=>{this.submit.emit()},1e3),t.isPending=!0})},t.discardEv=()=>{t.toAdd.forEach(n=>{this.selectableListService.deselectSingle(this.listId,n)}),t.toRemove.forEach(n=>{this.selectableListService.selectSingle(this.listId,n)}),t.toAdd=[],t.toRemove=[]},this.relatedEntityType$.pipe((0,z.q)(1)).subscribe(n=>{t.relationshipOptions=Object.assign(new Vn.u,{relationshipType:n.label,searchConfiguration:n.label.toLowerCase(),nameVariants:"true"})}),this.selectableListService.deselectAll(this.listId)}getRelationFromId(t){return this.currentItemIsLeftItem$.pipe((0,z.q)(1),(0,B.w)(n=>{let r;return r=n?this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,this.relationshipType.leftwardType,[t.id]).pipe((0,m.xw)(),(0,m.xe)()):this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,this.relationshipType.rightwardType,[t.id]).pipe((0,m.xw)(),(0,m.xe)()),r.pipe((0,p.U)(l=>l.page[0]))}))}getFieldUpdatesForRelatedItem(t){return this.updates$.pipe((0,z.q)(1),(0,p.U)(n=>Object.values(n).map(r=>r.field).filter(r=>r.relationship)),(0,be.z)(n=>(0,I.a)(n.map(r=>this.getRelatedItem(r.relationship))).pipe((0,me.d)([]),(0,p.U)(r=>n.filter((l,c)=>r[c].uuid===t.uuid)))))}getIsRelatedItem(t){return this.currentItemIsLeftItem$.pipe((0,z.q)(1),(0,p.U)(n=>n?!!this.item.allMetadataValues("relation."+this.relationshipType.leftwardType).find(l=>l===t.uuid):!!this.item.allMetadataValues("relation."+this.relationshipType.rightwardType).find(l=>l===t.uuid)))}getRelatedItem(t){return this.relationshipService.isLeftItem(t,this.item).pipe((0,B.w)(n=>n?t.rightItem:t.leftItem),(0,m.xw)(),(0,m.xe)())}ngOnInit(){this.relationshipLeftAndRightType$=(0,I.a)([this.relationshipType.leftType,this.relationshipType.rightType].map(n=>n.pipe((0,m.xw)(),(0,m.xe)()))),this.relatedEntityType$=this.relationshipLeftAndRightType$.pipe((0,p.U)(n=>n.find(r=>r.uuid!==this.itemType.uuid)),(0,v.tz)()),this.relatedEntityType$.pipe((0,z.q)(1)).subscribe(n=>this.listId=`edit-relationship-${this.itemType.id}-${n.id}`),this.currentItemIsLeftItem$=this.relationshipLeftAndRightType$.pipe((0,p.U)(([n,r])=>n.id===this.itemType.id||r.id!==this.itemType.id&&void console.warn(`The item ${this.item.uuid} is not on the right or the left side of relationship type ${this.relationshipType.uuid}`))),this.paginationConfig=new it.r,this.paginationConfig.id=`er${this.relationshipType.id}`,this.paginationConfig.pageSize=5,this.paginationConfig.currentPage=1;const t=this.paginationService.getCurrentPagination(this.paginationConfig.id,this.paginationConfig).pipe((0,$n.b)(()=>this.loading$.next(!0)));this.subs.push((0,I.a)([t,this.currentItemIsLeftItem$]).pipe((0,B.w)(([n,r])=>this.relationshipService.getItemRelationshipsByLabel(this.item,r?this.relationshipType.leftwardType:this.relationshipType.rightwardType,{elementsPerPage:n.pageSize,currentPage:n.currentPage},!1,!0,(0,H.l)("leftItem"),(0,H.l)("rightItem")))).subscribe(n=>{this.relationshipsRd$.next(n)})),this.subs.push(this.relationshipsRd$.pipe((0,v.tz)(),(0,m.g1)()).subscribe(n=>{this.isLastPage$.next((0,v.xI)(n.payload._links.next))})),this.subs.push(this.relationshipsRd$.pipe((0,v.tz)(),(0,m.g1)(),(0,B.w)(n=>(0,et.D)(n.payload.page).pipe((0,be.z)(r=>this.relationshipService.isLeftItem(r,this.item).pipe((0,p.U)(l=>[r,l]))),(0,p.U)(([r,l])=>({uuid:r.id,type:this.relationshipType,relationship:r,nameVariant:l?r.rightwardValue:r.leftwardValue})),(0,qe.q)(),(0,me.d)([]))),(0,B.w)(n=>this.objectUpdatesService.getFieldUpdates(this.url,n).pipe((0,p.U)(r=>{const l={};return this.nbAddedFields$.next(0),Object.keys(r).forEach(c=>{(0,v.Uh)(r[c])&&r[c].field.type.id===this.relationshipType.id&&(r[c].changeType===se.m.ADD?(this.nbAddedFields$.next(this.nbAddedFields$.getValue()+1),!0===this.isLastPage$.getValue()&&(l[c]=r[c])):l[c]=r[c])}),l}))),(0,Xe.O)({})).subscribe(n=>{this.loading$.next(!1),this.updates$.next(n)}))}ngOnDestroy(){this.subs.filter(t=>(0,v.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(ve.M),e.\u0275\u0275directiveInject(ge.U),e.\u0275\u0275directiveInject(ot.k),e.\u0275\u0275directiveInject(C.FF),e.\u0275\u0275directiveInject(Ne.N),e.\u0275\u0275directiveInject(Ln.w))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-relationship-list"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges"},outputs:{submit:"submit"},decls:12,vars:14,consts:[[1,"ml-2","btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[4,"ngVar"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"my-2"],["class","relationship-row d-block alert",3,"fieldUpdate","url","editItem","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"relationship-row","d-block","alert",3,"fieldUpdate","url","editItem","ngClass"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"h5"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementStart(4,"button",0),e.\u0275\u0275listener("click",function(){return n.openLookup()}),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275element(6,"i",1),e.\u0275\u0275elementStart(7,"span",2),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(10,ti,5,6,"ng-container",3),e.\u0275\u0275pipe(11,"async")),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,4,e.\u0275\u0275pipeBind1(3,6,n.getRelationshipMessageKey()))," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(5,8,n.hasChanges)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(9,10,"item.edit.relationships.edit.buttons.add"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(11,12,n.updates$)))},directives:[q.g,_.O5,We.Q,_.sg,Hn,_.mk,Oe.N],pipes:[b.X$,_.Ov,Se.g],styles:[".relationship-row[_ngcontent-%COMP%]:not(.alert){padding:var(--bs-alert-padding-y) 0}.relationship-row.alert[_ngcontent-%COMP%]{margin-left:calc(-1 * var(--bs-alert-padding-x));margin-right:calc(-1 * var(--bs-alert-padding-x));margin-top:-1px;margin-bottom:-1px}"]}),i})();function ii(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function ai(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).reinstate()}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function ri(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",19)(1,"ds-edit-relationship-list",20),e.\u0275\u0275listener("submit",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(5).submit()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("url",n.url)("item",n.item)("itemType",e.\u0275\u0275pipeBind1(2,5,n.entityType$))("relationshipType",t)("hasChanges",n.hasChanges())}}function oi(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ri,3,7,"div",18),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}function si(i,s){1&i&&e.\u0275\u0275element(0,"ds-loading")}function li(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,oi,2,1,"ng-container",2),e.\u0275\u0275template(2,si,1,0,"ds-loading",2),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}function di(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",21),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function ci(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).reinstate()}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function pi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",4),e.\u0275\u0275template(2,ii,6,6,"button",5),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,ai,5,3,"button",6),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementStart(6,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).submit()}),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275element(8,"i",8),e.\u0275\u0275elementStart(9,"span",9),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(12,li,3,2,"ng-container",1),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"div",10)(15,"div",11),e.\u0275\u0275template(16,di,6,6,"button",12),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275template(18,ci,5,3,"button",13),e.\u0275\u0275pipe(19,"async"),e.\u0275\u0275elementStart(20,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).submit()}),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275element(22,"i",8),e.\u0275\u0275elementStart(23,"span",9),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(3,9,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,11,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(7,13,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(11,15,"item.edit.metadata.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(13,17,t.relationshipTypes$)),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(17,19,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(19,21,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(21,23,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(25,25,"item.edit.metadata.save-button"),"")}}function mi(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.relationships.no-entity-type")," "))}function ui(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,pi,26,27,"ng-container",2),e.\u0275\u0275template(2,mi,3,3,"div",3),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}let hi=(()=>{class i extends tt.a{constructor(t,n,r,l,c,f,M,N,J,re,ce,Ze,Ai){super(t,n,r,l,c,f),this.itemService=t,this.objectUpdatesService=n,this.router=r,this.notificationsService=l,this.translateService=c,this.route=f,this.relationshipService=M,this.objectCache=N,this.requestService=J,this.entityTypeService=re,this.relationshipTypeService=ce,this.cdr=Ze,this.modalService=Ai}initializeUpdates(){const t=this.item.firstMetadataValue("dspace.entity.type");void 0!==t?(this.relationshipTypes$=this.relationshipTypeService.searchByEntityType(t,!0,!0,...this.getRelationshipTypeFollowLinks()).pipe((0,p.U)(n=>n.page)),this.entityType$=this.entityTypeService.getEntityTypeByLabel(t).pipe((0,m.xw)(),(0,m.xe)())):this.entityType$=(0,y.of)(void 0)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.relationships.notifications."}submit(){const t=this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,Xe.O)([]),(0,p.U)(r=>r.map(l=>Object.assign(new Fn.W,l,{uuid:l.id}))),(0,B.w)(r=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,r)),(0,p.U)(r=>Object.values(r).filter(l=>l.changeType===se.m.REMOVE).map(l=>l.field))),n=this.objectUpdatesService.getFieldUpdates(this.url,[]).pipe((0,p.U)(r=>Object.values(r).filter(l=>(0,v.Uh)(l)).filter(l=>l.changeType===se.m.ADD).map(l=>l.field)));(0,I.a)(t,n).pipe((0,z.q)(1)).subscribe(([r,l])=>{[this.deleteRelationships(r),this.addRelationships(l)].forEach(f=>f.subscribe(M=>{M.length>0&&(this.initializeOriginalFields(),this.cdr.detectChanges(),this.displayNotifications(M),this.modalService.dismissAll())}))})}deleteRelationships(t){return(0,he.$)(...t.map(n=>{let r;return r=n.keepLeftVirtualMetadata&&n.keepRightVirtualMetadata?"all":n.keepLeftVirtualMetadata?"left":n.keepRightVirtualMetadata?"right":"none",this.relationshipService.deleteRelationship(n.uuid,r)}))}addRelationships(t){return(0,he.$)(...t.map(n=>this.entityType$.pipe((0,B.w)(r=>this.entityTypeService.isLeftType(n.type,r)),(0,B.w)(r=>{let l,c,f,M;return r?(l=this.item,c=n.relatedItem,f=null,M=n.nameVariant):(l=n.relatedItem,c=this.item,f=n.nameVariant,M=null),this.relationshipService.addRelationship(n.type.id,l,c,f,M)}))))}displayNotifications(t){const n=t.filter(l=>l.hasFailed),r=t.filter(l=>l.hasSucceeded);n.forEach(l=>{this.notificationsService.error(this.getNotificationTitle("failed"),l.errorMessage)}),r.length>0&&this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved"))}initializeOriginalFields(){return this.relationshipService.getRelatedItems(this.item).pipe((0,z.q)(1)).subscribe(t=>{this.objectUpdatesService.initialize(this.url,t,this.item.lastModified)})}getRelationshipTypeFollowLinks(){return[(0,H.l)("leftType"),(0,H.l)("rightType")]}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(T.S),e.\u0275\u0275directiveInject(X.d),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(j.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(ge.U),e.\u0275\u0275directiveInject(nt.a),e.\u0275\u0275directiveInject(Ee.s),e.\u0275\u0275directiveInject(ye.v),e.\u0275\u0275directiveInject(ot.k),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(C.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-relationships"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:3,consts:[[1,"item-relationships"],[4,"ngVar"],[4,"ngIf"],["class","alert alert-info mt-2","role","alert",4,"ngIf"],[1,"button-row","top","d-flex","space-children-mr"],["class","btn btn-danger ml-auto",3,"disabled","click",4,"ngIf"],["class","btn btn-warning ml-auto",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],[1,"button-row","bottom"],[1,"float-right","space-children-mr","ml-gap"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-danger","ml-auto",3,"disabled","click"],[1,"fas","fa-times"],[1,"btn","btn-warning","ml-auto",3,"click"],[1,"fas","fa-undo-alt"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[3,"url","item","itemType","relationshipType","hasChanges","submit"],[1,"btn","btn-danger",3,"disabled","click"],[1,"btn","btn-warning",3,"click"],["role","alert",1,"alert","alert-info","mt-2"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,ui,3,2,"ng-container",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.entityType$)))},directives:[q.g,_.O5,_.sg,ni,Oe.N],pipes:[_.Ov,b.X$],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]}),i})();var st=o(84186),_i=o(60300),gi=o(95857);function vi(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-item-versions",3),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275property("item",t)("displayWhenEmpty",!0)("displayTitle",!1)("displayActions",!0)}}function fi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,vi,1,4,"ds-item-versions",2),e.\u0275\u0275elementEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}let bi=(()=>{class i{constructor(t){this.route=t,this.AlertTypeEnum=_i.N}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,p.U)(t=>t.dso)).pipe((0,m.xw)())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-version-history"]],decls:2,vars:3,consts:[["class","mt-2",4,"ngVar"],[1,"mt-2"],[3,"item","displayWhenEmpty","displayTitle","displayActions",4,"ngIf"],[3,"item","displayWhenEmpty","displayTitle","displayActions"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,fi,2,1,"div",0),e.\u0275\u0275pipe(1,"async")),2&t){let r;e.\u0275\u0275property("ngVar",null==(r=e.\u0275\u0275pipeBind1(1,1,n.itemRD$))?null:r.payload)}},directives:[q.g,_.O5,gi.h],pipes:[_.Ov],encapsulation:2}),i})();var lt=o(70262),dt=o(18433),Ii=o(84561),Ci=o(32369),xi=o(42616);function yi(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-resource-policies",5),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bitstream")("resourceUUID",t.id)("resourceName",t.name)}}function Ei(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2).$implicit;return e.\u0275\u0275nextContext().onBitstreamsLoad(r)}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"collection.edit.item.authorizations.load-more-button")))}function Si(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",7)(2,"div",8)(3,"button",9),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext().collapseArea(r.id)}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",10),e.\u0275\u0275template(7,yi,2,3,"ng-container",3),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Ei,4,3,"div",4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!1)("aria-controls",t.id),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,8,"collection.edit.item.authorizations.show-bitstreams-button")," ",t.name," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("id",t.id)("ngbCollapse",n.bundleBitstreamsMap.get(t.id).isCollapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(8,10,n.bundleBitstreamsMap.get(t.id).bitstreams)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.bundleBitstreamsMap.get(t.id).allBitstreamsLoaded)}}function Oi(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-resource-policies",5),e.\u0275\u0275template(2,Si,10,12,"ng-container",6),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext();let r;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bundle")("resourceUUID",t.id)("resourceName",t.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(3,4,null==(r=n.bundleBitstreamsMap.get(t.id))?null:r.bitstreams))?null:r.length)>0)}}function Mi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onBundleLoad()}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"collection.edit.item.authorizations.load-bundle-button")))}let Pi=(()=>{class i{constructor(t,n,r){this.linkService=t,this.route=n,this.nameService=r,this.bundleBitstreamsMap=new Map,this.bundles$=new G.X([]),this.subs=[],this.bundlesPerPage=6,this.bundlesPageSize=1,this.allBundlesLoaded=!1,this.bitstreamSize=4,this.bitstreamPageSize=4}ngOnInit(){this.getBundlesPerItem()}getItemUUID(){return this.item$.pipe((0,p.U)(t=>t.id),(0,w.P)(t=>(0,v.UE)(t)))}getItemName(){return this.item$.pipe((0,p.U)(t=>this.nameService.getName(t)))}getItemBundles(){return this.bundles$.asObservable()}getBundlesPerItem(t=1){this.item$=this.route.data.pipe((0,p.U)(r=>r.dso),(0,m.A6)(),(0,p.U)(r=>this.linkService.resolveLink(r,(0,H.l)("bundles",{findListOptions:{currentPage:t,elementsPerPage:this.bundlesPerPage}},(0,H.l)("bitstreams")))));const n=this.item$.pipe((0,Y.h)(r=>(0,v.UE)(r.bundles)),(0,be.z)(r=>r.bundles),(0,m.A6)(),(0,lt.K)(r=>(console.error(r),(0,y.of)((0,dt.b)(null,[])))));this.subs.push(n.pipe((0,z.q)(1),(0,p.U)(r=>r.page)).subscribe(r=>{((0,Ge.isEqual)(r.length,0)||r.length<this.bundlesPerPage)&&(this.allBundlesLoaded=!0),(0,Ge.isEqual)(t,1)?this.bundles$.next(r):this.bundles$.next(this.bundles$.getValue().concat(r))}),n.pipe((0,z.q)(1),(0,be.z)(r=>r.page),(0,p.U)(r=>({id:r.id,bitstreams:this.getBundleBitstreams(r)}))).subscribe(r=>{let l={isCollapsed:!0,allBitstreamsLoaded:!1,bitstreams:null};l.bitstreams=r.bitstreams.pipe((0,p.U)(c=>(l.allBitstreamsLoaded=(null==c?void 0:c.page.length)<this.bitstreamSize,[...c.page.slice(0,this.bitstreamSize)]))),this.bundleBitstreamsMap.set(r.id,l)}))}getBundleBitstreams(t){return t.bitstreams.pipe((0,m.Gp)(),(0,lt.K)(n=>(console.error(n),(0,y.of)((0,dt.b)(null,[])))))}collapseArea(t){this.bundleBitstreamsMap.get(t).isCollapsed=!this.bundleBitstreamsMap.get(t).isCollapsed}onBundleLoad(){this.bundlesPageSize++,this.getBundlesPerItem(this.bundlesPageSize)}onBitstreamsLoad(t){return this.getBundleBitstreams(t).subscribe(n=>{let r=null==n?void 0:n.page.slice(this.bitstreamPageSize,this.bitstreamPageSize+this.bitstreamSize),l=this.bundleBitstreamsMap.get(t.id).bitstreams.pipe((0,p.U)(f=>[...f,...r]));this.bitstreamPageSize=this.bitstreamPageSize+this.bitstreamSize;let c={bitstreams:l,isCollapsed:this.bundleBitstreamsMap.get(t.id).isCollapsed,allBitstreamsLoaded:(null==n?void 0:n.page.length)<=this.bitstreamPageSize};this.bundleBitstreamsMap.set(t.id,c)})}ngOnDestroy(){this.subs.filter(t=>(0,v.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ve.M),e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(He._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-authorizations"]],decls:8,vars:13,consts:[[1,"container"],[3,"type","content"],[3,"resourceType","resourceName","resourceUUID"],[4,"ngFor","ngForTrackById","ngForOf"],["class","row justify-content-center",4,"ngIf"],[3,"resourceType","resourceUUID","resourceName"],[4,"ngIf"],[1,"card","auth-bitstream-container"],[1,"card-header"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card-body",3,"id","ngbCollapse"],[1,"row","justify-content-center"],["type","button",1,"btn","btn-link",3,"click"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"ds-alert",1)(2,"ds-resource-policies",2),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,Oi,4,6,"ng-container",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275template(7,Mi,4,3,"div",4),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info")("content","item.edit.authorizations.heading"),e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","item")("resourceName",e.\u0275\u0275pipeBind1(3,7,n.getItemName()))("resourceUUID",e.\u0275\u0275pipeBind1(4,9,n.getItemUUID())),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(6,11,n.bundles$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.allBundlesLoaded))},directives:[Ii.w,Ci.F,_.sg,xi.$,_.O5,C._D],pipes:[_.Ov,b.X$],styles:[".auth-bitstream-container[_ngcontent-%COMP%]{margin-top:-1em;margin-bottom:1.5em}"]}),i})();var ct=o(16880),pt=o(41466),Ti=o(22349),Bi=o(85286),Di=o(55633),le=o(43772),de=o(25071),ie=o(12166),ae=o(36696);let mt=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.ReinstateItem)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ut=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.WithdrawItem)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ht=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.CanEditMetadata)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ui=o(61419),Ri=o(40767);let _t=(()=>{class i extends Ri.q{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureIDs(t,n){return(0,y.of)([V.i.CanManageMappings,V.i.WithdrawItem,V.i.ReinstateItem,V.i.CanManagePolicies,V.i.CanMakePrivate,V.i.CanDelete,V.i.CanMove])}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),gt=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.CanManageBitstreamBundles)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),vt=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.CanManageRelationships)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ft=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.CanManageVersions)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),bt=(()=>{class i extends de.h{constructor(t,n,r,l){super(t,n,r,l),this.resolver=t,this.authorizationService=n,this.router=r,this.authService=l}getFeatureID(t,n){return(0,y.of)(V.i.CanManageMappings)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(ie.o),e.\u0275\u0275inject(ne._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),wi=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[st.t,Di.d,pt.b,ct.a,mt,ut,Ui.F,ht,_t,gt,vt,ft,bt],imports:[[h.Bz.forChild([{path:"",resolve:{breadcrumb:st.t},data:{breadcrumbKey:"item.edit"},children:[{path:"",component:L,children:[{path:"",redirectTo:"status",pathMatch:"full"},{path:"status",component:Pt,data:{title:"item.edit.tabs.status.title",showBreadcrumbs:!0},canActivate:[_t]},{path:"bitstreams",component:fn,data:{title:"item.edit.tabs.bitstreams.title",showBreadcrumbs:!0},canActivate:[gt]},{path:"metadata",component:Tt.O,data:{title:"item.edit.tabs.metadata.title",showBreadcrumbs:!0},canActivate:[ht]},{path:"relationships",component:hi,data:{title:"item.edit.tabs.relationships.title",showBreadcrumbs:!0},canActivate:[vt]},{path:"versionhistory",component:bi,data:{title:"item.edit.tabs.versionhistory.title",showBreadcrumbs:!0},canActivate:[ft]},{path:"mapper",component:rt,data:{title:"item.edit.tabs.item-mapper.title",showBreadcrumbs:!0},canActivate:[bt]}]},{path:"mapper",component:rt},{path:le.M0,component:Pe,canActivate:[ut]},{path:le.Pu,component:De,canActivate:[mt]},{path:le.X$,component:we},{path:le.dI,component:$e},{path:le.kJ,component:It},{path:le.Gr,component:jn,data:{title:"item.edit.move.title"}},{path:le.N,children:[{path:"create",resolve:{resourcePolicyTarget:ct.a},component:Ti.v,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:pt.b},component:Bi.x,data:{title:"resource-policies.edit.page.title"}},{path:"",component:Pi,data:{title:"item.edit.authorizations.title"}}]}]}])]]}),i})();var ji=o(41514),Fi=o(64165);let $i=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[ze.b,Se.g],imports:[[_.ez,E.m,C.HK,wi,ji.q,Ce._t,Fi.q,C.IJ]]}),i})()},92165:(W,P,o)=>{"use strict";o.d(P,{O:()=>Le});var _=o(58187),C=o(62989),E=o(17489),h=o(50590),S=o(63900),y=o(46283),I=o(55489),p=o(20125),v=o(33881),x=o(38475),e=o(60300);class b{constructor($,d){this.op=$,this.field=d}}let R=(()=>{class u extends b{constructor(d,g){super(u.operationType,d),this.value=g}toOperation(){return{op:this.op,path:`/metadata/${this.field}/-`,value:this.value}}}return u.operationType="add",u})(),D=(()=>{class u extends b{constructor(d,g){super(u.operationType,d),this.place=g}toOperation(){return{op:this.op,path:`/metadata/${this.field}/${this.place}`}}}return u.operationType="remove",u})(),U=(()=>{class u extends b{constructor(d,g,O){super(u.operationType,d),this.place=g,this.value=O}toOperation(){return{op:this.op,path:`/metadata/${this.field}/${this.place}`,value:this.value}}}return u.operationType="replace",u})();var F=o(54818),a=o(5e3);let L=(()=>{class u{fieldUpdatesToPatchOperations(d){const g=this.fieldUpdatesToMetadataPatchOperations(d),O=new Map,k=[];return g.forEach(A=>{(A.op===D.operationType||A.op===U.operationType)&&(0,x.Uh)(A.place)&&O.has(A.field)&&O.get(A.field).forEach(ee=>{ee<A.place&&A.place--}),A.op===D.operationType&&(0,x.Uh)(A.place)&&(O.has(A.field)||O.set(A.field,[]),O.get(A.field).push(A.place)),k.push(A.toOperation())}),k}fieldUpdatesToMetadataPatchOperations(d){const g=[];return Object.keys(d).forEach(O=>{const k=d[O],A=k.field,ee={value:A.value,language:A.language};let ue;switch(k.changeType){case F.m.ADD:ue=new R(A.key,[ee]);break;case F.m.REMOVE:ue=new D(A.key,A.place);break;case F.m.UPDATE:ue=new U(A.key,A.place,ee)}g.push(ue)}),g}}return u.\u0275fac=function(d){return new(d||u)},u.\u0275prov=a.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();var j=o(74202),T=o(86956),m=o(69808),w=o(3820),K=o(61135),Q=o(39646),oe=o(54004),pe=o(18838),Z=o(94635),Me=o(52927),_e=o(93075),Pe=o(72246),Te=o(19986);const Be=["ds-edit-in-place-field",""];function De(u,$){if(1&u&&(a.\u0275\u0275elementStart(0,"div")(1,"span"),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()()),2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(null==d.metadata||null==d.metadata.key?null:d.metadata.key.split(".").join(".\u200b"))}}const Ue=function(){return{standalone:!0}};function Re(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",15)(1,"ds-validation-suggestions",16,17),a.\u0275\u0275listener("ngModelChange",function(O){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().metadata.key=O})("submitSuggestion",function(){a.\u0275\u0275restoreView(d);const O=a.\u0275\u0275reference(2);return a.\u0275\u0275nextContext().update(O)})("clickSuggestion",function(){a.\u0275\u0275restoreView(d);const O=a.\u0275\u0275reference(2);return a.\u0275\u0275nextContext().update(O)})("typeSuggestion",function(){a.\u0275\u0275restoreView(d);const O=a.\u0275\u0275reference(2);return a.\u0275\u0275nextContext().update(O)})("dsClickOutside",function(){a.\u0275\u0275restoreView(d);const O=a.\u0275\u0275reference(2);return a.\u0275\u0275nextContext().checkValidity(O)})("findSuggestions",function(O){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().findMetadataFieldSuggestions(O)}),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275pipe(4,"async"),a.\u0275\u0275elementEnd()()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("disable",1!=d.fieldUpdate.changeType)("suggestions",a.\u0275\u0275pipeBind1(3,7,d.metadataFieldSuggestions))("ngModel",d.metadata.key)("url",d.url)("metadata",d.metadata)("valid",!1!==a.\u0275\u0275pipeBind1(4,9,d.valid))("ngModelOptions",a.\u0275\u0275pureFunction0(11,Ue))}}function we(u,$){1&u&&(a.\u0275\u0275elementStart(0,"small",18),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementEnd()),2&u&&(a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(2,1,"item.edit.metadata.metadatafield.invalid")))}function je(u,$){if(1&u&&(a.\u0275\u0275elementStart(0,"div")(1,"span",19),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()()),2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(null==d.metadata?null:d.metadata.value)}}function Fe(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",15)(1,"textarea",20),a.\u0275\u0275listener("ngModelChange",function(O){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().metadata.value=O})("onDebounce",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().update()}),a.\u0275\u0275elementEnd()()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngModel",d.metadata.value)}}function $e(u,$){if(1&u&&(a.\u0275\u0275elementStart(0,"div")(1,"span"),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()()),2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(null==d.metadata?null:d.metadata.language)}}function B(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",15)(1,"input",21),a.\u0275\u0275listener("ngModelChange",function(O){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().metadata.language=O})("onDebounce",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().update()}),a.\u0275\u0275elementEnd()()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("ngModel",d.metadata.language)}}function z(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",22),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().setEditable(!0)}),a.\u0275\u0275pipe(1,"async"),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275element(3,"i",23),a.\u0275\u0275elementEnd()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275propertyInterpolate("title",a.\u0275\u0275pipeBind1(2,4,"item.edit.metadata.edit.buttons.edit")),a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(1,2,d.canSetEditable()))}}function me(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",24),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().setEditable(!1)}),a.\u0275\u0275pipe(1,"async"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275element(4,"i",25),a.\u0275\u0275elementEnd()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275propertyInterpolate("title",a.\u0275\u0275pipeBind1(3,6,"item.edit.metadata.edit.buttons.unedit")),a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(1,2,d.canSetUneditable())||!1===a.\u0275\u0275pipeBind1(2,4,d.valid))}}let Y=(()=>{class u{constructor(d,g){this.registryService=d,this.objectUpdatesService=g,this.metadataFieldSuggestions=new K.X([])}ngOnInit(){this.editable=this.objectUpdatesService.isEditable(this.url,this.metadata.uuid),this.valid=this.objectUpdatesService.isValid(this.url,this.metadata.uuid)}update(d){this.objectUpdatesService.saveChangeFieldUpdate(this.url,(0,E.cloneDeep)(this.metadata)),(0,x.Uh)(d)&&this.checkValidity(d)}checkValidity(d){d.control.setValue(d.viewModel),d.control.updateValueAndValidity(),this.objectUpdatesService.setValidFieldUpdate(this.url,this.metadata.uuid,d.control.valid)}setEditable(d){this.objectUpdatesService.setEditableFieldUpdate(this.url,this.metadata.uuid,d)}remove(){this.objectUpdatesService.saveRemoveFieldUpdate(this.url,(0,E.cloneDeep)(this.metadata))}removeChangesFromField(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.metadata.uuid)}ngOnChanges(){this.metadata=(0,E.cloneDeep)(this.fieldUpdate.field)}findMetadataFieldSuggestions(d){if((0,x.UE)(d))return this.registryService.queryMetadataFields(d,null,!0,!1,(0,pe.l)("schema")).pipe((0,y.xw)(),(0,y.EB)()).subscribe(g=>{this.setInputSuggestions(g)});this.metadataFieldSuggestions.next([])}setInputSuggestions(d){this.metadataFieldSuggestions.next(d.map(g=>({displayValue:g.split(".").join(".&#8203;"),value:g})))}canSetEditable(){return this.editable.pipe((0,oe.U)(d=>!d&&this.fieldUpdate.changeType!==F.m.REMOVE))}canSetUneditable(){return this.editable}canRemove(){return(0,Q.of)(this.fieldUpdate.changeType!==F.m.REMOVE&&this.fieldUpdate.changeType!==F.m.ADD)}canUndo(){return this.editable.pipe((0,oe.U)(d=>this.fieldUpdate.changeType>=0||d))}isNotEmpty(d){return(0,x.UE)(d)}}return u.\u0275fac=function(d){return new(d||u)(a.\u0275\u0275directiveInject(w.k),a.\u0275\u0275directiveInject(C.d))},u.\u0275cmp=a.\u0275\u0275defineComponent({type:u,selectors:[["","ds-edit-in-place-field",""]],inputs:{fieldUpdate:"fieldUpdate",url:"url",metadata:"metadata"},features:[a.\u0275\u0275NgOnChangesFeature],attrs:Be,decls:34,vars:39,consts:[[1,"metadata-field"],[4,"ngIf"],["class","field-container",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"w-100"],[1,"value-field"],[1,"text-center"],[1,"language-field"],[1,"btn-group","edit-field"],["class","btn btn-outline-primary btn-sm",3,"disabled","title","click",4,"ngIf"],["class","btn btn-outline-success btn-sm",3,"disabled","title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[1,"field-container"],["dsAutoFocus","","autoFocusSelector",".suggestion_input",3,"disable","suggestions","ngModel","url","metadata","valid","ngModelOptions","ngModelChange","submitSuggestion","clickSuggestion","typeSuggestion","dsClickOutside","findSuggestions"],["suggestionControl","ngModel"],[1,"text-danger"],[1,"dont-break-out"],["type","textarea","attr.aria-labelledby","fieldValue",1,"form-control",3,"ngModel","dsDebounce","ngModelChange","onDebounce"],["type","text","attr.aria-labelledby","fieldLang",1,"form-control",3,"ngModel","dsDebounce","ngModelChange","onDebounce"],[1,"btn","btn-outline-primary","btn-sm",3,"disabled","title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-success","btn-sm",3,"disabled","title","click"],[1,"fas","fa-check","fa-fw"]],template:function(d,g){1&d&&(a.\u0275\u0275elementStart(0,"td")(1,"div",0),a.\u0275\u0275template(2,De,3,1,"div",1),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275template(4,Re,5,12,"div",2),a.\u0275\u0275pipe(5,"async"),a.\u0275\u0275template(6,we,3,3,"small",3),a.\u0275\u0275pipe(7,"async"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(8,"td",4)(9,"div",5),a.\u0275\u0275template(10,je,3,1,"div",1),a.\u0275\u0275pipe(11,"async"),a.\u0275\u0275template(12,Fe,2,1,"div",2),a.\u0275\u0275pipe(13,"async"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(14,"td",6)(15,"div",7),a.\u0275\u0275template(16,$e,3,1,"div",1),a.\u0275\u0275pipe(17,"async"),a.\u0275\u0275template(18,B,2,1,"div",2),a.\u0275\u0275pipe(19,"async"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(20,"td",6)(21,"div",8),a.\u0275\u0275template(22,z,4,6,"button",9),a.\u0275\u0275pipe(23,"async"),a.\u0275\u0275template(24,me,5,8,"button",10),a.\u0275\u0275pipe(25,"async"),a.\u0275\u0275elementStart(26,"button",11),a.\u0275\u0275listener("click",function(){return g.remove()}),a.\u0275\u0275pipe(27,"async"),a.\u0275\u0275pipe(28,"translate"),a.\u0275\u0275element(29,"i",12),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(30,"button",13),a.\u0275\u0275listener("click",function(){return g.removeChangesFromField()}),a.\u0275\u0275pipe(31,"async"),a.\u0275\u0275pipe(32,"translate"),a.\u0275\u0275element(33,"i",14),a.\u0275\u0275elementEnd()()()),2&d&&(a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(3,13,g.editable)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(5,15,g.editable)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",!1===a.\u0275\u0275pipeBind1(7,17,g.valid)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(11,19,g.editable)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(13,21,g.editable)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(17,23,g.editable)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(19,25,g.editable)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(23,27,g.editable)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(25,29,g.editable)),a.\u0275\u0275advance(2),a.\u0275\u0275propertyInterpolate("title",a.\u0275\u0275pipeBind1(28,33,"item.edit.metadata.edit.buttons.remove")),a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(27,31,g.canRemove())),a.\u0275\u0275advance(4),a.\u0275\u0275propertyInterpolate("title",a.\u0275\u0275pipeBind1(32,37,"item.edit.metadata.edit.buttons.undo")),a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(31,35,g.canUndo())))},directives:[m.O5,Z.e,Me.h,_e.JJ,_e.On,Pe._,_e.Fj,Te.q],pipes:[m.Ov,T.X$],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.metadata-field[_ngcontent-%COMP%]{width:var(--ds-edit-item-metadata-field-width)}.language-field[_ngcontent-%COMP%]{width:var(--ds-edit-item-language-field-width)}"]}),u})();var G=o(84561),xe=o(42988);function X(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",13),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().reinstate()}),a.\u0275\u0275element(1,"i",14),a.\u0275\u0275elementStart(2,"span",4),a.\u0275\u0275text(3),a.\u0275\u0275pipe(4,"translate"),a.\u0275\u0275elementEnd()()}2&u&&(a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate1("\xa0",a.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function ge(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",15),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().discard()}),a.\u0275\u0275pipe(1,"async"),a.\u0275\u0275element(2,"i",16),a.\u0275\u0275elementStart(3,"span",4),a.\u0275\u0275text(4),a.\u0275\u0275pipe(5,"translate"),a.\u0275\u0275elementEnd()()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(1,2,d.hasChanges())),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate1("\xa0",a.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}const ye=function(){return{}},ve=function(u,$,d){return{"table-warning":u,"table-danger":$,"table-success":d}};function H(u,$){if(1&u&&a.\u0275\u0275element(0,"tr",23),2&u){const d=$.$implicit,g=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("fieldUpdate",d||a.\u0275\u0275pureFunction0(3,ye))("url",g.url)("ngClass",a.\u0275\u0275pureFunction3(4,ve,0===d.changeType,2===d.changeType,1===d.changeType))}}function q(u,$){if(1&u&&(a.\u0275\u0275elementStart(0,"table",17)(1,"thead")(2,"tr")(3,"th")(4,"span",18),a.\u0275\u0275text(5),a.\u0275\u0275pipe(6,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(7,"th")(8,"span",19),a.\u0275\u0275text(9),a.\u0275\u0275pipe(10,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(11,"th",20)(12,"span",21),a.\u0275\u0275text(13),a.\u0275\u0275pipe(14,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(15,"th",20),a.\u0275\u0275text(16),a.\u0275\u0275pipe(17,"translate"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(18,"tbody"),a.\u0275\u0275template(19,H,1,8,"tr",22),a.\u0275\u0275pipe(20,"dsObjectValues"),a.\u0275\u0275pipe(21,"async"),a.\u0275\u0275elementEnd()()),2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(6,6,"item.edit.metadata.headers.field")),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(10,8,"item.edit.metadata.headers.value")),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(14,10,"item.edit.metadata.headers.language")),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(17,12,"item.edit.metadata.headers.edit")),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngForOf",a.\u0275\u0275pipeBind1(20,14,a.\u0275\u0275pipeBind1(21,16,d.updates$)))("ngForTrackBy",d.trackUpdate)}}function fe(u,$){if(1&u&&(a.\u0275\u0275elementStart(0,"div"),a.\u0275\u0275element(1,"ds-alert",24),a.\u0275\u0275elementEnd()),2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275property("content","item.edit.metadata.empty")("type",d.AlertTypeEnum.Info)}}function Ae(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",13),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().reinstate()}),a.\u0275\u0275element(1,"i",14),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()}2&u&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"item.edit.metadata.reinstate-button")," "))}function Ve(u,$){if(1&u){const d=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",15),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(d),a.\u0275\u0275nextContext().discard()}),a.\u0275\u0275pipe(1,"async"),a.\u0275\u0275element(2,"i",16),a.\u0275\u0275text(3),a.\u0275\u0275pipe(4,"translate"),a.\u0275\u0275elementEnd()}if(2&u){const d=a.\u0275\u0275nextContext();a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(1,2,d.hasChanges())),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(4,4,"item.edit.metadata.discard-button")," ")}}let Le=(()=>{class u extends v.a{constructor(d,g,O,k,A,ee){super(d,g,O,k,A,ee),this.itemService=d,this.objectUpdatesService=g,this.router=O,this.notificationsService=k,this.translateService=A,this.route=ee,this.AlertTypeEnum=e.N}ngOnInit(){super.ngOnInit(),(0,x.xI)(this.updateService)&&(this.updateService=this.itemService)}initializeUpdates(){this.updates$=this.objectUpdatesService.getFieldUpdates(this.url,this.item.metadataAsList)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.metadata.notifications."}add(d=new p.s5){this.objectUpdatesService.saveAddFieldUpdate(this.url,d)}initializeOriginalFields(){this.objectUpdatesService.initialize(this.url,this.item.metadataAsList,this.item.lastModified,L)}submit(){this.isValid().pipe((0,h.P)()).subscribe(d=>{d?this.objectUpdatesService.createPatch(this.url).pipe((0,h.P)(),(0,S.w)(g=>this.updateService.patch(this.item,g).pipe((0,y.hC)()))).subscribe(g=>{g.hasFailed?this.notificationsService.error(this.getNotificationTitle("error"),g.errorMessage):(this.item=g.payload,this.checkAndFixMetadataUUIDs(),this.initializeOriginalFields(),this.updates$=this.objectUpdatesService.getFieldUpdates(this.url,this.item.metadataAsList),this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))}):this.notificationsService.error(this.getNotificationTitle("invalid"),this.getNotificationContent("invalid"))})}checkAndFixMetadataUUIDs(){const d=(0,E.cloneDeep)(this.item.metadata);Object.keys(this.item.metadata).forEach(g=>{d[g]=this.item.metadata[g].map(O=>(0,x.Uh)(O.uuid)?O:Object.assign(new p.DA,O))}),this.item.metadata=d}}return u.\u0275fac=function(d){return new(d||u)(a.\u0275\u0275directiveInject(_.S),a.\u0275\u0275directiveInject(C.d),a.\u0275\u0275directiveInject(j.F0),a.\u0275\u0275directiveInject(I.T),a.\u0275\u0275directiveInject(T.sK),a.\u0275\u0275directiveInject(j.gz))},u.\u0275cmp=a.\u0275\u0275defineComponent({type:u,selectors:[["ds-item-metadata"]],inputs:{updateService:"updateService"},features:[a.\u0275\u0275InheritDefinitionFeature],decls:35,vars:39,consts:[[1,"item-metadata"],[1,"button-row","top","d-flex","mb-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","table table-responsive table-striped table-bordered",4,"ngIf"],[4,"ngIf"],[1,"button-row","bottom"],[1,"mt-2","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"table","table-responsive","table-striped","table-bordered"],["id","fieldName"],["id","fieldValue"],[1,"text-center"],["id","fieldLang"],["ds-edit-in-place-field","",3,"fieldUpdate","url","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["ds-edit-in-place-field","",3,"fieldUpdate","url","ngClass"],[3,"content","type"]],template:function(d,g){1&d&&(a.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"button",2),a.\u0275\u0275listener("click",function(){return g.add()}),a.\u0275\u0275element(3,"i",3),a.\u0275\u0275elementStart(4,"span",4),a.\u0275\u0275text(5),a.\u0275\u0275pipe(6,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(7,X,5,3,"button",5),a.\u0275\u0275pipe(8,"async"),a.\u0275\u0275elementStart(9,"button",6),a.\u0275\u0275listener("click",function(){return g.submit()}),a.\u0275\u0275pipe(10,"async"),a.\u0275\u0275pipe(11,"async"),a.\u0275\u0275element(12,"i",7),a.\u0275\u0275elementStart(13,"span",4),a.\u0275\u0275text(14),a.\u0275\u0275pipe(15,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(16,ge,6,6,"button",8),a.\u0275\u0275pipe(17,"async"),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(18,q,22,18,"table",9),a.\u0275\u0275pipe(19,"dsObjectValues"),a.\u0275\u0275pipe(20,"async"),a.\u0275\u0275template(21,fe,2,2,"div",10),a.\u0275\u0275pipe(22,"dsObjectValues"),a.\u0275\u0275pipe(23,"async"),a.\u0275\u0275elementStart(24,"div",11)(25,"div",12),a.\u0275\u0275template(26,Ae,4,3,"button",5),a.\u0275\u0275pipe(27,"async"),a.\u0275\u0275elementStart(28,"button",6),a.\u0275\u0275listener("click",function(){return g.submit()}),a.\u0275\u0275pipe(29,"async"),a.\u0275\u0275element(30,"i",7),a.\u0275\u0275text(31),a.\u0275\u0275pipe(32,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(33,Ve,5,6,"button",8),a.\u0275\u0275pipe(34,"async"),a.\u0275\u0275elementEnd()()()),2&d&&(a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate1("\xa0",a.\u0275\u0275pipeBind1(6,11,"item.edit.metadata.add-button"),""),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(8,13,g.isReinstatable())),a.\u0275\u0275advance(2),a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(10,15,g.hasChanges())||!a.\u0275\u0275pipeBind1(11,17,g.isValid())),a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate1("\xa0",a.\u0275\u0275pipeBind1(15,19,"item.edit.metadata.save-button"),""),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(17,21,g.isReinstatable())),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(19,23,a.\u0275\u0275pipeBind1(20,25,g.updates$)).length>0),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngIf",0==a.\u0275\u0275pipeBind1(22,27,a.\u0275\u0275pipeBind1(23,29,g.updates$)).length),a.\u0275\u0275advance(5),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(27,31,g.isReinstatable())),a.\u0275\u0275advance(2),a.\u0275\u0275property("disabled",!a.\u0275\u0275pipeBind1(29,33,g.hasChanges())),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(32,35,"item.edit.metadata.save-button")," "),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(34,37,g.isReinstatable())))},directives:[m.O5,m.sg,Y,m.mk,G.w],pipes:[T.X$,m.Ov,xe.g],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]}),u})()},61419:(W,P,o)=>{"use strict";o.d(P,{F:()=>v});var _=o(86316),C=o(12166),E=o(25071),h=o(39646),S=o(5587),y=o(36696),I=o(5e3),p=o(74202);let v=(()=>{class x extends E.h{constructor(b,R,D,U){super(b,R,D,U),this.resolver=b,this.authorizationService=R,this.router=D,this.authService=U}getFeatureID(b,R){return(0,h.of)(S.i.AdministratorOf)}}return x.\u0275fac=function(b){return new(b||x)(I.\u0275\u0275inject(C.o),I.\u0275\u0275inject(_._),I.\u0275\u0275inject(p.F0),I.\u0275\u0275inject(y.e8))},x.\u0275prov=I.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},12166:(W,P,o)=>{"use strict";o.d(P,{o:()=>v});var _=o(58187),C=o(54004),E=o(38475),h=o(96140),S=o(40642),y=o(5e3),I=o(65620),p=o(74202);let v=(()=>{class x extends S.I{constructor(b,R,D){super(b,R,D),this.itemService=b,this.store=R,this.router=D}resolve(b,R){return super.resolve(b,R).pipe((0,C.U)(D=>{if(D.hasSucceeded&&(0,E.Uh)(D.payload)){const U=R.url,F=this.router.parseUrl((0,h.Tt)(D.payload)).toString();if(!U.startsWith(F)){const a=D.payload.uuid,L=U.substring(U.indexOf(a)+a.length,U.length);this.router.navigateByUrl(F+L)}}return D}))}}return x.\u0275fac=function(b){return new(b||x)(y.\u0275\u0275inject(_.S),y.\u0275\u0275inject(I.yh),y.\u0275\u0275inject(p.F0))},x.\u0275prov=y.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac}),x})()},40642:(W,P,o)=>{"use strict";o.d(P,{H:()=>p,I:()=>v});var _=o(58187),C=o(18838),E=o(46283),h=o(32527),S=o(5e3),y=o(65620),I=o(74202);const p=[(0,C.l)("owningCollection",{},(0,C.l)("parentCommunity",{},(0,C.l)("parentCommunity"))),(0,C.l)("relationships"),(0,C.l)("version",{},(0,C.l)("versionhistory")),(0,C.l)("thumbnail")];let v=(()=>{class x{constructor(b,R,D){this.itemService=b,this.store=R,this.router=D}resolve(b,R){const D=this.itemService.findById(b.params.id,!0,!1,...p).pipe((0,E.hC)());return D.subscribe(U=>{this.store.dispatch(new h.K(R.url,U.payload))}),D}}return x.\u0275fac=function(b){return new(b||x)(S.\u0275\u0275inject(_.S),S.\u0275\u0275inject(y.yh),S.\u0275\u0275inject(I.F0))},x.\u0275prov=S.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac}),x})()},15265:(W,P,o)=>{"use strict";o.d(P,{B:()=>C});var _=o(5e3);let C=(()=>{class E{canActivate(S,y){return S.data={title:S.params.configuration+".search.title"},!0}}return E.\u0275fac=function(S){return new(S||E)},E.\u0275prov=_.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac}),E})()},39530:(W,P,o)=>{"use strict";o.r(P),o.d(P,{SearchPageComponent:()=>y});var _=o(94417),C=o(61107),E=o(5e3),h=o(45411),S=o(72756);let y=(()=>{class I{}return I.\u0275fac=function(v){return new(v||I)},I.\u0275cmp=E.\u0275\u0275defineComponent({type:I,selectors:[["ds-search-page"]],features:[E.\u0275\u0275ProvidersFeature([{provide:_.SEARCH_CONFIG_SERVICE,useClass:C.U}])],decls:2,vars:0,template:function(v,x){1&v&&E.\u0275\u0275element(0,"ds-themed-search")(1,"ds-search-tracker")},directives:[h.l,S.j],encapsulation:2}),I})()},41514:(W,P,o)=>{"use strict";o.d(P,{q:()=>L});var _=o(69808),C=o(72081),E=o(42501),h=o(86025),S=o(15265),I=(o(72756),o(8563)),v=(o(39530),o(42509)),x=o(3308),e=o(61107),b=o(98451),R=o(98815),U=(o(68330),o(53956)),F=o(5e3);let L=(()=>{class j{}return j.\u0275fac=function(m){return new(m||j)},j.\u0275mod=F.\u0275\u0275defineNgModule({type:j}),j.\u0275inj=F.\u0275\u0275defineInjector({providers:[h.P,v.s,x.nJ,S.B,e.U],imports:[[_.ez,U.t,E.m.withEntryComponents(),C.IR.forRoot(),I.p.forRoot(),b.x.withEntryComponents(),R.a.withEntryComponents()]]}),j})()},72756:(W,P,o)=>{"use strict";o.d(P,{j:()=>D});var _=o(63900),C=o(54004),E=o(27653),h=o(86025),S=o(95900),y=o(94417),I=o(9168),p=o(61107),v=o(87890),x=o(46283),e=o(5e3),b=o(13758),R=o(74202);let D=(()=>{class U extends E.SearchComponent{constructor(a,L,j,T,m,w,K){super(a,L,j,T,m,K),this.service=a,this.sidebarService=L,this.windowService=j,this.searchConfigService=T,this.routeService=m,this.angulartics2=w,this.router=K}ngOnInit(){this.getSearchOptions().pipe((0,_.w)(a=>this.service.searchEntries(a).pipe((0,x.xw)(),(0,C.U)(L=>({config:a,searchQueryResponse:L.payload}))))).subscribe(({config:a,searchQueryResponse:L})=>{const j=[],T=L.appliedFilters||[];for(let m=0,w=T.length;m<w;m++)j.push(T[m]);this.angulartics2.eventTrack.next({action:"search",properties:{searchOptions:a,page:{size:a.pagination.size,totalElements:L.pageInfo.totalElements,totalPages:L.pageInfo.totalPages,number:a.pagination.currentPage},sort:{by:a.sort.field,order:a.sort.direction},filters:j}})})}}return U.\u0275fac=function(a){return new(a||U)(e.\u0275\u0275directiveInject(v.o),e.\u0275\u0275directiveInject(h.P),e.\u0275\u0275directiveInject(S.I),e.\u0275\u0275directiveInject(y.SEARCH_CONFIG_SERVICE),e.\u0275\u0275directiveInject(I.MZ),e.\u0275\u0275directiveInject(b.b),e.\u0275\u0275directiveInject(R.F0))},U.\u0275cmp=e.\u0275\u0275defineComponent({type:U,selectors:[["ds-search-tracker"]],features:[e.\u0275\u0275ProvidersFeature([{provide:y.SEARCH_CONFIG_SERVICE,useClass:p.U}]),e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:0,template:function(a,L){1&a&&e.\u0275\u0275text(0,"\xa0\n")},styles:["[_nghost-%COMP%]{display:none}"]}),U})()},68330:(W,P,o)=>{"use strict";o.d(P,{m:()=>h});var _=o(79094),C=o(5e3);function E(S,y){}let h=(()=>{class S extends _.F{getComponentName(){return"SearchPageComponent"}importThemedComponent(I){return o(217)(`./${I}/app/search-page/search-page.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,39530))}}return S.\u0275fac=function(){let y;return function(p){return(y||(y=C.\u0275\u0275getInheritedFactory(S)))(p||S)}}(),S.\u0275cmp=C.\u0275\u0275defineComponent({type:S,selectors:[["ds-themed-search-page"]],features:[C.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(I,p){1&I&&C.\u0275\u0275template(0,E,0,0,"ng-template",null,0,C.\u0275\u0275templateRefExtractor)},encapsulation:2}),S})()},217:(W,P,o)=>{var _={"./custom/app/search-page/search-page.component":[81498,1498]};function C(E){if(!o.o(_,E))return Promise.resolve().then(()=>{var y=new Error("Cannot find module '"+E+"'");throw y.code="MODULE_NOT_FOUND",y});var h=_[E],S=h[0];return o.e(h[1]).then(()=>o(S))}C.keys=()=>Object.keys(_),C.id=217,W.exports=C}}]);