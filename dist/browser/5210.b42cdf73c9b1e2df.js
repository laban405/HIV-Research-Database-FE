"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5210,2928],{45723:(V,R,n)=>{n.d(R,{u:()=>L});var i=n(8108),I=(n(82233),n(38475)),B=n(20789),C=n(17489),e=n(46283),x=n(94407),F=n(55489),A=n(41298),g=n(5e3),T=n(86956),b=n(69808),D=n(50358),t=n(93075);function y(d,P){if(1&d&&g.\u0275\u0275element(0,"ds-form",1),2&d){const r=g.\u0275\u0275nextContext();g.\u0275\u0275property("formId","profile-page-metadata-form-id")("formModel",r.formModel)("formGroup",r.formGroup)("displaySubmit",!1)("displayCancel",!1)}}let L=(()=>{class d{constructor(r,p,m,U){this.formBuilderService=r,this.translate=p,this.epersonService=m,this.notificationsService=U,this.formModel=[new i.b1u({id:"email",name:"email",readOnly:!0}),new i.b1u({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new i.b1u({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new i.b1u({id:"phone",name:"eperson.phone"}),new i.nMt({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=A.N.languages.filter(r=>!0===r.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(r=>{r.value="email"===r.name?this.user.email:this.user.firstMetadataValue(r.name),"language"===r.id&&(r.options=this.activeLangs.map(p=>Object.assign({value:p.code,label:p.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(r=>{r.label=this.translate.instant(this.LABEL_PREFIX+r.id),(0,I.UE)(r.validators)&&(r.errorMessages={},Object.keys(r.validators).forEach(p=>{r.errorMessages[p]=this.translate.instant(this.ERROR_PREFIX+r.id+"."+p)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const r=(0,C.cloneDeep)(this.user.metadata);let p=!1;return this.formModel.filter(m=>"email"!==m.id).forEach(m=>{r.hasOwnProperty(m.name)&&r[m.name].length>0?(0,I.Uh)(m.value)?r[m.name][0].value!==m.value&&(r[m.name][0].value=m.value,p=!0):(r[m.name]=[],p=!0):(0,I.Uh)(m.value)&&(r[m.name]=[{value:m.value,language:null}],p=!0)}),p&&this.epersonService.update(Object.assign((0,C.cloneDeep)(this.user),{metadata:r})).pipe((0,e.xw)(),(0,e.xe)()).subscribe(m=>{this.user=m,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),p}}return d.\u0275fac=function(r){return new(r||d)(g.\u0275\u0275directiveInject(x.c),g.\u0275\u0275directiveInject(T.sK),g.\u0275\u0275directiveInject(B.k),g.\u0275\u0275directiveInject(F.T))},d.\u0275cmp=g.\u0275\u0275defineComponent({type:d,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},decls:1,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(r,p){1&r&&g.\u0275\u0275template(0,y,1,5,"ds-form",0),2&r&&g.\u0275\u0275property("ngIf",p.formModel)},directives:[b.O5,D.U,t.JL,t.sg],encapsulation:2}),d})()},99321:(V,R,n)=>{n.d(R,{V:()=>Q});var i=n(61135),E=n(95698),I=n(63900),B=n(18505),C=n(86099),S=n(46283),e=n(5e3),x=n(42016),F=n(96140),g=(n(20166),n(60347)),T=n(70839),b=n(83129),D=n(17656),t=n(74202),y=n(69808),L=n(66541),d=n(86956);function P(s,v){if(1&s){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",8)(1,"button",15,16),e.\u0275\u0275listener("click",function(){const O=e.\u0275\u0275restoreView(a).$implicit;return e.\u0275\u0275nextContext().selectItem(O.indexableObject)}),e.\u0275\u0275element(3,"ds-listable-object-component-loader",17),e.\u0275\u0275elementEnd()()}if(2&s){const a=v.$implicit,l=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",a.indexableObject.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("object",a)("viewMode",l.viewMode)("linkType",l.linkTypes.None)}}let r=(()=>{class s extends x.q{constructor(a,l,h,O){super(a,l),this.activeModal=a,this.route=l,this.router=h,this.profileClaimService=O,this.listEntries$=new i.X(null),this.viewMode=g.w.ListElement,this.linkTypes=b.m,this.checked=!1,this.create=new e.EventEmitter}ngOnInit(){this.profileClaimService.searchForSuggestions(this.dso).pipe((0,S.hC)()).subscribe(a=>this.listEntries$.next(a))}selectItem(a){this.close(),this.navigate(a)}navigate(a){this.router.navigate([(0,F.Tt)(a)])}toggleCheckbox(){this.checked=!this.checked}createFromScratch(){this.create.emit(),this.close()}}return s.\u0275fac=function(a){return new(a||s)(e.\u0275\u0275directiveInject(D.Kz),e.\u0275\u0275directiveInject(t.gz),e.\u0275\u0275directiveInject(t.F0),e.\u0275\u0275directiveInject(T.n))},s.\u0275cmp=e.\u0275\u0275defineComponent({type:s,selectors:[["ds-profile-claim-item-modal"]],inputs:{dso:"dso"},outputs:{create:"create"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:27,vars:17,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["role","alert",1,"alert","alert-info"],[1,"dropdown-divider"],[1,"scrollable-menu","list-group","container"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md","mt-2"],[1,"modal-footer"],[1,"mr-5"],["type","checkbox",3,"checked","change"],["type","submit",1,"btn","btn-primary","ml-5","mr-2",3,"disabled","click"],[1,"fas","fa-plus"],[1,"list-group-item","list-group-item-action","border-0","list-entry",3,"title","click"],["listEntryElement",""],[3,"object","viewMode","linkType"]],template:function(a,l){if(1&a&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"h4"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275listener("click",function(){return l.close()}),e.\u0275\u0275elementStart(6,"span",2),e.\u0275\u0275text(7,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",3)(9,"div",4),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"div",5),e.\u0275\u0275elementStart(13,"div",6),e.\u0275\u0275template(14,P,4,4,"div",7),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementStart(16,"div",8),e.\u0275\u0275element(17,"div",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"div",10)(19,"div",11)(20,"input",12),e.\u0275\u0275listener("change",function(){return l.toggleCheckbox()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"button",13),e.\u0275\u0275listener("click",function(){return l.createFromScratch()}),e.\u0275\u0275element(24,"i",14),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()),2&a){let h;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,7,"dso-selector.claim.item.head")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(11,9,"dso-selector.claim.item.body")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",null==(h=e.\u0275\u0275pipeBind1(15,11,l.listEntries$))?null:h.payload.page),e.\u0275\u0275advance(6),e.\u0275\u0275property("checked",l.checked),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,13,"dso-selector.claim.item.not-mine-label")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!l.checked),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,15,"dso-selector.claim.item.create-from-scratch")," ")}},directives:[y.sg,L.p],pipes:[d.X$,y.Ov],encapsulation:2}),s})();var p=n(55489),m=n(36696),K=(n(82233),n(11605)),W=n(38475),w=n(18838),j=n(52381),$=n(41989),X=n(75987);function G(s,v){if(1&s){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p",3)(5,"span",4),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"ui-switch",5),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(a);const h=e.\u0275\u0275nextContext().ngVar;return e.\u0275\u0275nextContext().toggleProfileVisibility(h)}),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()()()}if(2&s){const a=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,5,"researcher.profile.associated")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,7,"researcher.profile.status")),e.\u0275\u0275advance(2),e.\u0275\u0275property("checkedLabel",e.\u0275\u0275pipeBind1(9,9,"researcher.profile.public.visibility"))("uncheckedLabel",e.\u0275\u0275pipeBind1(10,11,"researcher.profile.private.visibility"))("checked",a.visible)}}function N(s,v){1&s&&(e.\u0275\u0275elementStart(0,"div")(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&s&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"researcher.profile.not.associated")))}function c(s,v){1&s&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",7),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&s&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.action.processing")," "))}function _(s,v){1&s&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",8),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&s&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" \xa0",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.create.new")," "))}function o(s,v){if(1&s){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(a),e.\u0275\u0275nextContext(2).createProfile()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,c,4,3,"span",1),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,_,4,3,"span",1),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementEnd()}if(2&s){const a=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,3,a.isProcessingCreate())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(3,5,a.isProcessingCreate())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,7,a.isProcessingCreate()))}}function f(s,v){1&s&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",7),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&s&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.action.processing")," "))}function u(s,v){1&s&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",11),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&s&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" \xa0",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.delete")," "))}function M(s,v){if(1&s){const a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",6),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(a);const h=e.\u0275\u0275nextContext().ngVar;return e.\u0275\u0275nextContext().viewProfile(h)}),e.\u0275\u0275element(2,"i",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(a);const h=e.\u0275\u0275nextContext().ngVar;return e.\u0275\u0275nextContext().deleteProfile(h)}),e.\u0275\u0275template(6,f,4,3,"span",1),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,u,4,3,"span",1),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&s){const a=e.\u0275\u0275nextContext().ngVar,l=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!a),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,5,"researcher.profile.view")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!a),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,7,l.isProcessingDelete())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(9,9,l.isProcessingDelete()))}}function z(s,v){if(1&s&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,G,11,13,"div",1),e.\u0275\u0275template(2,N,4,3,"div",1),e.\u0275\u0275template(3,o,6,9,"button",2),e.\u0275\u0275template(4,M,10,11,"ng-container",1),e.\u0275\u0275elementEnd()),2&s){const a=v.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",a),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!a),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!a),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",a)}}let Q=(()=>{class s{constructor(a,l,h,O,J,Y,Z){this.researcherProfileService=a,this.profileClaimService=l,this.translationService=h,this.notificationService=O,this.authService=J,this.router=Y,this.modalService=Z,this.researcherProfile$=new i.X(null),this.processingDelete$=new i.X(!1),this.processingCreate$=new i.X(!1)}ngOnInit(){this.initResearchProfile()}createProfile(){this.processingCreate$.next(!0),this.authService.getAuthenticatedUserFromStore().pipe((0,E.q)(1),(0,I.w)(a=>this.profileClaimService.hasProfilesToSuggest(a))).subscribe(a=>{if(a){this.processingCreate$.next(!1);const l=this.modalService.open(r);l.componentInstance.dso=this.user,l.componentInstance.create.pipe((0,E.q)(1)).subscribe(()=>{this.createProfileFromScratch()})}else this.createProfileFromScratch()})}viewProfile(a){null!=this.researcherProfileItemId&&this.router.navigate(["items",this.researcherProfileItemId])}deleteProfile(a){const l=this.modalService.open(j.Y);l.componentInstance.headerLabel="confirmation-modal.delete-profile.header",l.componentInstance.infoLabel="confirmation-modal.delete-profile.info",l.componentInstance.cancelLabel="confirmation-modal.delete-profile.cancel",l.componentInstance.confirmLabel="confirmation-modal.delete-profile.confirm",l.componentInstance.brandColor="danger",l.componentInstance.confirmIcon="fas fa-trash",l.componentInstance.response.pipe((0,E.q)(1)).subscribe(h=>{h&&(this.processingDelete$.next(!0),this.researcherProfileService.delete(a).subscribe(O=>{O&&(this.researcherProfile$.next(null),this.researcherProfileItemId=null),this.processingDelete$.next(!1)}))})}toggleProfileVisibility(a){this.researcherProfileService.setVisibility(a,!a.visible).pipe((0,S.hC)()).subscribe(l=>{l.hasSucceeded?this.researcherProfile$.next(l.payload):this.notificationService.error(null,this.translationService.get("researcher.profile.change-visibility.fail"))})}isProcessingDelete(){return this.processingDelete$.asObservable()}isProcessingCreate(){return this.processingCreate$.asObservable()}createProfileFromScratch(){this.processingCreate$.next(!0),this.researcherProfileService.create().pipe((0,S.hC)()).subscribe(a=>{this.processingCreate$.next(!1),a.isSuccess?(this.initResearchProfile(),this.notificationService.success(null,this.translationService.get("researcher.profile.create.success"))):this.notificationService.error(null,this.translationService.get("researcher.profile.create.fail"))})}initResearchProfile(){this.researcherProfileService.findById(this.user.id,!1,!0,(0,w.l)("item")).pipe((0,S.Gp)(),(0,B.b)(a=>this.researcherProfile$.next(a)),(0,C.z)(a=>this.researcherProfileService.findRelatedItemId(a))).subscribe(a=>{(0,W.UE)(a)&&(this.researcherProfileItemId=a)})}}return s.\u0275fac=function(a){return new(a||s)(e.\u0275\u0275directiveInject(K.Z),e.\u0275\u0275directiveInject(T.n),e.\u0275\u0275directiveInject(d.sK),e.\u0275\u0275directiveInject(p.T),e.\u0275\u0275directiveInject(m.e8),e.\u0275\u0275directiveInject(t.F0),e.\u0275\u0275directiveInject(D.FF))},s.\u0275cmp=e.\u0275\u0275defineComponent({type:s,selectors:[["ds-profile-page-researcher-form"]],inputs:{user:"user"},decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],["class","btn btn-primary mr-2",3,"disabled","click",4,"ngIf"],[1,"align-items-center","researcher-profile-switch"],[1,"mr-3"],[3,"checkedLabel","uncheckedLabel","checked","change"],[1,"btn","btn-primary","mr-2",3,"disabled","click"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-plus"],[1,"fas","fa-info-circle"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash-alt"]],template:function(a,l){1&a&&(e.\u0275\u0275template(0,z,5,4,"div",0),e.\u0275\u0275pipe(1,"async")),2&a&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,l.researcherProfile$))},directives:[$.g,y.O5,X.ob],pipes:[y.Ov,d.X$],encapsulation:2}),s})()},82928:(V,R,n)=>{n.d(R,{V:()=>L});var i=n(5e3),E=n(8108),I=n(38475),B=n(20789),C=n(55489),S=n(54004),e=n(46283),x=n(86956),F=n(84561),A=n(69808),g=n(50358),T=n(93075);function b(d,P){if(1&d&&i.\u0275\u0275element(0,"ds-form",5),2&d){const r=i.\u0275\u0275nextContext();i.\u0275\u0275property("formId",r.FORM_PREFIX)("formModel",r.formModel)("formGroup",r.formGroup)("displaySubmit",!1)("displayCancel",!1)}}function D(d,P){if(1&d&&(i.\u0275\u0275elementStart(0,"div",6),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),2&d){const r=i.\u0275\u0275nextContext();i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,r.FORM_PREFIX+"error.password-length"))}}function t(d,P){if(1&d&&(i.\u0275\u0275elementStart(0,"div",7),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),2&d){const r=i.\u0275\u0275nextContext();i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,r.FORM_PREFIX+"error.matching-passwords"))}}function y(d,P){if(1&d&&(i.\u0275\u0275elementStart(0,"div",8),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),2&d){const r=i.\u0275\u0275nextContext();i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,r.FORM_PREFIX+"error.empty-password"))}}let L=(()=>{class d{constructor(r,p,m,U){this.formService=r,this.translate=p,this.epersonService=m,this.notificationsService=U,this.isInvalid=new i.EventEmitter,this.passwordValue=new i.EventEmitter,this.formModel=[new E.b1u({id:"password",name:"password",inputType:"password"}),new E.b1u({id:"passwordrepeat",name:"passwordrepeat",inputType:"password"})],this.passwordCanBeEmpty=!0,this.subs=[]}ngOnInit(){this.formGroup=this.formService.createFormGroup(this.formModel,this.passwordCanBeEmpty?{validators:[this.checkPasswordsEqual,this.checkPasswordLength]}:{validators:[this.checkPasswordsEqual,this.checkPasswordLength,this.checkPasswordEmpty]}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}),this.subs.push(this.formGroup.statusChanges.pipe((0,e.ig)(300),(0,S.U)(r=>"VALID"!==r)).subscribe(r=>this.isInvalid.emit(r))),this.subs.push(this.formGroup.valueChanges.pipe((0,e.ig)(300)).subscribe(r=>{this.passwordValue.emit(r.password)}))}updateFieldTranslations(){this.formModel.forEach(r=>{r.label=this.translate.instant(this.FORM_PREFIX+"label."+r.id)})}checkPasswordsEqual(r){return r.get("password").value===r.get("passwordrepeat").value?null:{notSame:!0}}checkPasswordLength(r){const p=r.get("password").value;return(0,I.xb)(p)||p.length>=6?null:{notLongEnough:!0}}checkPasswordEmpty(r){const p=r.get("password").value;return(0,I.xb)(p)?{emptyPassword:!0}:null}ngOnDestroy(){this.subs.filter(r=>(0,I.Uh)(r)).forEach(r=>r.unsubscribe())}}return d.\u0275fac=function(r){return new(r||d)(i.\u0275\u0275directiveInject(E.w1X),i.\u0275\u0275directiveInject(x.sK),i.\u0275\u0275directiveInject(B.k),i.\u0275\u0275directiveInject(C.T))},d.\u0275cmp=i.\u0275\u0275defineComponent({type:d,selectors:[["ds-profile-page-security-form"]],inputs:{passwordCanBeEmpty:"passwordCanBeEmpty",FORM_PREFIX:"FORM_PREFIX"},outputs:{isInvalid:"isInvalid",passwordValue:"passwordValue"},decls:7,vars:8,consts:[[1,"mb-4",3,"type"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],["id","notLongEnough","class","container-fluid text-danger",4,"ngIf"],["id","notSame","class","container-fluid text-danger",4,"ngIf"],["id","emptyPassword","class","container-fluid text-danger",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"],["id","notLongEnough",1,"container-fluid","text-danger"],["id","notSame",1,"container-fluid","text-danger"],["id","emptyPassword",1,"container-fluid","text-danger"]],template:function(r,p){1&r&&(i.\u0275\u0275elementStart(0,"ds-alert",0),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(3,b,1,5,"ds-form",1),i.\u0275\u0275template(4,D,3,3,"div",2),i.\u0275\u0275template(5,t,3,3,"div",3),i.\u0275\u0275template(6,y,3,3,"div",4)),2&r&&(i.\u0275\u0275property("type","alert-info"),i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,6,p.FORM_PREFIX+"info")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",p.formModel),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",p.formGroup.hasError("notLongEnough")),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",p.formGroup.hasError("notSame")),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",(p.formGroup.dirty||p.formGroup.touched)&&p.formGroup.hasError("emptyPassword")))},directives:[F.w,A.O5,g.U,T.JL,T.sg],pipes:[x.X$],encapsulation:2}),d})()},45210:(V,R,n)=>{n.r(R),n.d(R,{ProfilePageComponent:()=>N});var i=n(61135),E=n(45723),I=n(55489),B=n(39300),C=n(63900),S=n(18505),e=n(20789),x=n(46283),F=n(38475),A=n(18838),g=n(36696),T=n(86316),b=n(5587),D=n(40784),t=n(5e3),y=n(86956),L=n(41989),d=n(69808),P=n(99321),r=n(82928);function p(c,_){if(1&c&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"h3",12),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",4)(5,"div",5),t.\u0275\u0275text(6),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"div",6)(9,"div",12),t.\u0275\u0275element(10,"ds-profile-page-researcher-form",7),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementContainerEnd()),2&c){const o=t.\u0275\u0275nextContext(2).ngVar;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,3,"profile.head")),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(7,5,"profile.card.researcher")),t.\u0275\u0275advance(4),t.\u0275\u0275property("user",o)}}function m(c,_){if(1&c){const o=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",13)(1,"div",5),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",6)(5,"ds-profile-page-security-form",14),t.\u0275\u0275listener("isInvalid",function(u){return t.\u0275\u0275restoreView(o),t.\u0275\u0275nextContext(3).setInvalid(u)})("passwordValue",function(u){return t.\u0275\u0275restoreView(o),t.\u0275\u0275nextContext(3).setPasswordValue(u)}),t.\u0275\u0275elementEnd()()()}2&c&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,2,"profile.card.security")),t.\u0275\u0275advance(3),t.\u0275\u0275property("FORM_PREFIX","profile.security.form."))}function U(c,_){if(1&c&&(t.\u0275\u0275elementStart(0,"li",18),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&c){const o=_.$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(o.name)}}function K(c,_){if(1&c&&(t.\u0275\u0275elementStart(0,"div")(1,"h3",15),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"ul",16),t.\u0275\u0275template(5,U,2,1,"li",17),t.\u0275\u0275elementEnd()()),2&c){const o=t.\u0275\u0275nextContext().ngVar;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,2,"profile.groups.head")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",o)}}function W(c,_){if(1&c&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,K,6,4,"div",3),t.\u0275\u0275elementContainerEnd()),2&c){const o=_.ngVar;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",(null==o?null:o.length)>0)}}function w(c,_){if(1&c&&(t.\u0275\u0275elementStart(0,"li",18),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&c){const o=_.$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(o.name)}}function j(c,_){if(1&c&&(t.\u0275\u0275elementStart(0,"div",20)(1,"h3",15),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"ul",16),t.\u0275\u0275template(5,w,2,1,"li",17),t.\u0275\u0275elementEnd()()),2&c){const o=t.\u0275\u0275nextContext().ngVar;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,2,"profile.special.groups.head")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",o)}}function $(c,_){if(1&c&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,j,6,4,"div",19),t.\u0275\u0275elementContainerEnd()),2&c){const o=_.ngVar;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",(null==o?null:o.length)>0)}}function X(c,_){if(1&c){const o=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275template(1,p,11,7,"ng-container",3),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275elementStart(3,"div",4)(4,"div",5),t.\u0275\u0275text(5),t.\u0275\u0275pipe(6,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(7,"div",6),t.\u0275\u0275element(8,"ds-profile-page-metadata-form",7),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(9,m,6,4,"div",8),t.\u0275\u0275pipe(10,"async"),t.\u0275\u0275elementStart(11,"div",9)(12,"button",10),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(o),t.\u0275\u0275nextContext(2).updateProfile()}),t.\u0275\u0275element(13,"i",11),t.\u0275\u0275text(14),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(16,W,2,1,"ng-container",0),t.\u0275\u0275pipe(17,"async"),t.\u0275\u0275template(18,$,2,1,"ng-container",0),t.\u0275\u0275pipe(19,"async"),t.\u0275\u0275elementEnd()}if(2&c){const o=t.\u0275\u0275nextContext().ngVar,f=t.\u0275\u0275nextContext();let u,M;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(2,7,f.isResearcherProfileEnabled())),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(6,9,"profile.card.identify")),t.\u0275\u0275advance(3),t.\u0275\u0275property("user",o),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(10,11,f.canChangePassword$)),t.\u0275\u0275advance(5),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(15,13,"profile.form.submit"),""),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngVar",null==(u=t.\u0275\u0275pipeBind1(17,15,f.groupsRD$))||null==u.payload?null:u.payload.page),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngVar",null==(M=t.\u0275\u0275pipeBind1(19,17,f.specialGroupsRD$))||null==M.payload?null:M.payload.page)}}function G(c,_){if(1&c&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,X,20,19,"div",1),t.\u0275\u0275elementContainerEnd()),2&c){const o=_.ngVar;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",o)}}let N=(()=>{class c{constructor(o,f,u,M,z,Q){this.authService=o,this.notificationsService=f,this.translate=u,this.epersonService=M,this.authorizationService=z,this.configurationService=Q,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications.",this.isResearcherProfileEnabled$=new i.X(!1)}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe((0,B.h)(o=>(0,F.Uh)(o.id)),(0,C.w)(o=>this.epersonService.findById(o.id,!0,!0,(0,A.l)("groups"))),(0,x.g1)(),(0,x.xe)(),(0,S.b)(o=>this.currentUser=o)),this.groupsRD$=this.user$.pipe((0,C.w)(o=>o.groups)),this.canChangePassword$=this.user$.pipe((0,C.w)(o=>this.authorizationService.isAuthorized(b.i.CanChangePassword,o._links.self.href))),this.specialGroupsRD$=this.authService.getSpecialGroupsFromAuthStatus(),this.configurationService.findByPropertyName("researcher-profile.entity-type").pipe((0,x.hC)()).subscribe(o=>{this.isResearcherProfileEnabled$.next(o.hasSucceeded&&o.payload.values.length>0)})}updateProfile(){const o=this.metadataForm.updateProfile(),f=this.updateSecurity();!o&&!f&&this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid(o){this.invalidSecurity=o}updateSecurity(){const o=(0,F.UE)(this.password);return this.invalidSecurity&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&o&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:this.password}]).pipe((0,x.hC)()).subscribe(u=>{u.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),u.errorMessage)}),o}setPasswordValue(o){this.password=o}submit(){this.updateProfile()}isResearcherProfileEnabled(){return this.isResearcherProfileEnabled$.asObservable()}}return c.\u0275fac=function(o){return new(o||c)(t.\u0275\u0275directiveInject(g.e8),t.\u0275\u0275directiveInject(I.T),t.\u0275\u0275directiveInject(y.sK),t.\u0275\u0275directiveInject(e.k),t.\u0275\u0275directiveInject(T._),t.\u0275\u0275directiveInject(D.i))},c.\u0275cmp=t.\u0275\u0275defineComponent({type:c,selectors:[["ds-profile-page"]],viewQuery:function(o,f){if(1&o&&t.\u0275\u0275viewQuery(E.u,5),2&o){let u;t.\u0275\u0275queryRefresh(u=t.\u0275\u0275loadQuery())&&(f.metadataForm=u.first)}},decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[4,"ngIf"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],["class","card mb-4 security-section",4,"ngIf"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"mb-4"],[1,"card","mb-4","security-section"],[3,"FORM_PREFIX","isInvalid","passwordValue"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["data-test","specialGroups",4,"ngIf"],["data-test","specialGroups"]],template:function(o,f){1&o&&(t.\u0275\u0275template(0,G,2,1,"ng-container",0),t.\u0275\u0275pipe(1,"async")),2&o&&t.\u0275\u0275property("ngVar",t.\u0275\u0275pipeBind1(1,1,f.user$))},directives:[L.g,d.O5,P.V,E.u,r.V,d.sg],pipes:[d.Ov,y.X$],styles:[""]}),c})()}}]);